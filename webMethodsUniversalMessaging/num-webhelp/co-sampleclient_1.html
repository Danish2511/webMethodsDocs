<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Example: Implementing a Simple Pub/Sub Client</title><link rel="Prev" href="co-iframe_6.html" title="Previous" /><link rel="Next" href="to-header_java.html" title="Next" /><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/num-webhelp/co-sampleclient_1.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN_002fjUTl1gOgw1hawupTDhZgw" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/num-webhelp/co-sampleclient_1.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>Universal Messaging</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-title_developer_guide.html#wwconnect_header">Developer Guide</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-header_web_client_apis.html#wwconnect_header">Web Client APIs</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-header_javascript.html#wwconnect_header">Web Developer's Guide for Javascript</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Example: Implementing a Simple Pub/Sub Client</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0EVQUW" class="Heading_3">Example: Implementing a Simple Pub/Sub Client</div><div id="wwID0E4QUW" class="Body">The Universal Messaging JavaScript API makes it easy to implement JavaScript Publish &amp; Subscribe clients. These clients can communicate using Comet techniques (both streaming and long-polling), as well as using Web Sockets when supported by the client browser.</div><div id="wwID0ECRUW" class="Body">The code shown below is a fully functioning example of such a client, containing JavaScript connection, publishing and subscription logic and an HTML UI.</div><div id="wwID0EHRUW" class="Body">In some circumstances you may wish to serve your web application from another web server (e.g. Apache). Universal Messaging supports this also but due to security restrictions within browsers it requires that your application is organised differently (see 
    <a href="../num-webhelp/co-servingfromotherwebserver.html#wwID0ESHNW"
   
     title="Serving From Another Webserver"
    ><span class="heading-page">Serving From Another Webserver</span></a> for related information).</div><div id="wwID0EXRUW" class="Preformatted">&lt;!DOCTYPE html&gt;<br />&lt;html&gt;<br />&lt;head&gt;<br />    &lt;meta charset='utf-8'&gt;<br />    &lt;meta http-equiv='X-UA-Compatible' content='IE=edge'&gt;<br />    &lt;title&gt;Page Title&lt;/title&gt;<br />  <br />    &lt;script language="JavaScript" src="lib/nirvana.js"&gt;&lt;/script&gt;<br /><br />    &lt;script&gt;<br />        <br />        // this needs to be configured based on the server host you are executing this example against<br />        var hostName = "http://localhost:11000";<br />        // this needs to be configured based on the channel name<br />		var channelName = "/showcase/simplechatroom";<br />		<br />		var demoUsername = "anonymous";<br /><br />         /********************************************************************<br />         * As soon as the page loads, we should create our Universal Messaging session.<br />         * We use the  object Nirvana and define what<br />         * we want to happen once the session is initialised by implementing<br />         * a callback function, NirvanaSession.onInit:<br />         *********************************************************************/<br /><br />         var session =  Nirvana.createSession({<br />                realms : [ hostName ],<br />                // this can be an array of realms<br />                debugLevel : 4, // 1-9 (1 = noisy, 8 = severe, 9 = default = off)<br />                sessionTimeoutMs : 10000,<br />                drivers : [ // an array of transport drivers in preferred order:<br />                    Nirvana.WEBSOCKET,<br />                    Nirvana.XHR_STREAMING_CORS,<br />                    Nirvana.XDR_STREAMING,<br />                    Nirvana.JSONP_LONGPOLL<br />                ]<br />            });<br /><br />            session.start();<br /><br />        function isLoaded() {<br />        <br />        /********************************************************************<br />        * Now that our session has initialised, we can access an automatically<br />        * instatiated object named Nirvana, which provides access to classes<br />        * representing events and dictionaries.<br />        * In this demo, we shall subscribe to a channel and define what we<br />        * want to happen when certain activities occur (such as subscribing,<br />        * or receiving events). We do this by implementing callback logic,<br />        * either with anonymous functions, or if preferred, with named functions:<br />        *********************************************************************/<br />        <br />        //Obtain channel from the session that was created<br />        var demoChannel = session.getChannel(channelName);<br />        demoChannel.subscribe();<br /><br />        var isSubscribed = demoChannel.isSubscribed();<br />        if(isSubscribed){<br />            window.status = "Subscribed to " + demoChannel;<br />        }<br />        <br />        demoChannel.on(Nirvana.Observe.DATA, demoEventHandler);<br />        demoChannel.onPublish = updateUserInputUI;<br />    <br />        <br />    <br />         onConnect = function() { window.status = "Connected"; }<br />         onDisconnect = <br />            function() { window.status = "Disconnected. Reconnecting..."; }<br />        <br />         /********************************************************************<br />         * Now that we have defined all that should happen when our session is<br />         * up and running, let us *start* it.<br />         *********************************************************************/<br />        }<br />        <br />        function demoEventHandler(event) {<br />        <br />         /********************************************************************<br />         * This method automatically gets invoked every time we receive an<br />         * event from the demoChannel (since this is the method we specified<br />         * as the demoChannel.onData event handler. Note that the<br />         * event object will be passed to this method as a parameter. We can<br />         * then get the event's data "dictionary", and read the value of any<br />         * of its keys. In this demo, we use this data to update a textarea.<br />         *********************************************************************/<br />        <br />         var dictionary = event.getDictionary();<br />         var newData = <br />             dictionary.get('publisher') + ": " + dictionary.get('message') + "\n"<br />         var oldData = document.getElementById("outputTextarea").value;<br />         document.getElementById("outputTextarea").value = newData + oldData;<br />        }<br />        <br />         function publishMessage() {<br />        <br />         /********************************************************************<br />         * This method is an example of how to publish events to our channel.<br />         * We first get myChannel from an already created session,<br />         * then we create an event myEvent - empty Universal Messaging &lt;Event&gt;,<br />         * we create dictionary variable(myDict), and put the string <br />         * from the html input. Finally, we call the channel's publish method,<br />         * It is good practice to wrap code like this in try/catch blocks.<br />         *********************************************************************/<br />        <br />         if (document.getElementById("demoInput").value == "") return;<br />         try {<br />            <br />            var myChannel =  session.getChannel(channelName);<br />            var myEvent = Nirvana.createEvent();<br />            var myDict = myEvent.getDictionary();<br />            myDict.putString("message", document.getElementById("demoInput").value);<br />			myDict.putString("publisher", demoUsername);<br />            myChannel.publish(myEvent);<br /><br />         } catch (error) {<br />                 alert("Error: " + error.message);<br />         }<br />         }<br />        <br />        <br />        function updateUserInputUI() {<br />        <br />         /********************************************************************<br />         * This method automatically gets invoked after we successfully<br />         * publish to testChannel (since this is the method we specified<br />         * as the handler for testChannel.onPublish.<br />         * A typical implementation of such a function would re-enable UI components<br />         * that might have been disabled while publishing took place.<br />         *********************************************************************/<br />        <br />         if(!initialiasedASession) <br />             alert("We did not get a session to Universal Messaging");<br />         document.getElementById("demoInput").value = "";<br />         window.status = "Published";<br />         }<br />        <br />        <br />    &lt;/script&gt;<br />&lt;title&gt;Universal Messaging JavaScript Tutorial Application: <br />    Simple Chat Room&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body onload="isLoaded()"&gt;<br />    &lt;h1&gt;Universal Messaging JavaScript Tutorial Application: <br />        Simple Chat Room&lt;/h1&gt;<br />    <br />    &lt;form onsubmit="publishMessage(); return false;"&gt;<br />    <br />      &lt;h2&gt;Input&lt;/h2&gt;<br />      &lt;input type="text" id="demoInput"/&gt;<br />      &lt;input type="submit" value="Publish"&gt;<br />    <br />      &lt;h2&gt;Output&lt;/h2&gt;<br />      &lt;textarea id="outputTextarea" rows="10" cols="70"&gt;&lt;/textarea&gt;<br />    <br />    &lt;/form&gt;<br />    <br />    &lt;/body&gt;<br />&lt;/html&gt;</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright Â© 2013-2022&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>