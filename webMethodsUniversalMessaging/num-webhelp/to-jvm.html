<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>The Java Virtual Machine (JVM)</title><link rel="Prev" href="to-realm.html" title="Previous" /><link rel="Next" href="re_tuning_linux_os.html" title="Next" /><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/num-webhelp/to-jvm.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="puXHglBWBydk83HRRkZHb6Q" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/num-webhelp/to-jvm.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>Universal Messaging</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-title_concepts.html#wwconnect_header">Concepts</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-header_performance.html#wwconnect_header">Performance, Scalability and Resilience</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-performancetuning.html#wwconnect_header">Performance Tuning</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">The Java Virtual Machine (JVM)</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0E4IUO" class="Heading_3">The Java Virtual Machine (JVM)</div><div id="wwID0EFJUO" class="Body">Selecting and tuning a JVM is an important part in running any Java application smoothly. Applications with low latency requirements often require more attention paid to the JVM, as the JVM is often a big factor in performance.</div><div id="wwID0EKJUO" class="Body">This section outlines JVM selection, and advice on tuning for low latency applications on these JVMs. There are many different JVM vendors available and each JVM has slightly different configurable parameters. This section outlines a few key vendors and important configuration parameters.</div><div id="wwID0EWJUO" class="Section_Title">Selecting a Java Virtual Machine</div><div id="wwID0E2JUO" class="Body">As mentioned above, there are a variety of JVMs to choose from that come from different vendors. Some of these are free, some require a license to use. This section outlines a selection of these JVMs.</div><div id="wwID0EAKUO" class="Body">Azul Zulu is Software AG's primary test environment for Universal Messaging before the product is released. This JVM is included in the Universal Messaging distribution kit for the <span class="Keyword">Windows</span>, <span class="Keyword">Linux</span> and <span class="Keyword">Solaris</span> platforms. The other JVMs listed below have not been tested to work in all product configurations.</div><div id="wwID0E4KUO" class="Section_Title">Azul Zulu®</div><div id="wwID0ECLUO" class="Body">This JVM is suitable to fulfil most users needs for Universal Messaging.</div><div id="wwID0EPLUO" class="Section_Title">Oracle HotSpot™ JVM</div><div id="wwID0EULUO" class="Body">This JVM is suitable to fulfil most users needs for Universal Messaging.</div><div id="wwID0EBMUO" class="Section_Title">Oracle JRockit JVM</div><div id="wwID0EGMUO" class="Body">This JVM was made free and publicly available in May 2011. It contains many of the assets from the Oracle HotSpot VM.</div><div id="wwID0ETMUO" class="Section_Title">Azul Zing® JVM</div><div id="wwID0EYMUO" class="Body">The Azul Zing VM is a commercial offering from Azul. Its primary feature is a 'Pauseless Garbage Collection'. This VM is well suited to applications which require the absolute lowest latency requirements. Applications which experience higher garbage collection pause times may also benefit from using this VM.</div><div id="wwID0EFNUO" class="Section_Title">Configuring the Java Virtual Machine - Oracle HotSpot</div><div id="wwID0EKNUO" class="Body">This section covers parameters for the Oracle HotSpot JVM which may help improve application performance. These settings can be applied to a Universal Messaging Realm Server by editing the <span class="filepath">Server_Common.conf</span> file found under the <span class="filepath_002c_varname">&lt;InstallDir&gt;</span><span class="filepath">/</span><span class="filepath_002c_Keyword">UniversalMessaging</span><span class="filepath">/server/</span><span class="filepath_002c_varname">&lt;InstanceName&gt;</span><span class="filepath">/bin</span> directory of your installation, where <span class="varname">&lt;InstanceName&gt;</span> is the name of the Universal Messaging realm.</div><div id="wwID0EXOUO" class="Section_Title">General Tuning Parameters</div><div id="wwID0E3OUO" class="Body">Below are some suggestions of general tuning parameters which can be applied to the HotSpot VM.</div><div class="ww_skin_page_overflow"><table class="simple" cellspacing="0" summary=""><tr><td class="Table_Cell" style="padding-left: 2pt; padding-right: 2pt; vertical-align: top; width: 29.5%"><div id="wwID0E3PUO" class="Table_Cell">-Xmx</div></td><td class="Table_Cell" style="padding-left: 2pt; padding-right: 2pt; vertical-align: top; width: 70.4%"><div id="wwID0ECQUO" class="Table_Cell">The maximum heap size of the JVM.</div></td></tr><tr><td class="Table_Cell" style="padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EMQUO" class="Table_Cell">-Xms</div></td><td class="Table_Cell" style="padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0ESQUO" class="Table_Cell">The minimum heap size of the JVM. Set this as equal to the maximum heap size</div></td></tr><tr><td class="Table_Cell" style="padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0E3QUO" class="Table_Cell">-XX:+UseLargePages</div></td><td class="Table_Cell" style="padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0ECRUO" class="Table_Cell">Allows the JVM to use large pages. This may improve memory access performance. The system must be configured to use large pages.</div></td></tr><tr><td class="Table_Cell" style="padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EMRUO" class="Table_Cell">-XX:+UseNUMA</div></td><td class="Table_Cell" style="padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0ESRUO" class="Table_Cell">Allows the JVM to use non uniform memory access. This may improve memory performance</div></td></tr></table></div><div id="wwID0EESUO" class="Section_Title">Monitoring Garbage Collection Pause Times</div><div id="wwID0EJSUO" class="Body">It is important to collect proper monitoring information when tuning an application. This will allow you to quantify the results of changes made to the environment. Monitoring information about the Garbage collection can be collected from a JVM without any significant performance penalty.</div><div id="wwID0EOSUO" class="Body">We recommend using the most verbose monitoring settings. These can be activated by adding the following commands to the <span class="filepath">Server_Common.conf</span> file:</div><div id="wwID0EYSUO" class="Preformatted"><br />    -verbose:gc<br />    -XX:+PrintGCDetails<br />    -XX:+PrintGCDateStamps<br />    -XX:+PrintGCApplicationStoppedTime<br /></div><div id="wwID0E5SUO" class="Body">This will produce output similar to the following:</div><div id="wwID0EDTUO" class="Preformatted"><br />2012-07-06T11:42:37.439+0100:<br />        [GC<br />            [ParNew: 17024K-&gt;1416K(19136K), 0.0090341 secs]<br />                17024K-&gt;1416K(260032K), 0.0090968 secs]<br />                [Times: user=0.02 sys=0.01, real=0.01 secs] <br /></div><div id="wwID0EJTUO" class="Body">The line starts by printing the time of the garbage collection. If Date Stamps are enabled, this will be the absolute time, otherwise it will be the uptime of the process. Printing the full date is useful for correlating information taken from the nirvana logs or other application logs.</div><div id="wwID0EOTUO" class="Body">The next line shows if this is a full collection. If the log prints <span class="ph">GC</span>, then this is a young generation collection. Full garbage collections are denoted by the output <span class="emphasis">Full GC (System)</span>. Full garbage collections are often orders of magnitude longer than young garbage collections, hence for low latency systems they should be avoided. Applications which produce lots of full garbage collections may need to undergo analysis to reduce the stress placed on the JVMs memory management.</div><div id="wwID0E4TUO" class="Body">The next line displays the garbage collectors type. In this example <span class="emphasis">ParNew</span> is the Parallel Scavenge collector. Detailed explanation of garbage collectors are provided elsewhere on this page. Next to the type, it displays the amount of memory this collector reclaimed, as well as the amount of time it took to do so. Young garbage collections will only produce one line like this, full garbage collections will produce one line for the young generation collection and another for the old generation collection.</div><div id="wwID0EIUUO" class="Body">The last line in this example shows the total garbage collection time in milliseconds. The user time is the total amount of processor time taken by the garbage collector in user mode. The system time is the total amount of processor time taken by the garbage collector running in privileged mode. The real time is the wall clock time that the garbage collection has taken, in single core systems this will be the user + system time. In multiprocessor systems this time is often less as the garbage collector utilizes multiple cores.</div><div id="wwID0ENUUO" class="Body">The last flag will also cause the explicit application pause time to be printed out to the console. This output will usually look like the following:</div><div id="wwID0ESUUO" class="Preformatted"><br />Total time for which application threads were stopped: 0.0001163 seconds<br /></div><div id="wwID0EYUUO" class="Body">If you observe high client latencies as well as long application pause times, it is likely that the garbage collection mechanism is having an adverse affect on the performance of your application.</div><div id="wwID0EFVUO" class="Section_Title">Tuning Garbage Collection</div><div id="wwID0EKVUO" class="Body">The Garbage Collector can be one of the most important aspects of Java Virtual Machine tuning. Large pause times have the capability to negatively impact an applications performance by a noticeable degree. Below are some suggestions of ways to combat specific problems observed by monitoring garbage collection pause times.</div><div id="wwID0EXVUO" class="Section_Title">Frequent Full Garbage Collections</div><div id="wwID0E3VUO" class="Body">Full garbage collections are expensive, and often take an order of magnitude longer than a young generation garbage collection to complete. This kind of collection occurs when the old generation is full, and the JVM attempts to promote objects from the younger generation to the older generation. There are two scenarios where this can happen on a regular basis:</div><div id="wwID0EHWUO" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>There are many live objects on the heap, which are unable to be cleaned up by the JVM.</div><div id="wwID0E1WUO" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>The allocation rate of objects with medium-long lifespans is exceptionally high</div><div id="wwID0EOXUO" class="Body">If the information from garbage collection monitoring shows that full garbage collections are removing very few objects from the old generation, and that the old generation remains nearly full after a old generation collection, it is the case that there are many objects on the heap that cannot be cleaned up.</div><div id="wwID0ETXUO" class="Body">In the case of a Universal Messaging Realm Server exhibiting this symptom, it would be prudent to do an audit of data stored on the server. Stored events, ACL entries, channels, and queues all contribute to the memory footprint of Universal Messaging. Reducing this footprint by removing unused or unnecessary objects will reduce the frequency of full collections.</div><div id="wwID0EYXUO" class="Body">If the information from garbage collection monitoring shows that young garbage collection results in many promotions on a consistent basis, then the JVM is likely to have to perform full garbage collections frequently to free space for further promotions.</div><div id="wwID0E4XUO" class="Body">This kind of heap behaviour is caused by objects which remain live for more than a short amount of time. After this short amount of time they are promoted from the young generation into the old generation. These objects pollute the old generation, increasing the frequency of old generation collections. As promotion is an expensive operation, this behaviour often also causes longer young generation pause times.</div><div id="wwID0ECYUO" class="Body">Universal Messaging will mitigate this kind of problem by employing a caching mechanism on objects. To further decrease the amount of objects with this lifespan it is important that the administrator perform an audit of creation of resources, such as events, ACL entries, channels, or queues. Heavy dynamic creation and removal of ACL entries, channels, and queues may induce this kind of behaviour.</div><div id="wwID0EHYUO" class="Body">If an administrator has done everything possible to reduce the static application memory footprint, as well as the allocation rate of objects in the realm server then changing some JVM settings may help achieve better results.</div><div id="wwID0EMYUO" class="Body">Increasing the maximum heap size will reduce the frequency of garbage collections. In general however larger heap sizes will increase the average pause time for garbage collections. Therefore it is important that pause times are measured to ensure they stay within an acceptable limit.</div><div id="wwID0EZYUO" class="Section_Title">Long Young Generation Collection Pause Times</div><div id="wwID0E5YUO" class="Body">As mentioned above the primary cause of long young generation pauses is large amounts of object promotion. These objects often take the form of events, ACL entries, channels, and queues being created.</div><div id="wwID0EDZUO" class="Body">To minimise the amount of object creation during normal operating hours it is suggested to employ static creation of many channels, and queues at start-up time. This will result in these objects being promoted once at the beginning of operation, remaining in the old generation. Analysing where possible events can be given short lifespans (possibly even made transient) will also reduce the amount of promotion, as these objects will become dereferenced before they are eligible to be moved to the old generation.</div><div id="wwID0EIZUO" class="Body">It is important to remember that the Java Virtual Machine's memory subsystem performs best when long living objects are created in the initialisation stage, while objects created afterwards die young. Therefore designing your system to create long lived objects like channels at startup and objects like events to be short lived allows Universal Messaging to harmoniously work with the underlying JVM.</div><div id="wwID0EVZUO" class="Section_Title">Long Full Collection Pause Times</div><div id="wwID0E1ZUO" class="Body">Full Garbage collections which take long periods of time can often be remedied by proper tuning of the underlying JVM. The two recommended approaches to reducing the amount of time spent in full garbage collections is detailed below.</div><div id="wwID0E6ZUO" class="Body">The first approach would be to reduce the overall heap size of the application. Larger heaps often increase the amount of time for a garbage collection cycle to finish. Reducing the heap will lower the average time that a garbage collection cycle takes to complete. Smaller heap sizes will require garbage collecting more often however, so it is important to ensure that you balance the need for lower collection times with collection frequency.</div><div id="wwID0EE1UO" class="Body">If you are not able to reduce the heap size any further, because garbage collection frequency is increasing, it may be beneficial to change the type of garbage collector used. If you are experiencing high maximum latencies correlated with long GC times it may be beneficial to switch to using the CMS collector.</div><div id="wwID0EJ1UO" class="Body">The Concurrent Mark Sweep (CMS) collector aims to minimize the amount of time an application is paused by doing many of its operations in parallel with the application. This collector can be enabled by adding the following parameter to <span class="filepath">Server_Common.conf</span>:</div><div id="wwID0ET1UO" class="Preformatted"><br />-XX:+UseConcMarkSweepGC<br /></div><div id="wwID0EZ1UO" class="Body">CMS Collections will usually take more time overall than those done with the Parallel Collector. Only a small fraction of the work done by the CMS collector requires the application to pause however, which will generally result in improved response times.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright © 2013-2022&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>