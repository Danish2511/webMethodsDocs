<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Case Study: Migrating Between Single-Node and Multi-Node Active/Active Cluster</title><link rel="Prev" href="ta-manage_cluster_sites.html" title="Previous" /><link rel="Next" href="to-header_channeladmin.html" title="Next" /><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/num-webhelp/co-single_to_3_node_aa_cluster.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pT3v3bnFzW1_002b9EA2WID_002fQ3w" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/num-webhelp/co-single_to_3_node_aa_cluster.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>Universal Messaging</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-title_administration_guide.html#wwconnect_header">Administration Guide</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-overview_enterprise_manager.html#wwconnect_header">Universal Messaging Enterprise Manager</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-overview-clusteradmin.html#wwconnect_header">Cluster Administration</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Case Study: Migrating Between Single-Node and Multi-Node Active/Active Cluster</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0EQW3R" class="Heading_3">Case Study: Migrating Between Single-Node and Multi-Node Active/Active Cluster</div><div id="wwID0EYW3R" class="Body">This case study examines the following scenarios:</div><div id="wwID0EBX3R" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Migrating from a single node setup to a multi-node active/active cluster.</div><div id="wwID0ESX3R" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Migrating from an active/active cluster to a single-node setup, also known as declustering.</div><div id="wwID0EEY3R" class="Body">Migrating from a single-node setup to a multi-node active/active setup requires manual steps. A "live" migration from a single node to a cluster is not currently supported. The migration procedure enables you to migrate all local resources to cluster-wide resources. If you choose not to migrate local resources, they are deleted.</div><div id="wwID0EJY3R" class="Body">The steps outlined below describe behaviors of realms and their local stores (channels and queues) before and after clustering and declustering.</div><div id="wwID0EOY3R" class="Body">Before you start, see the section 
    <a href="../num-webhelp/to-creatingclusters.html#wwID0EDPZR"
   
     title="Creating Clusters"
    ><span class="heading-page">Creating Clusters</span></a> for general information about creating a cluster.</div><div id="wwID0EGZ3R" class="Section_Title">Preparation</div><div id="wwID0EA13R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Migrating from a single-node setup to a multi-node active/active requires various manual steps. Software AG recommends that you have proper downtime for this cluster setup and not migrate from a running node.</div><div id="wwID0EE23R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Stop all publishers, so that no new events arrive. Also ensure that all channels and queues are completely drained and no pending events exist by waiting until the subscribers consume all pending messages.</div><div id="wwID0EW23R" class="Numbered_1_Continued">This step is needed because Universal Messaging does not support live migration. By stopping publishers and consuming all events we are ensuring no event loss will be experienced. Our current migration allows the migration of all non-cluster wide resources into cluster-wide ones, and vice-versa, but does not take care of the system dynamics, such as transactions and in-flight events from a durable object. Durable subscriber objects will not be re-created after the migration, so client applications need to take care of this.</div><div id="wwID0EN33R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>When all channels and queues are completely drained, stop all subscribers.</div><div id="wwID0ER43R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>If you are working with a virtual machine (VM), create a snapshot of the existing virtual machine, in case you need to revert to this snapshot at a later stage.</div><div id="wwID0EV53R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Update the Universal Messaging license file with "clustering" capability (if applicable).</div><div id="wwID0EZ63R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Ensure that the other Universal Messaging nodes that you will be working with in the clustered environment are at a software level that is identical with your existing node. If possible, update your existing node to the latest released fix level issued by Software AG, and ensure that the same fix level is installed on the other nodes.</div><div id="wwID0EVA4R" class="Section_Title">Migrating from a Single Node to Multi-Node Active/Active Cluster</div><div id="wwID0E1A4R" class="Body">You have two scenarios:</div><div id="wwID0EDB4R" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>The cluster does not already exist, so you must create a new cluster containing your node and other nodes.</div><div id="wwID0EUB4R" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>The cluster exists already, so you will add your single node to the existing cluster.</div><div id="wwID0EGC4R" class="Body"><span class="emphasis">Scenario 1: Create a new cluster and add your node to it</span></div><div id="wwID0EQC4R" class="Body">If the cluster does not already exist, then follow these steps to create the cluster and add the single node to the cluster:</div><div id="wwID0EKD4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Create a new cluster, as described in 
    <a href="../num-webhelp/to-creatingclusters.html#wwID0EDPZR"
   
     title="Creating Clusters"
    ><span class="heading-page">Creating Clusters</span></a>.</div><div id="wwID0EZE4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Add your single node and the other required nodes to the cluster.</div><div id="wwID0E4F4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>After you have specified all of the nodes to be added to the cluster, choose the option to convert all local stores to cluster stores.</div><div id="wwID0EPG4R" class="Numbered_1_Continued">If you choose not to migrate the local stores, they are deleted.</div><div id="wwID0EGH4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Verify successful migration by the following steps:</div><div id="wwID0ENI4R" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Ensure that all nodes joined the cluster, that is, they are in Master or Slave state.</div><div id="wwID0ERJ4R" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Ensure that all connection factories are enabled with the new URL for the Universal Messaging realm cluster.</div><div id="wwID0EVK4R" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Ensure that JMS and webMethods messaging triggers (durable subscribers) are enabled by selecting the "Cluster Wide" check box on the durable subscription in the Enterprise Manager. If this is not already the case, you will need to delete the non-clustered durable subscribers, then manually synchronize documents using the Software AG Designer.</div><div id="wwID0EZL4R" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Update the realm URL in all affected Universal Messaging clients (such as webMethods Integration Server, My webMethods Server) to point to the new Universal Messaging cluster URL. Enable Universal Messaging client connections (webMethods Integration Server, My webMethods Server), and enable publishers and subscribers.</div><div id="wwID0E4M4R" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Start the publishers and subscribers.</div><div id="wwID0ETN4R" class="Body"><span class="emphasis">Scenario 2: Add your node to an existing cluster</span></div><div id="wwID0E4N4R" class="Body">If the cluster already exists, then follow these steps to add the single node to the cluster:</div><div id="wwID0EXO4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Add your realm from the list of available realms to the list of existing cluster members.</div><div id="wwID0E2P4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Ensure that all connection factories are extended with the Universal Messaging realm URL of the newly added node.</div><div id="wwID0E6Q4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Update the realm URL in all affected Universal Messaging clients (webMethods Integration Server, My webMethods Server) to point to the new Universal Messaging cluster URL.</div><div id="wwID0EDS4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Start publishers and subscribers.</div><div id="wwID0E6S4R" class="Section_Title">Declustering a Single Node from an Active/Active Cluster</div><div id="wwID0EET4R" class="Body">You have two scenarios:</div><div id="wwID0ENT4R" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Deleting the cluster and allowing the individual nodes to continue as non-clustered nodes.</div><div id="wwID0E5T4R" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Removing a single node from a cluster, while allowing the cluster to continue operating with the other cluster nodes.</div><div id="wwID0EQU4R" class="Body"><span class="emphasis">Scenario 1: Delete the cluster</span></div><div id="wwID0E1U4R" class="Body">Follow these steps to delete the cluster and allow the individual nodes to continue as non-clustered nodes:</div><div id="wwID0EUV4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Delete the cluster, as described in 
    <a href="../num-webhelp/ta-deleting_clusters.html#wwID0EA4ZR"
   
     title="Deleting a Cluster"
    ><span class="heading-page">Deleting a Cluster</span></a>.</div><div id="wwID0ERW4R" class="Numbered_1_Continued">You can choose whether you want to copy the cluster stores into local stores on the declustered nodes.</div><div id="wwID0EIX4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Ensure that all connection factories are enabled with the Universal Messaging realm URL.</div><div id="wwID0EMY4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Integration Server: Ensure that the "Cluster-Wide" settings for the JMS / webMethods Native Message triggers (DS) are disabled. Documents need to be synchronized from Software AG Designer so all durable objects are re-created. Ensure they have the "Cluster-Wide" option deselected.</div><div id="wwID0EQZ4R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Update the realm URL in the Universal Messaging clients (webMethods Integration Server, My webMethods Server) to point to the Universal Messaging realm URL.</div><div id="wwID0EU14R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Enable the Universal Messaging client connections.</div><div id="wwID0EY24R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Start the publishers and subscribers.</div><div id="wwID0EM34R" class="Body"><span class="emphasis">Scenario 2: Remove a single node from a cluster</span></div><div id="wwID0EW34R" class="Body">Follow these steps to remove a single node from a cluster, while retaining the rest of the cluster:</div><div id="wwID0EQ44R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Remove the realm from the list of cluster members, as described in 
    <a href="../num-webhelp/ta-modifying_cluster.html#wwID0EUC1R"
   
     title="Adding and Removing Cluster Members"
    ><span class="heading-page">Adding and Removing Cluster Members</span></a>.</div><div id="wwID0EN54R" class="Numbered_1_Continued">You can choose whether you want to copy the cluster stores into local stores on the declustered node.</div><div id="wwID0ET54R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Connection factories:</div><div id="wwID0EY64R" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>For the declustered node: Modify all connection factories so that they refer to only the realm URL of the newly declustered node.</div><div id="wwID0E3A5R" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>For the remaining nodes in the cluster: Modify all connection factories so that the realm URL of the declustered node is removed.</div><div id="wwID0ERB5R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Client URLs:</div><div id="wwID0EWC5R" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>For the declustered node: Update the realm URL in the Universal Messaging clients (webMethods Integration Server, My webMethods Server) by providing only the Universal Messaging URL of the newly declustered node.</div><div id="wwID0E1D5R" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>For the remaining nodes in the cluster: Update the realm URL in the Universal Messaging clients (webMethods Integration Server, My webMethods Server) by removing the Universal Messaging URL of the newly declustered node.</div><div id="wwID0EAF5R" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Start the publishers and subscribers.</div><div id="wwID0E3F5R" class="Section_Title">Rollback strategy</div><div id="wwID0EBG5R" class="Body">For a rollback strategy if any severe issues occur during clustering or declustering that cannot be resolved, below are some options:</div><div id="wwID0EKG5R" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Delete the cluster and migrate to local nodes.</div><div id="wwID0E2G5R" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>In the worst case, if there are still any potential issues with the local node after deleting the cluster, then roll back to the virtual machine snapshot.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright Â© 2013-2022&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>