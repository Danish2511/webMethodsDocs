<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Applet Javascript Bridge Example</title><link rel="Prev" href="co-webstart.html" title="Previous" /><link rel="Next" href="co-apicomparisons.html" title="Next" /><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/num-webhelp/co-appletjsbridge.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pDNudEW5cEtTXQ55xrpZ3SQ" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/num-webhelp/co-appletjsbridge.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>Universal Messaging</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-title_developer_guide.html#wwconnect_header">Developer Guide</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-header_web_client_apis.html#wwconnect_header">Web Client APIs</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-header_java.html#wwconnect_header">Web Developer's Guide for Java</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Applet Javascript Bridge Example</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0E34UW" class="Heading_3">Applet Javascript Bridge Example</div><div id="wwID0EL5UW" class="Section_Title">A Sample JavaScript-Applet Bridged Client</div><div id="wwID0EQ5UW" class="Body">Using the Universal Messaging nApplet, it is easy to bridge communications between a JavaScript front end which delegates all Universal Messaging communication to an Applet.</div><div id="wwID0EV5UW" class="Body">The code shown below is a fully functioning example of such a client, containing an applet along with JavaScript code which communicates seamlessly with the applet. The applet implements all connection, publishing and subscription logic. All events that are delivered to the applet are called back into JavaScript asynchronously.</div><div id="wwID0E65UW" class="Preformatted">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;!doctype html PUBLIC "-// W3C// DTD XHTML 1.0 Transitional// EN"<br /> "http:// www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;<br />&lt;html xmlns="http:// www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;<br /><br />&lt;head&gt;<br />&lt;script language="JavaScript" src="lib/nirvana.js"&gt;&lt;/script&gt;<br /><br />&lt;script&gt;<br /><br />var appName = "myTestApplication";<br />var channelName = "/tutorial/testchannel/";<br />var realm = "nhp://" + location.hostname + ":80";<br />var sessionName = "myExampleSession";<br />var username = "TestUser"; // note that in a real app,<br /> // this should be an authenticated username!<br />var connected = false;<br />var isLoadedCounter = 0;<br />var mySession = null;<br />var testChannel = null;<br />var isTimedOutConnectingCounter = 0;<br /><br /><br />function isLoaded() {<br /><br /> /********************************************************************<br /> * As soon as the page loads, we should create our Nirvana session.<br /> * This method is invoked by the &lt;body&gt; tag's "onload" event.<br /> * We initialise our session by passing in a realm address, a sessionid,<br /> * a username and a "prefix" for connection listener callback methods.<br /> * The last parameter is the connection listener "prefix". As we chose<br /> * to use the string "conHandlerCB" as the prefix, we must now implement<br /> * four methods to receive asynchronous notifications of our connection<br /> * status: conHandlerCBgotInitialConnection, conHandlerCBdisconnected,<br /> * conHandlerCBreconnected and conHandlerCBtryAgain.<br /> * Note that we could use any string as a prefix; we simply need to<br /> * name our four implemented methods accordingly.<br /> *********************************************************************/<br /><br /> // the nJSCRIPT variable is set by the applet when it initially loads<br /> if ( typeof nJSCRIPT == "undefined" ) {<br /> if ( isLoadedCounter &gt; 4) {<br /> window.status = "unable to initialise nirvana libraries";<br /> return;<br /> }<br /> else{<br /> setTimeout("isLoaded()", 4000);<br /> }<br /> }<br /> else if ( nJSCRIPT == true ) {<br /> window.status = "nApplet has been initialised.";<br /> // session is initialised with a realm address, a sessionid,<br /> // a username and a connection listener callback stub.<br /> mySession = new nSessionWithSubjectAndReconnectionHandler(realm, <br />     appName, username, "conHandlerCB");<br /> mySession.init();<br /> connectionTimeoutMonitor();<br /> }<br /><br />}<br /><br /><br />function connectionTimeoutMonitor() {<br /><br /> /********************************************************************<br /> * This method is used to allow the web page to give up on attempting<br /> * to get an initial connection after a certain number of retries are<br /> * unsuccessful.<br /> *********************************************************************/<br /><br /> isTimedOutConnectingCounter++;<br /> if ( mySession.isConnected() ) {<br /> return;<br /> }<br /> else if (isTimedOutConnectingCounter &lt; 4) {<br /> setTimeout("connectionTimeoutMonitor()", 4000);<br /> }<br /> else if (isTimedOutConnectingCounter == 4) {<br /> timedOutConnecting = true;<br /> window.status = "Timed out connecting to Nirvana. ";<br /> document.getElementById('nirvana').stop();<br /> return;<br /> }<br /><br />}<br /><br />function conHandlerCBdisconnected() {<br /><br /> /********************************************************************<br /> * This method automatically gets invoked we get disconnected from our<br /> * Nirvana session. Note that this is because we specified<br /> * "conHandlerCB" as the prefix of the implicit "disconnected",<br /> * "reconnected","initialConnection" &amp; "tryAgain" methods when we<br /> * created the session (see fourth parameter in the constructor for<br /> * nSessionWithSubjectAndReconnectionHandler).<br /> * A typical use for these method would be to re-enable UI components<br /> * which might have been disabled during the disconnected period.<br /> * See also the tryAgain method, which allows us to specify whether<br /> * the application should attempt to reconnect automatically after a<br /> * disconnect has occurred.<br /> *********************************************************************/<br /><br /> connected = false;<br /> alert("Disconnected");<br /><br />}<br /><br />function conHandlerCBreconnected() {<br /><br /> /********************************************************************<br /> * This method automatically gets invoked we get reconnected to our<br /> * Nirvana session after a disconnect too place. Note that this is<br /> * because we specified "conHandlerCB" as the prefix of the implicit<br /> * "disconnected","reconnected","initialConnection" &amp; "tryAgain"<br /> * methods when we created the session (see fourth parameter in the<br /> * nSessionWithSubjectAndReconnectionHandler constructor).<br /> * A typical use for these method would be to re-enable UI components<br /> * which might have been disabled during the disconnected period.<br /> * See also the tryAgain method, which allows us to specify whether<br /> * the application should attempt to reconnect automatically after a<br /> * disconnect has occured.<br /> *********************************************************************/<br /><br /> connected = true;<br /> alert("Reconnected");<br /><br />}<br /><br />function conHandlerCBgotInitialConnection() {<br /><br /> /********************************************************************<br /> * This method automatically gets invoked we get the initial connection.<br /> * Note that this is because we specified "conHandlerCB" as the prefix<br /> * of the implicit "disconnected","reconnected","initialConnection" &amp;<br /> * "tryAgain" methods when we created the session (see fourth parameter<br /> * in the nSessionWithSubjectAndReconnectionHandler constructor).<br /> * A typical use for these method would be to wait for confirmation<br /> * that the session has initialised before continuing with any other<br /> * processing.<br /> *********************************************************************/<br /><br /> connected = true;<br /> window.status = "Connected to Nirvana.";<br /> setTimeout("handleNewConnection();", 500);<br /><br />}<br /><br />function conHandlerCBtryAgain() {<br /><br /> /********************************************************************<br /> * This method automatically gets invoked after each attempt to<br /> * reconnect to a disconnected Nirvana session. This allows the<br /> * developer to control whether or not continued attempts should be<br /> * made to reconnect. Note that this is because we specified<br /> * "conHandlerCB" as the prefix of the implicit "disconnected",<br /> * "reconnected","initialConnection" &amp; "tryAgain" methods when we<br /> * created the session in our isLoaded() method.<br /> * This method allows us to specify whether the application should<br /> * attempt to reconnect automatically after a disconnect has occured.<br /> *********************************************************************/<br /><br /> return true;<br /><br />}<br /><br /><br /><br />function handleNewConnection() {<br /><br /> window.status = "Session Initialised";<br /> setupTestChannel();<br /><br />}<br /><br />function setupTestChannel() {<br /><br /> /********************************************************************<br /> * Here we create an nChannelAttributes object, setting its name to<br /> * that of the channel we wish to use. We then use our session to<br /> * a) find the channel, then b) subscribe to the channel.<br /> *********************************************************************/<br /><br /> if (connected) {<br /> var channelAttribs = new nChannelAttributes();<br /> channelAttribs.setName(channelName);<br /> testChannel = mySession.findChannel( channelAttribs, "testChannelFoundCB" );<br /> // make sure we have a usable channel object<br /> if (testChannel == false) {<br /> if (mySession.isConnected()) {<br /> // Channel could not be found. Let us try again.<br /> // Maybe channel does not exist, or channel ACL is incorrect<br /> setTimeout("setupTestChannel()", 2000);<br /> } else {<br /> // waiting for disconnect<br /> setTimeout("setupTestChannel()", 4000);<br /> }<br /><br /> } else {<br /> // Add subscriber to the channel object<br /> var startEID = 0;<br /> var evtHandler = "myTestChannelEventHandlerCB";<br /> testChannel.addSubscriberFromEID(evtHandler, startEID)<br /> }<br /> } else {<br /> // if we were disconnected when this method was called, try again<br /> setTimeout("getServerTime()", 4000);<br /> }<br /> window.status = "";<br />}<br /><br />function myTestChannelEventHandlerCB(event) {<br /><br /> /********************************************************************<br /> * This method automatically gets invoked every time we receive an<br /> * event from the testChannel (since this is the method we specified<br /> * when we subscribed - see testChannelFoundCB method). Note that the<br /> * event object will be passed to this method as a parameter. We can<br /> * then get the event data (which is a byte[]), and/or its "dictionary"<br /> * which contains a set of key-value pairs. In this demo, we use the<br /> * dictionary keys "publisher" and "message", and update a textarea.<br /> *********************************************************************/<br /><br /> var dictionary = event.getDictionary();<br /> var newData = dictionary.get('publisher') + ": " + dictionary.get('message') + "\n"<br /> var oldData = document.getElementById("outputTextarea").value;<br /> document.getElementById("outputTextarea").value = newData + oldData;<br />}<br /><br /><br /><br />function publishMessage() {<br /><br /> /********************************************************************<br /> * This method is an example of how to publish events to our channel.<br /> * We first create an nConsumeEvent, and assign it an nEventProperties<br /> * object (which represents a data"dictionary" - essentially a hash of<br /> * key-value pairs). Finally, we publish our event to the channel.<br /> *********************************************************************/<br /><br /> if (document.getElementById("demoInput").value == "") return;<br /> try {<br /> var evt = new nConsumeEvent();<br /> var dictionary = new nEventProperties();<br /> dictionary.put("publisher", username);<br /> dictionary.put("message", document.getElementById("demoInput").value);<br /> evt.setDictionary(dictionary);<br /> testChannel.publish(evt);<br /> } catch (error) {<br /> alert("Error: " + error.message);<br /> }<br />}<br /><br /><br />&lt;/script&gt;<br />&lt;title&gt;Pub/Sub with Nirvana JavaScript&lt;/title&gt;<br />&lt;/head&gt;<br /><br />&lt;body onload="isLoaded()"&gt;<br />&lt;h1&gt;Nirvana : Pub/Sub with Java to JavaScript Bridge&lt;/h1&gt;<br />&lt;applet<br /> codebase = "/jars/"<br /> archive = "nClient.jar,nSigned.jar,nApplet.jar"<br /> code = "com.pcbsys.nirvana.client.jscript.NirvanaAppletThreaded.class"<br /> id = "nirvana"<br /> name = "nirvana"<br /> MAYSCRIPT<br /> width = "0"<br /> height = "0"<br /> hspace = "0"<br /> vspace = "0"<br /> align = "bottom"<br />&gt;<br />&lt;/applet&gt;<br /><br /><br />&lt;form onsubmit="publishMessage(); return false;"&gt;<br /><br /> &lt;h2&gt;Input&lt;/h2&gt;<br /> &lt;input type="text" id="demoInput"/&gt;<br /> &lt;input type="submit" value="Publish"&gt;<br /><br /> &lt;h2&gt;Output&lt;/h2&gt;<br /> &lt;textarea id="outputTextarea" rows="10" cols="70"&gt;&lt;/textarea&gt;<br /><br />&lt;/form&gt;<br /><br />&lt;/body&gt;<br />&lt;/html&gt;</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright © 2013-2022&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>