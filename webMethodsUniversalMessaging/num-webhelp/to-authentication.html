<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Authentication Overview</title><link rel="Prev" href="to-header_authentication.html" title="Previous" /><link rel="Next" href="co-server_authentication.html" title="Next" /><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_universal_messaging_docset_reverb_diba2_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/num-webhelp/to-authentication.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="ptj3v3Nifx47eqr3c94WnEA" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/num-webhelp/to-authentication.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>Universal Messaging</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-title_concepts.html#wwconnect_header">Concepts</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-header_security.html#wwconnect_header">Security</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../num-webhelp/to-header_authentication.html#wwconnect_header">Authentication</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Authentication Overview</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0EBLMO" class="Heading_3">Authentication Overview</div><div id="wwID0EJLMO" class="Body">While distributed applications offer many benefits to their users the development of such applications can be a complex process. The ability to correctly authenticate users has been a complex issue and has lead to the emergence of standard Authentication and Authorization frameworks, frameworks such as JAAS.</div><div id="wwID0EOLMO" class="Body">JAAS authentication is performed in a pluggable fashion. This permits applications to remain independent from underlying authentication technologies. New or updated authentication technologies can be plugged under an application without requiring modifications to the application itself.</div><div id="wwID0ETLMO" class="Body">Universal Messaging provides a wide variety of client APIs to develop enterprise, web and mobile applications. On the enterprise application front, Universal Messaging offers a transport protocol dependent authentication scheme while on the web and mobile application front a pluggable authentication framework is offered. The end result is that all applications can share the same Universal Messaging authorization scheme which requires a token@host based subject that access control lists can be defined upon.</div><div id="wwID0E6LMO" class="Section_Title">Enterprise Application Authentication</div><div id="wwID0EEMMO" class="Body">Universal Messaging enterprise applications can be written in a variety of programming languages. Each one of these client APIs offers connectivity using one of the 4 available transport protocols, namely nsp (TCP Sockets), nhp (HTTP), nsps (SSL Sockets) and nhps (HTTPS). The authentication scheme is transport protocol dependent therefore providing a basic authentication scheme for TCP based transport protocols (nsp, nhp) and an SSL authentication scheme for SSL based transport protocols (nsps, nhps).</div><div id="wwID0ERMMO" class="Section_Title">Basic Authentication Scheme</div><div id="wwID0EWMMO" class="Body">Under this mode of authentication the client passes the username to the server as part of the initial connection handshake. The server then extracts the remote host name and creates the subject to be used by this connection.</div><div id="wwID0E2MMO" class="Body">The client API can set the username component, however, the remote host is always set on the server. This stops clients from impersonating users from other hosts. The following diagram illustrates the basic authentication scheme's operation:</div><div class="ww_skin_page_overflow"><div id="wwID0EANMO" class="Body"><img class="ScaleFit" src="../num-webhelp/images/basicauth.png" width="100%" style="display: inline; float: none; left: 0pt; max-height: 386px; max-width: 686px; top: 0pt" alt="" /></div></div><div id="wwID0EVNMO" class="Section_Title">SSL Authentication Scheme</div><div id="wwID0E1NMO" class="Body">The Universal Messaging Realm server can be configured to perform Client Certificate authorization or to allow anonymous SSL clients to connect. When the server is configured to allow anonymous clients to connect the subject is built up based on the previous authentication method. That is the username portion is passed to it from the client.</div><div id="wwID0E6NMO" class="Body">When the server is configured for client certificate processing the subject is constructed with the Common Name (CN) of the certificate and the remote host name. This allows the ACLs to be configured such that not only is the certificate valid but it can only access the Realm Server from a specific host. The following diagram illustrates the SSL authentication scheme's operation when using client certificates:</div><div class="ww_skin_page_overflow"><div id="wwID0EEOMO" class="Body"><img class="ScaleFit" src="../num-webhelp/images/sslauth.png" width="100%" style="display: inline; float: none; left: 0pt; max-height: 422px; max-width: 686px; top: 0pt" alt="" /></div></div><div id="wwID0EZOMO" class="Section_Title">Web Application Authentication</div><div id="wwID0E5OMO" class="Body">Universal Messaging web applications can use a pluggable authentication framework that presents its self as basic http authentication as defined by RFC 1945. Basic authentication is supported by all popular web browsers and users have to enter a username and password in a browser provided login dialog before proceeding. The web browser then automatically includes the token in the Authorization HTTP header for all subsequent requests to the server's authentication realm, for the lifetime of the browser process. Please note that although Universal Messaging supports basic authentication on both nhp (HTTP) and nhps (HTTPS) interfaces, it is only advised to use it over HTTPS connections to secure your web application against man in the middle attacks and network sniffing tools.</div><div id="wwID0EDPMO" class="Body">In order to host your web application on Universal Messaging, a number of server side plugins are provided that you can configure and mount on the various URLs that your application expects connections on. These are the XML plugin, the Servlet plugin, the File plugin, the REST plugin and the Proxy Pass Through plugin.</div><div id="wwID0EQPMO" class="Section_Title">Plugin Authentication Parameters</div><div id="wwID0EVPMO" class="Body">Each one of these plugins contains an identical set of configuration parameters that control its behavior towards authentication. These are described below:</div><div id="wwID0EAQMO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">Security Realm:</span> Name of the authentication realm</div><div id="wwID0EXQMO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">AddUserAsCookie:</span> Specifies if the authenticated username should be added as a cookie.</div><div id="wwID0EORMO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">Authenticator:</span> Fully qualified class name of authenticator to use, or blank to use the default implementation provided.</div><div id="wwID0EFSMO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">AuthParameters:</span> A space delimited list of key=value definitions which are passed to the authenticator instance to initialize and configure it. These are passed to the Authenticator's init method.</div><div id="wwID0E3SMO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">GroupNames:</span> An optional comma separated list of groups. The user must be a member of at least one group to be granted access even if a valid username/password is provided. The groups are dependent on the authenticator implementation.</div><div id="wwID0ETTMO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">RoleNames:</span> An optional comma separated list of roles. The user must have at least one role to be granted access even if a valid username/password is provided. The roles are dependent on the authenticator implementation and are effectively the permissions defined.</div><div id="wwID0EKUMO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">ReloadUserFileDynamically:</span> If set to true, the reload method of the authenticator implementation will be called prior to serving each http request. If set to false, the reload will only be called once when the Universal Messaging interface starts.</div><div id="wwID0EKVMO" class="Section_Title">Common AuthParameters</div><div id="wwID0EPVMO" class="Body">Irrespective of the authenticator implementation you use in your Universal Messaging server plugins, there are some AuthParameters that are also used by the server. These are:</div><div id="wwID0E1VMO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">NamedInstance:</span> This parameter requests that this authenticator configuration is bound to the specified named instance which will be shared across all plugins on this server that are configured to do so. Please note that the first plugin that accepts a connection will bind the name to the server together with the remaining configuration parameters. For this reason please make sure that configuration is always the same on all plugins that share the same instance.</div><div id="wwID0E1WMO" class="Section_Title">Default Authenticator Implementation</div><div id="wwID0E6WMO" class="Body">Universal Messaging comes with a default authenticator implementation that uses a properties file to define users, groups and permissions (roles). In order to enable it on a Universal Messaging plugin, the Authenticator parameter needs to be left empty (this implies using the Default), the Authentication Realm set and one parameter needs to be set in AuthParameters.</div><div id="wwID0EEXMO" class="Body">The necessary parameter is called UserFile and should point to the full path of a java properties file, e.g. c:\users.txt. In order to get the Universal Messaging realm server to encrypt your user passwords, you need to add a property called initialize as shown below. This notifies the default authenticator that passwords are not encrypted so on the first load it will encrypt them, remove the initialize property and save your user file.</div><div id="wwID0EJXMO" class="Body">An example of a UserFile defining 3 permissions (roles), 3 groups and 3 users is shown below:</div><div id="wwID0EOXMO" class="Preformatted"><br />        #Request password initialisation<br />        initialise=true<br /><br />        #Permissions (Roles) Definition<br />        perm_name_1=Guest<br />        perm_name_2=User<br />        perm_name_3=Admin<br /><br />        #Guests Group Definition<br />        group_ID_Guests=1<br />        group_desc_Guests=Guests Group<br />        group_perm_Guests={1}<br /><br /><br />        #Users Group Definition<br />        group_ID_Users=2<br />        group_desc_Users=Users Group<br />        group_perm_Users={2}<br /><br /><br />        #Admins Group Definition<br />        group_ID_Admins=3<br />        group_desc_Admins=Admins Group<br />        group_perm_Admins={3}<br /><br /><br />        #Example Guest User Definition<br />        user_desc_someguest=Some Guest User<br />        user_pass_someguest=password<br />        user_perm_someguest={1}<br />        user_home_id_someguest=Guests<br />        user_group_someguest=Guests<br /><br />        #Example Regular User Definition<br />        user_desc_someuser=Some User<br />        user_pass_someuser=password<br />        user_perm_someuser={1,2}<br />        user_home_id_someuser=Users<br />        user_group_someuser=Users<br />        user_group_0_someuser=Guests<br /><br />        #Example Admin User Definition<br />        user_desc_someadmin=Some Admin User<br />        user_pass_someadmin=password<br />        user_perm_someadmin={1,2,3}<br />        user_home_id_someadmin=Admins<br />        user_group_someadmin=Admins<br />        user_group_0_someadmin=Guests<br />        user_group_1_someadmin=Users<br /><br /><br /></div><div id="wwID0E3XMO" class="Section_Title">Custom Authenticator Implementations</div><div id="wwID0EBYMO" class="Body">The interface for creation of custom authenticator implementations is defined in the following 3 classes of the com.pcbsys.foundation.authentication package:</div><div id="wwID0EGYMO" class="Preformatted"><br />fAuthenticator: Represents the Authenticator Implementation and <br />                has the following methods<br /><br />public void init(Hashtable initParams);<br /><br />public String getName();<br /><br />public synchronized void close();<br /><br />public void reload();<br /><br />public fPermission addPermission(int permNo, String name) ;<br /><br />public fUser addUser(String username, String description, String plainPassword,<br />       String groupName);<br /><br />public fUser copyUser(fUser user) ;<br /><br />public fUser getUser(String username);<br /><br />public void delUser(fUser user);<br /><br />public fGroup addGroup(int id, String name, String description);<br /><br />public fPermission getPermission(int id);<br /><br />public fPermission getPermission(String name);<br /><br />public fGroup getGroup(String name);<br /><br />public void delPermission(int id);<br /><br />public void delGroup(fGroup group);<br /><br />public void saveState() throws IOException<br /><br /><br />fGroup: Represents the user groups and contains the following methods:<br /><br />public void reload(int id, String name, String description);<br /><br />public boolean isModified();<br /><br />public void setModified(boolean flag);<br /><br />public String getName();<br /><br />public int getId();<br /><br />public String getDescription();<br /><br />public BitSet getPermissions();<br /><br />public void addUser(fUser aUser);<br /><br />public Enumeration getUsers();<br /><br />public Hashtable getUserHash();<br /><br />public void setUserHash(Hashtable newhash);<br /><br />public void delUser(fUser aUser);<br /><br />public int getNoUsers();<br /><br />public void setPermission(fPermission perm);<br /><br />public void clearPermission(fPermission perm);<br /><br />public void resetPermission();<br /><br />public BitSet getPermissionBitSet();<br /><br />public boolean can(fPermission perm);<br /><br />fUser : Represents the authentication users and has the following methods:<br /><br />public void reload(String name, String description, String password, <br />       fGroup group);<br /><br />public void createUser(String name, String description, String password, <br />       fGroup group) ;<br /><br />public void setPassword(String pass);<br /><br />public BitSet getPermissions();<br /><br />public BitSet getTotalPermissions();<br /><br />public boolean can(fPermission perm);<br /><br />public String login(byte[] password, boolean requestToken, Hashtable params);<br /><br />public String login(String password, boolean requestToken, Hashtable params);<br /><br />public String getHomeId();<br /><br />public void setHomeId(String myHomeId);<br /><br />public void setGroup(fGroup group);<br /><br />public void delGroup(fGroup group);<br /><br />public String getName();<br /><br />public String getDescription();<br /><br />public String getPassword();<br /><br />public fGroup getGroup();<br /><br />public Enumeration getGroups();<br /><br />public Hashtable getGroupHash();<br /><br />public void setGroupHash(Hashtable newhash);<br /><br />public int getNumGroups();<br /><br />public void setPermission(fPermission perm);<br /><br />public void setDescription(String desc);<br /><br />public void clearPermission(fPermission perm);<br /><br />public void setPermissionBitSet(BitSet newperms);<br /><br />public BitSet getPermissionBitSet();<br /><br />public void resetPermission();<br /><br />public boolean isModified();<br /><br />public void setModified(boolean flag);<br /><br /></div><div id="wwID0EUYMO" class="Section_Title">Example Database Authenticator</div><div id="wwID0EZYMO" class="Body">As discussed in the previous section the default implementation is based on an optionally encrypted text file, with passwords being MD5 digested. It is however possible to use different storage mechanisms for users, groups and permissions such as a relational database. There are no restrictions on the design of the database schema as Universal Messaging simply needs a set of classes that comply to the fAuthenticator, fGroup and fUser interfaces. Please note that not all classes need to be subclassed but only the ones that you need to modify the default behaviour.</div><div id="wwID0E5YMO" class="Body">In the context of this example we are going to use a mysql database running on localhost and containing a users table with the following columns:</div><div id="wwID0EJZMO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="Quote">Name</span>: varchar</div><div id="wwID0EA1MO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="Quote">Password</span>: varchar</div><div id="wwID0EX1MO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="Quote">Rights</span>: int</div><div id="wwID0EO2MO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="Quote">Home</span>: varchar</div><div id="wwID0EG3MO" class="Body">In order to keep the example simple we are going to statically define the groups and permissions within the authenticator source code. We will use the group functionality on the base fGroup class and therefore will only subclass fAuthenticator and fUser as shown below:</div><div id="wwID0ET3MO" class="Section_Title">DBAuthenticator</div><div id="wwID0EY3MO" class="Preformatted">package com.myapp;<br />import com.pcbsys.foundation.authentication.*;<br />import com.pcbsys.nirvana.client.*;<br />import com.mysql.jdbc.Driver;<br />import java.io.*;<br />import java.sql.Connection;<br />import java.sql.SQLException;<br />import java.sql.DriverManager;<br />import java.util.Date;<br />import java.util.Enumeration;<br />import java.util.Hashtable;<br />import java.util.Vector;<br /><br />public class DBAuthenticator extends fAuthenticator {<br />  private static fGroup MYAPP_GROUP =null;<br />  private static fGroup MYCOMPANY_GROUP =null;<br /><br />  protected static fPermission CLIENT_PERMISSION=null;<br />  protected static fPermission ADMIN_PERMISSION=null;<br />  private static fPermission GUEST_PERMISSION=null;<br /><br />  private boolean initialised=false;<br />  private String myName="DBAuthenticator";<br />  private static int myUniqueID=0;<br />  private static Connection myConnection;<br />  private static String jdbcurl = "jdbc:mysql://localhost:3306/test";<br />  private static String myDBUser="root";<br />  private static String myDBPassword="";<br />    //Lets statically define the groups and permissions<br />    static {<br />        //Company Group<br />        MYCOMPANY_GROUP =new fGroup();<br />        MYCOMPANY_GROUP.reload(2,"mycompany", "MyCompany Group");<br />        //Application Group<br />        MYAPP_GROUP =new fGroup();<br />        MYAPP_GROUP.reload(0,"mycompany/myapp", "MyApp Group");<br />        GUEST_PERMISSION=new fPermission();<br />        GUEST_PERMISSION.reload(0,"Guest");<br />        CLIENT_PERMISSION=new fPermission();<br />        CLIENT_PERMISSION.reload(1,"Client");<br />        ADMIN_PERMISSION=new fPermission();<br />        ADMIN_PERMISSION.reload(4,"Admin");<br />    }<br />  public void close(){<br />    super.close();<br />    if(getUsageCount() == 0){<br />        fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />           "Closing Authenticator ["+getUsageCount()+"]");<br />        //release connection pool<br />        if (myConnection!=null){<br />            try {<br />                myConnection.close();<br />            } catch (SQLException e) {}<br />            myConnection=null;<br />        }<br />        initialised=false;<br />    }<br />    else {<br />        fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />           "Closing Authenticator ["+getUsageCount()+"]");<br />    }<br />  }<br /><br /><br />  public DBAuthenticator() {<br />    super();<br />    addGroup(MYCOMPANY_GROUP);<br />    addGroup(MYAPP_GROUP);<br />    getPermissionsCollection().put("Client", CLIENT_PERMISSION);<br />    getPermissionsCollection().put("Admin", ADMIN_PERMISSION);<br />    getPermissionsCollection().put("Guest", GUEST_PERMISSION);<br /><br />  }<br />  protected static Connection getDBConnection() throws SQLException{<br />      if (myConnection==null){<br />        try {<br />            Class.forName("com.mysql.jdbc.Driver").newInstance();<br />            myConnection = DriverManager.getConnection(jdbcurl,myDBUser, <br />                           myDBPassword);<br />        } catch (InstantiationException e) {<br />            e.printStackTrace();  <br />            //To change body of catch statement use <br />            // File | Settings | File Templates.<br />        } catch (IllegalAccessException e) {<br />            e.printStackTrace();  <br />            //To change body of catch statement use <br />            //File | Settings | File Templates.<br />        } catch (ClassNotFoundException e) {<br />            e.printStackTrace();  <br />           //To change body of catch statement use <br />           // File | Settings | File Templates.<br />        }<br />        <br />      }<br />    return myConnection;<br />  }<br />    public String getName() {<br />        return myName;<br />    }<br />    private static String getNextId() {<br />        return ""+myUniqueID++;<br />    }<br />    public void init(Hashtable initParams) throws IOException {<br />        if (!initialised){<br />            if (initParams.containsKey("NamedInstance")){<br />                    myName=(String)initParams.get("NamedInstance");<br />                }<br />                else {<br />                    myName=myName+"_"+getNextId();<br />                    fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />                       "Default Instance Requested ");<br />                }<br />                if (initParams.get("DBUser")!=null){<br />                    myDBUser=(String)initParams.get("DBUser");<br />                }<br />                if (initParams.get("DBPassword")!=null){<br />                    myDBPassword=(String)initParams.get("DBPassword");<br />                }<br />                if (initParams.get("JDBCURL")!=null){<br />                    jdbcurl=(String)initParams.get("JDBCURL");<br />                }<br />                initialised=true;<br />            }<br />    }<br /><br />    private DBUser createDBUserInstance(String username, String description, <br />          String password, int permissions, int home){<br />        DBUser someuser=new DBUser();<br />        someuser.setAuthenticator(this);<br />        if (home==1){ //MyCompany/MyApp Users<br />           someuser.reload(username,description,password, MYAPP_GROUP);<br />           //Set home<br />           someuser.setHomeId(MYAPP_GROUP.getName());<br />           //Group association logic<br />           someuser.setGroup(MYAPP_GROUP);<br />           //Set outer group<br />           someuser.setGroup(MYCOMPANY_GROUP);<br />           MYCOMPANY_GROUP.addUser(someuser);<br />           //Set inner group<br />           MYAPP_GROUP.addUser(someuser);<br />           //Permissions association logic<br />           switch (permissions){<br />                case 1:<br />                    someuser.setPermission(CLIENT_PERMISSION);<br />                    break;<br />                case 10:<br />                    someuser.setPermission(ADMIN_PERMISSION);<br />                    break;<br />                default:{<br />                    someuser.setPermission(GUEST_PERMISSION);<br />                    break;<br />                }<br />            }<br />        }<br />        else {<br />            fAuthenticator.logAuthenticatorMessage("WARNING: User "+username+<br />             " has a home value of "+home+". User will be ignored!");<br />            return null;<br />        }<br />        return someuser;<br />    }<br /><br />    private DBUser LoadUserFromDatabase(String username){<br />        DBUser someuser=null;<br />        Connection conn =null;<br />        java.sql.Statement stmt = null;<br />        java.sql.ResultSet rset=null;<br />        String name=null;<br />        try{<br />        conn=getDBConnection();<br />        stmt = conn.createStatement();<br />        rset = stmt.executeQuery(<br />            "select name,password, rights,home from USERS where name='"+<br />               username.toLowerCase()+"'" );<br />            while(rset.next())<br />            {<br />               int permissions= rset.getInt("RIGHTS");<br />               int home = rset.getInt("HOME"); // home desk association<br />               name=rset.getString("name").toLowerCase();<br />               String password=rset.getString("password");<br />               if (password==null || password.trim().length()==0 ||<br />                   password.equals("null")) password="nopassword";<br />               String description="A "+name+" user"; <br />                  //safeguard for users without a description!<br />               someuser=createDBUserInstance(name,description,password,<br />                   permissions,home);<br />               if (someuser==null) continue; <br />                //In case we have invalid data to create this user object<br />                //Cache instance<br />                getUsersCollection().put(someuser.getName(),someuser);<br />            }<br />            rset.close();<br />            rset=null;<br />            stmt.close();<br />            stmt=null;<br />       <br />        }<br />        catch (Throwable t){<br />            logAuthenticatorException(<br />                "DBAuthenticator: Error obtaining details for user "+name);<br />            logAuthenticatorException(t);<br />            t.printStackTrace();<br />        }<br />        finally {<br />            if (rset!=null){<br />                try {<br />                    rset.close();<br />                } catch (SQLException e) {<br />                }<br />                rset=null;<br />            }<br />            if (stmt!=null){<br />                try {<br />                    stmt.close();<br />                } catch (SQLException e) {<br />                }<br />                stmt=null;<br />            }<br />         <br />        }<br />        return someuser;<br />    }<br />    private void LoadUsersFromDatabase(){<br />        Connection conn =null;<br />        java.sql.Statement stmt=null;<br />        java.sql.ResultSet rset=null;<br />        String name=null;<br />        try{<br />        conn=getDBConnection();<br />            stmt = conn.createStatement();<br />            rset = stmt.executeQuery(<br />                 "select name,password, rights,home from USERS order by name" );<br />            while(rset.next())<br />            {<br />               int rights= rset.getInt("RIGHTS");<br />               int home = rset.getInt("HOME"); // home desk association<br />               name=rset.getString("name").toLowerCase();<br />               String password=rset.getString("password");<br />               if (password==null || password.trim().length()==0 ||<br />                   password.equals("null")) password="nopassword";<br />               String description="A "+name+" user";<br />               DBUser someuser=createDBUserInstance(name,description,password,<br />                  rights,home);<br />               if (someuser==null) continue; <br />               getUsersCollection().put(someuser.getName(),someuser);<br />            }<br />            rset.close();<br />            rset=null;<br />            stmt.close();<br />            stmt=null;<br />        }<br />        catch (Throwable t){<br />            logAuthenticatorException("Error obtaining details for user "+name);<br />            logAuthenticatorException(t);<br />            t.printStackTrace();<br />        }<br />        finally {<br />            if (rset!=null){<br />                try {<br />                    rset.close();<br />                } catch (SQLException e) {<br />                }<br />                rset=null;<br />            }<br />            if (stmt!=null){<br />                try {<br />                    stmt.close();<br />                } catch (SQLException e) {<br />                }<br />                stmt=null;<br />            }<br />        }<br />    }<br /><br />    public void reload() throws IOException {<br />        LoadUsersFromDatabase();<br />        fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />           "Reload called");<br />    }<br />    /**<br />     * Creates a new fPermission with the unique ID and name supplied.<br />     * <br />     * The implementation should save the new permission to the relevant <br />     * technology used.<br />     *<br />     * @param permNo Unique ID from 0 to 63.<br />     * @param name   Name describing this new permission.<br />     * @return the new fPermission.<br />     * @throws java.io.IOException If unable to create the new fPermission.<br />     */<br />    public fPermission addPermission(int permNo, String name) throws <br />         IOException {<br />    if(getPermissionsCollection().get(""+permNo) == null){<br />      fPermission perm = new fPermission();<br />      perm.reload(permNo,name);<br />      getPermissionsCollection().put(""+permNo, perm);<br />      return perm;<br />    }<br />    fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />        "Added Permission "+name+"("+permNo+")");<br />    return (fPermission) super.getPermissionsCollection().get(""+permNo);<br />    }<br /><br />    public fUser addUser(String username, String description, <br />         String plainPassword, String groupName) throws IOException {<br />    fGroup group = null;<br />    if (groupName != null) {<br />      group = (fGroup) getGroupsCollection().get(groupName);<br />      if (group == null) throw new IOException("No known group " + groupName);<br />    }<br />    fUser user = createUser(username, description, plainPassword, group);<br />    getUsersCollection().put(user.getName(), user);<br />    if(group != null) group.addUser(user);<br />    fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+"Added User "+<br />         username+" NOTE: This is not currently persisted in the database!");<br />    return user;<br />    }<br />    /**<br />     * Creates a new fUser with the supplied values.<br />     * The password field is passed as plain text but it is up to the <br />     * implementation to ensure the password<br />     * is secure.<br />     * <br />     * The implementation should save the new user to the relevant <br />     * technology used.<br />     *<br />     * @param user The user to copy.<br />     * @return The new fUser created.<br />     * @throws java.io.IOException If there where any errors during the <br />     * construction of the user.<br />     */<br />    public fUser copyUser(fUser user) throws IOException {<br />        fGroup group = null;<br />        group = (fGroup) getGroupsCollection().get(user.getGroup().getName());<br />        fUser aUser = createUser(user.getName(),user.getDescription(),<br />           user.getPassword(),user.getGroup());<br />        getUsersCollection().put(aUser.getName(), aUser);<br />        if(group != null) group.addUser(aUser);<br />        fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />            "Copied User "+user.getName());<br />        return aUser;<br />    }<br />    /**<br />     * Adds a new group with the supplied values.<br />     * <br />     * The implementation should save the new group to the relevant <br />     * technology used.<br />     *<br />     * @param id          Unique ID for the group.<br />     * @param name        Name of the new group.<br />     * @param description Description of the new group.<br />     * @return The new fGroup object.<br />     * @throws java.io.IOException If unable to create the new fGroup object.<br />     */<br />    public fGroup addGroup(int id, String name, String description) throws <br />          IOException {<br />        fGroup group = new fGroup();<br />        group.reload(id, name, description);<br />        addGroup(group);<br />        fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />            "Added Group "+group.getName());<br />        return group;<br />    }<br />    /**<br />     * Returns the permission with the ID supplied or null if not found.<br />     *<br />     * @param id fPermission Id to search for.<br />     * @return the fPermission or null if not found.<br />     */<br />    public fPermission getPermission(int id) {<br />      Enumeration perms = getPermissionsCollection().elements();<br />      while (perms.hasMoreElements()) {<br />        fPermission fPermission = (fPermission) perms.nextElement();<br />        if (fPermission.getId() == id) return fPermission;<br />      }<br />      return null;<br />    }<br />    /**<br />     * Returns the permission with the name supplied or null if not found.<br />     *<br />     * @param name fPermission name to search for.<br />     * @return the fPermission or null if not found.<br />     */<br />    public fPermission getPermission(String name) {<br />        return (fPermission)getPermissionsCollection().get(name);  <br />    }<br /><br />   public Enumeration getUsers(){<br />       return  getUsersCollection().elements();<br />   }<br /><br />    public fUser getUser(String username) {<br />      return (fUser) LoadUserFromDatabase(username.toLowerCase());<br />    }<br />    public fGroup getGroup(String name) {<br />        return (fGroup)getGroupsCollection().get(name);<br />    }<br />    /**<br />     * Removes the permission with the ID supplied.<br />     * <br />     * The implementation should remove the permission from the relevant <br />     * technology used.<br />     *<br />     * @param id of the permission to delete.<br />     * @throws java.io.IOException if unable to delete the permission.<br />     */<br />    public void delPermission(int id) throws IOException {<br />    getPermissionsCollection().remove(""+id);<br />      fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />         "Deleted permission ("+id+")");<br />    }<br /><br />    /**<br />     * Removes the user supplied.<br />     * <br />     * The implementation should remove the user from the relevant <br />     * technology used.<br />     *<br />     * @param user fUser object to remove.<br />     * @throws java.io.IOException If unable to remove the user.<br />     */<br />    public void delUser(fUser user) throws IOException {<br />    if (user.getGroup() != null) {<br />      user.getGroup().delUser(user);<br />    }<br />    getUsersCollection().remove(user.getName());<br />      fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />         "Deleted User "+user.getName());<br />    }<br />    /**<br />     * Removes the supplied fGroup object.<br />     * <br />     * Any user currently a member of this group will have the group reset <br />     * to null meaning no group membership.<br />     * <br />     * The implementation should remove the group from the relevant <br />     * technology used.<br />     *<br />     * @param group Group to remove.<br />     * @throws java.io.IOException If unable to remove the group.<br />     */<br />    public void delGroup(fGroup group) throws IOException {<br />        Enumeration enm = group.getUsers();<br />        while (enm.hasMoreElements()) {<br />          fUser user = (fUser) enm.nextElement();<br />          user.delGroup(group);<br />        }<br />        getGroupsCollection().remove(group.getName());<br />        fAuthenticator.logAuthenticatorMessage("{"+getName()+"} "+<br />            "Deleted Group "+group.getName());<br />    }<br />    /**<br />     * Requests that the implementation save the current state.<br />     * <br />     * This should include all users, groups and permissions.<br />     *<br />     * @throws java.io.IOException if the save failed.<br />     */<br />    public void saveState() throws IOException {<br />       //TODO: Implement saving of data to the database<br />    }<br />    public void roll() throws IOException {<br />        //TODO: Implement any log file rolling<br />    }<br />    protected fUser createUser(String name, String desc, String password, <br />        fGroup group){<br />      //  System.out.println("CreateUSer being called");<br />      DBUser usr = new DBUser();<br />      usr.reload(name, desc, password, group);<br />      usr.setHomeId(group.getName());<br />      usr.setAuthenticator(this);<br />      return usr;<br />    }<br />}</div><div id="wwID0EG4MO" class="Section_Title">DBUser</div><div id="wwID0EL4MO" class="Preformatted">package com.myapp;<br /><br />import com.pcbsys.foundation.authentication.fUser;<br />import com.pcbsys.foundation.authentication.fGroup;<br />import com.pcbsys.foundation.authentication.fAuthenticator;<br /><br />import java.util.Hashtable;<br />import java.sql.SQLException;<br /><br />public class DBUser extends fUser {<br />  private static fAuthenticator myAuthenticator;<br />  protected DBUser(){<br />    super();<br />    super.setGroupHash(new Hashtable());<br />  }<br />  //Allow setting a reference to the authenticator instance so that we can<br />  // obtain its DB connection for<br />  //  user authentication purposes<br />  public static void setAuthenticator (fAuthenticator authenticator){<br />      myAuthenticator=authenticator;<br />  }<br /><br /> protected DBUser(String name, String desc, String password){<br />    this(name, desc, password, null);<br />  }<br />  protected DBUser(String name, String desc, String password, fGroup group){<br />    super(name,desc,password,group);<br />  }<br /><br /> public String login(byte[] password, boolean requestToken){<br />     return login(password,requestToken,null);<br /> }<br />public String login(String password, boolean requestToken){<br />    return login(password,requestToken,null);<br />}<br /> public String login(byte[] password, boolean requestToken, Hashtable params){<br />   return login(new String(password), requestToken, params);<br />  }<br /> public String login(String password, boolean requestToken, Hashtable params){<br /><br />        java.sql.Connection conn =null;<br />        java.sql.Statement stmt=null;<br />        java.sql.ResultSet rset=null;<br />        String name=null;<br />        try{<br />        conn=((DBAuthenticator)myAuthenticator).getDBConnection();<br />        stmt = conn.createStatement();<br />        rset = stmt.executeQuery(<br />            "select password, rights from USERS where name ='"+<br />            this.getName()+"'" );<br />            while(rset.next())<br />            {<br />               int rights= rset.getInt("RIGHTS");<br />               String thepassword=rset.getString("password");<br />               if (thepassword.equals(password)){<br />                   if (rights &gt; 0) return "true";<br />               }<br />            }<br />            rset.close();<br />            rset=null;<br />            stmt.close();<br />            stmt=null;<br />        <br />        }<br />        catch (Throwable t){<br />            myAuthenticator.logAuthenticatorException(<br />               "DBAuthenticator: Error obtaining details for user "+name);<br />            myAuthenticator.logAuthenticatorException(t);<br />        }<br />        finally {<br />            if (rset!=null){<br />                try {<br />                    rset.close();<br />                } catch (SQLException e) {<br />                }<br />                rset=null;<br />            }<br />            if (stmt!=null){<br />                try {<br />                    stmt.close();<br />                } catch (SQLException e) {<br />                }<br />                stmt=null;<br />            }<br />     <br />        }<br />     return null;<br />  }<br />}</div><div id="wwID0EZ4MO" class="Section_Title">Web Application Single Sign On</div><div id="wwID0E54MO" class="Body">Single sign-on (SSO) is a method of access control that enables a user to log in once and gain access to the required application and its resources without being prompted to log in again.When developing multi node Universal Messaging web applications, you have to take into consideration that incidents such a network failure, could cause the user's browser to fail over to a different node than the one initially authenticated with. In order to prevent the application user from authenticating again, or to integrate your Universal Messaging web application to a 3d party authentication mechanism and provide alternative authentication user interfaces, you can use Single Sign On Interceptors (SSI).</div><div id="wwID0ED5MO" class="Body">A Single Sign On Interceptor (SSI) is a class that conforms to a specific interface and gets invoked by the Universal Messaging realm prior to authentication in order to decide which of the following 3 outcomes should occur:</div><div id="wwID0EO5MO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>If the user meets the criteria required, allow access to the plugin content as if they where normally authenticated, optionally generating a unique session id.</div><div id="wwID0EB6MO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>If the user does not meet the criteria required, but a redirection is configured, redirect their browsers to the specified URL in order to authenticate.</div><div id="wwID0EU6MO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>If the user does not meet the criteria required, and no redirection is configured, then fall back to the regular authenticator configured.</div><div id="wwID0EIANO" class="Body">The interface for creation of a nirvana SSI implementations is defined in the following 2 classes of the com.pcbsys.foundation.authentication package:</div><div id="wwID0ES4MO-10" class="Section">fSSInterceptor</div><div id="wwID0ENANO" class="Preformatted"><br />//Return an fSSUser with a null username to fall back to authenticator <br />// (or redirect if a URL is set)<br />public abstract fSSUser getSSUser(Hashtable httpHeaders, <br />       Hashtable urlParameters);<br /><br />public abstract void setParameters(Hashtable params);<br /><br />public abstract void clear();<br /><br />public abstract String getName();<br /></div><div id="wwID0ES4MO-12" class="Section">fSSUser</div><div id="wwID0ETANO" class="Preformatted"><br />public fSSUser(String username, String redirectURL);<br /><br />public fSSUser(String username, String redirectURL, String token);<br /><br />public String getUsername();<br /><br />public String getRedirectURL();<br /><br />public String getToken()<br /><br /></div><div id="wwID0EBBNO" class="Section_Title">Plugin Single Sign On Interceptor Parameters</div><div id="wwID0EMBNO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="apiname">SSInterceptor:</span> Fully qualified class name of SSI to use. If not specified, no interceptor will be used</div><div id="wwID0EDCNO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="apiname">SSOAppendToken:</span> Setting this parameter to true instructs the SSI object to generate and return a unique session ID when an affirmative single sign on decision is reached. Please note that the absence of a session ID is irrelevant to the single sign on decision.</div><div id="wwID0EDDNO" class="Section_Title">Common Single Sign On AuthParameters</div><div id="wwID0EIDNO" class="Body">Irrespective of the Single Sign On implementation you use in your Universal Messaging server plugins, there are some AuthParameters that are also used by the server. These are:</div><div id="wwID0ETDNO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">SSONamedInstance:</span> This optional parameter requests that this SSI object is bound to the specified named instance which will be shared across all plugins on this server that are configured to do so. Please note that the first plugin that accepts a connection will bind the name to the server together with the remaining configuration parameters. For this reason please make sure that configuration is always the same on all plugins that share the same SSI instance.</div><div id="wwID0EKENO" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">REDIRECT_URL:</span> This optional parameter specifies the URL that a web client should be redirected to should the interceptor's criteria are not met. This allows the creation of alternative authentication methods such as form based authentication or others.</div><div id="wwID0EKFNO" class="Section_Title">Mobile Application Authentication</div><div id="wwID0EPFNO" class="Body">When developing Universal Messaging based mobile applications, authentication is dependent on your mobile technology of choice. This is because the Universal Messaging Mobile APIs work exactly like any Universal Messaging enterprise or web API (with the exception of SSL client certificates).</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright © 2013-2022&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>