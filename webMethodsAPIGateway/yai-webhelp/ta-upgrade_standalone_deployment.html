<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Upgrade Standalone Deployment</title><link rel="Prev" href="co-upgrading_minor_version_zero_downtime.html" title="Previous" /><link rel="Next" href="ta-upgrade_cluster_deployments.html" title="Next" /><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/yai-webhelp/ta-upgrade_standalone_deployment.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pf6mhE1HoXkr_002fgoHW5lbn_002fg" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/yai-webhelp/ta-upgrade_standalone_deployment.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>API Gateway</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.801.html#wwconnect_header">Upgrading and Migrating to API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/to-upgrading_apigw_zero_downtime_landing_page.html#wwconnect_header">Upgrading API Gateway in Zero Downtime</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/co-upgrading_minor_version_zero_downtime.html#wwconnect_header">Upgrading Minor Versions in Zero Downtime</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Upgrade Standalone Deployment</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0EG1T4" class="Heading_3">Upgrade Standalone Deployment</div><div id="wwID0E22T4" class="Body"><span class="ph">API Gateway</span> follows the blue-green approach to upgrade a standalone deployment. In such deployment scenario, old instance are allowed to run and serve the transactions while the new <span class="ph">API Gateway</span> version is being prepared. There is no data migration as both the old and new versions would be pointing to the same Elasticsearch or API Data Store. The new <span class="ph">API Gateway</span> version is started and the old instance is blocked for core design time data updates. After that the new node's endpoint is added to the load balancer. At this time the transactions are served by both the old and new versions. Next, all the transactions to the old version is blocked and the logs and events data are migrated to the new version while it is serving the transactions.</div><div id="wwID0EN3T4" class="Body">The following image shows the workflow for a minor upgrade of a standalone <span class="ph">API Gateway</span> instance.</div><div class="ww_skin_page_overflow"><div id="wwID0EX3T4" class="Figure"><img class="ScaleFit" src="../yai-webhelp/images/upgrade_minor_version_standalone.jpg" width="100%" style="display: block; float: none; left: 0pt; max-height: 112px; max-width: 856px; top: 0pt" alt="" /></div></div><div id="wwID0EJ4T4" class="procedure"><span><img src="icon_task_xpe.png" alt="*" border="0" width="20" height="13" /></span>To upgrade <span class="ph">API Gateway</span> minor versions in zero downtime</div><div id="wwID0E14T4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span><span class="Command">Put the old </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> instance in quiesce mode for design time. </span></div><div id="wwID0E55T4" class="Body_1">You must perform this operation on the old <span class="ph">API Gateway</span> instance.</div><div id="wwID0EI6T4" class="Body_1"><span class="ph">API Gateway</span> data in the Elasticsearch or API Data Store is migrated in two phases. In the first phase, only the design time data like APIs, applications, and policies are migrated. The runtime data like audit logs, transaction logs, performance metrics, and so on are migrated in the next phase, that is, after the runtime transactions to the old instances are stopped. This is performed after the new instance is up and running with the new data and runtime traffic is allowed to it.</div><div id="wwID0ER6T4" class="Body_1">Before migrating design time data in the first phase, all the updates to them through UI and REST APIs must be blocked. This can be achieved by using the quiesce mode capability available in <span class="ph">API Gateway</span>.</div><div id="wwID0E26T4" class="Body_1">Run the following request to enable quiesce mode for design time in the old <span class="ph">API Gateway</span> instance.</div><div id="wwID0EEAU4" class="Preformatted_1">PUT /rest/apigateway/quiescemode<br /><br />{<br />    "enable": true,<br />    "block": "designtime"<br />}</div><div id="wwID0ELAU4" class="Body_1">If the invocation is successful, <span class="ph">API Gateway</span> returns 200 OK message.</div><div id="wwID0EVAU4" class="Body_1">Now, all the design time invocations to the old instance are blocked and <span class="ph">API Gateway</span> returns 503 message to the client. Only the following requests are allowed:</div><div id="wwID0EEBU4" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>All GET requests</div><div id="wwID0EXBU4" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>/rest/apigateway/quiescemode</div><div id="wwID0EKCU4" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>/rest/apigateway/search</div><div id="wwID0E4CU4" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>/rest/facade/apigateway/searchApis</div><div id="wwID0ESDU4" class="Body_1">When the quiesce mode for design time is complete, <span class="ph">API Gateway</span> sends out a notification with the result details through registered webhooks. You can also run the following request to check the status of the operation.</div><div id="wwID0E2DU4" class="Preformatted_1">GET rest/apigateway/quiescemode</div><div id="wwID0ECEU4" class="Body_1">A success status message implies that quiesce mode for design time is complete.</div><div id="wwID0EHEU4" class="Body_1">If the quiesce mode for design time request invocation fails with an error or the status returned with a failure, you must stop the execution of the next steps. Disable the quiesce mode for design time in all the nodes and bring them back to normal state. If the error persists, contact Software AG support team for help with all the relevant logs for further analysis.</div><div id="wwID0EOEU4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span><span class="Command">Start the new </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> instance. </span></div><div id="wwID0ENFU4" class="Step_Info_1">You must install the new instance of <span class="ph">API Gateway</span> and perform the following steps:</div><div id="wwID0E4FU4" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span><span class="Command"> As zero downtime upgrade deals only with the migration of Elasticsearch or API Data Store data, the platform configurations and must be migrated to the new </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> instance either manually or using the externalized configurations. </span></div><div id="wwID0EBHU4" class="Body_2">For more information on the platform configurations that must be migrated to the target <span class="ph">API Gateway</span> instance, see 
    <a href="../yai-webhelp/co-upgrading_apigtw.html#wwID0EU1G4"
   
     title="Introduction"
    ><span class="heading-page">Migrating the platform configurations</span></a>.</div><div id="wwID0EWHU4" class="Body_2">You can now start the new <span class="ph">API Gateway</span> instance by connecting it to the old Elasticsearch or API Data Store as an external.</div><div id="wwID0EEIU4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span><span class="Command">Add traffic to the new </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> instance. </span></div><div id="wwID0EIJU4" class="Body_1">After the new <span class="ph">API Gateway</span> instance is restarted, the runtime traffic can be allowed to flow to it. Adding traffic to the new instance depends on the deployment model.</div><div id="wwID0ESJU4" class="Body_1">For example, for on-premise and Docker deployment, it would be an update to load balancer for adding the new endpoints. For Kubernetes deployment, it would be a label change in service resources.</div><div id="wwID0EZJU4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span><span class="Command">Shutdown the old </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> instance. </span></div><div id="wwID0E4KU4" class="Body_1">When the new instance is added to the load balancer, you can shutdown the old instance after all the active client sessions in that node are closed. This ensures that no metrics are sent to any configured destinations like API Portal, external Elasticsearch, and so on. The new instance is now receiving the runtime transactions. You can remove the old instance endpoint from the load balancer.</div><div id="wwID0ECLU4" class="Body_1">You can run the following request to shutdown the old <span class="ph">API Gateway</span> instance.</div><div id="wwID0EMLU4" class="Preformatted_1">POST /rest/apigateway/shutdown<br /><br />{<br />    "bounce": "true/false",<br />    "option": "force/drain",<br />    "timeout": 10,<br />    "quiesce": "true/false"<br />}</div><div id="wwID0ESLU4" class="Body_1">The timeout value depends on the number of active client sessions.</div><div id="wwID0E4LU4" class="Body_1">The <span class="ph">API Gateway</span> upgrade is complete. You can find the logs at the target directory <span class="filepath_002c_varname">&lt;TARGET&gt;</span><span class="filepath">/profiles/IS_</span><span class="filepath_002c_varname">profile name</span><span class="filepath">/logs/wrapper.log</span>.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright Â© 2016-2023&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>