<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Securing APIs using OAuth 2.0 in API Gateway using Third Party Authorization Server</title><link rel="Prev" href="ta-oauth_remote_integration_server.html" title="Previous" /><link rel="Next" href="ta-oauth_secure_apis_external_ports.html" title="Next" /><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/yai-webhelp/ta-oauth_thridparty_oauth_server.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN4Nqy4jtqdEI_002bkRP70nf34w" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/yai-webhelp/ta-oauth_thridparty_oauth_server.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>API Gateway</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.503.html#wwconnect_header">Using API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.535.html#wwconnect_header">Implement APIs</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/gtw_manage_policies.html#wwconnect_header">Policies</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/gtw_iam_policies.html#wwconnect_header">Identify and Access</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/re-iam_identify_authorize_app.html#wwconnect_header">Identify &amp; Authorize</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Securing APIs using OAuth 2.0 in API Gateway using Third Party Authorization Server</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0E3C5X" class="Heading_5">Securing APIs using OAuth 2.0 in API Gateway using Third Party Authorization Server</div><div id="wwID0ELD5X" class="Body">This use case explains with a simple example on how to secure an API using OAuth2 authorization with a third-party OAuth2 identity provider and authorization server (OKTA). Here, the third-party OAuth2 provider acts as the Authorization server and <span class="ph">API Gateway</span> acts as a Resource Server</div><div class="ww_skin_page_overflow"><div id="wwID0EVD5X" class="Figure"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_server.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 225px; max-width: 504px; top: 0pt" alt="Third party oauth server work flow" /></div></div><div id="wwID0ELE5X" class="Section_Title">Actors</div><div id="wwID0EUE5X" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Developers with basic knowledge about <span class="ph">API Gateway</span>, <span class="ph">Integration Server</span>, OAuth2 architecture</div><div id="wwID0ENF5X" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Customers with basic knowledge about <span class="ph">API Gateway</span>, <span class="ph">Integration Server</span>, OAuth2 architecture</div><div id="wwID0EPG5X" class="Section_Title">Before you begin</div><div id="wwID0EUG5X" class="Body">Ensure that you have:</div><div id="wwID0E4G5X" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Created a tenant account in OKTA identity provider management portal</div><div id="wwID0EOH5X" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Installed <span class="ph">Integration Server</span> with <span class="ph">API Gateway</span></div><div id="wwID0EGI5X" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Knowledge about any REST Client</div><div id="wwID0EXI5X" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="ph">API Gateway</span> up and running</div><div id="wwID0ESJ5X" class="Section_Title">Basic Flow</div><div id="wwID0EXJ5X" class="Body">The following diagram depicts the high level steps of the basic flow for this use case.</div><div class="ww_skin_page_overflow"><div id="wwID0E3J5X" class="Figure"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_highlvl_steps.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 171px; max-width: 462px; top: 0pt" alt="Third party oauth server basic flow" /></div></div><div id="wwID0EUK5X" class="Section_Title">Step 1: Configure OKTA as OAuth2 provider</div><div id="wwID0E6K5X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Create Authorization server in OKTA as follows:</div><div id="wwID0EVL5X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Ensure you have a tenant account created in OKTA</div><div id="wwID0EGM5X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Navigate to <span class="uicontrol">API</span> &gt; <span class="uicontrol">Authorization Servers</span></div><div id="wwID0E5M5X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Click <span class="uicontrol">Add Authorization Server</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0ETN5X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta01.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 184px; max-width: 504px; top: 0pt" alt="Add OKTA as oauth server" /></div></div><div id="wwID0EDO5X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Provide the following details:</div><div id="wwID0EXO5X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Name</span>: <span class="userinput">okta-oauth-server</span></div><div id="wwID0EOP5X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Audience</span>: <span class="userinput">Administrator</span></div><div id="wwID0EFQ5X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Description</span>: <span class="userinput">Used for developers tutorial</span></div><div id="wwID0E4Q5X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Click <span class="userinput">Save</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0ESR5X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta02.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 123px; max-width: 286px; top: 0pt" alt="Save oauth server" /></div></div><div id="wwID0EDS5X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Get the Metadata URI.</div><div id="wwID0EWS5X" class="Numbered_1_Continued">After you configure OKTA as OAuth2 provider the metadata URL informaton is available as shown.</div><div class="ww_skin_page_overflow"><div id="wwID0E2S5X" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta03.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 272px; max-width: 504px; top: 0pt" alt="metadata URL" /></div></div><div id="wwID0EKT5X" class="Numbered_1_Continued">Copy the Metadata URI (also known as discovery URL) used to configure External Authorization server in API Gateway.</div><div id="wwID0EOT5X" class="Note_1"><span class="Bold">Note:<br /></span>The same information is available if you click the Edit button for okta-oauth-server.</div><div id="wwID0EEU5X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Get the endpoints.</div><div id="wwID0EXU5X" class="Numbered_1_Continued">Invoke the Metadata URI from the browser and retrieve the endpoints as shown.</div><div class="ww_skin_page_overflow"><div id="wwID0E2U5X" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta04.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 234px; max-width: 504px; top: 0pt" alt="retrieve endpoints" /></div></div><div id="wwID0EMV5X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Create Scopes.</div><div id="wwID0EAW5X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Navigate to <span class="uicontrol">API</span> &gt; <span class="uicontrol">Authorization Servers</span></div><div id="wwID0EYW5X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Click <span class="uicontrol">Edit</span> for okta-oauth-server.</div><div id="wwID0ENX5X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Click <span class="uicontrol">Add Scope</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0ECY5X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta05.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 249px; max-width: 504px; top: 0pt" alt="add scope" /></div></div><div id="wwID0ESY5X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Provide the following information</div><div id="wwID0EGZ5X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Name</span>: <span class="userinput">getscope</span></div><div id="wwID0E4Z5X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Description</span>: <span class="userinput">Used for developers tutorial</span></div><div id="wwID0EU15X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Default Scope</span>: Select <span class="userinput">Set as a default scope</span></div><div id="wwID0EL25X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Metadata</span>: Select <span class="uicontrol">Include in public metadata</span></div><div id="wwID0ED35X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Click <span class="uicontrol">Create</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EY35X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta06.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 325px; max-width: 504px; top: 0pt" alt="create scope" /></div></div><div id="wwID0EH45X" class="Numbered_2_Continued">The scope is now listed under Scopes.</div><div class="ww_skin_page_overflow"><div id="wwID0EL45X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta07.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 152px; max-width: 504px; top: 0pt" alt="scope list" /></div></div><div id="wwID0E445X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Create Access policies</div><div id="wwID0EO55X" class="Numbered_1_Continued">Create access policies and rule in OKTA to avoid accessibility issues while using access token during API invocation.</div><div id="wwID0EW55X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Navigate to <span class="uicontrol">Access Policies</span>.</div><div id="wwID0EL65X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Click <span class="uicontrol">Add Policy</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EAA6X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta08.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 225px; max-width: 504px; top: 0pt" alt="add polcy" /></div></div><div id="wwID0EQA6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Provide the following information:</div><div id="wwID0EEB6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Name</span>: <span class="userinput">okta-oauth-policy</span></div><div id="wwID0E2B6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Description</span>: <span class="userinput">Used for developers tutorials</span></div><div id="wwID0ESC6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Assgn to</span>: Select <span class="uicontrol">All clients</span></div><div class="ww_skin_page_overflow"><div id="wwID0EJD6X" class="Figure_3"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta09.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 198px; max-width: 375px; top: 0pt" alt="Assign to all clients" /></div></div><div id="wwID0E1D6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Click <span class="uicontrol">Add Rule</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EPE6X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta10.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 253px; max-width: 504px; top: 0pt" alt="Add rule" /></div></div><div id="wwID0E6E6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Provide the following information:</div><div id="wwID0ETF6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Rule Name</span>: <span class="userinput">okta-oauth-policy</span></div><div id="wwID0EKG6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Do not change any default settings.</div><div class="ww_skin_page_overflow"><div id="wwID0E2G6X" class="Figure_3"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta11.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 596px; max-width: 504px; top: 0pt" alt="Rule details" /></div></div><div id="wwID0EMH6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>f. </span></span>Click <span class="uicontrol">Create Rule</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EBI6X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta12.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 284px; max-width: 504px; top: 0pt" alt="Create rule" /></div></div><div id="wwID0ESI6X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Create <span class="uicontrol">Token</span>.</div><div id="wwID0EKJ6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Navigate to <span class="uicontrol">API</span> &gt; <span class="uicontrol">Tokens</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EDK6X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta13.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 354px; max-width: 504px; top: 0pt" alt="Tokens" /></div></div><div id="wwID0ETK6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Click <span class="uicontrol">Create Token</span>.</div><div id="wwID0EIL6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Provide the following information.</div><div id="wwID0E3L6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">What do you want your token to be named?</span> : <span class="userinput">okta-oauth-token</span></div><div class="ww_skin_page_overflow"><div id="wwID0ETM6X" class="Figure_3"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta14.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 132px; max-width: 292px; top: 0pt" alt="Create token" /></div></div><div id="wwID0EEN6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Copy the <span class="uicontrol">Token Value</span>.</div><div id="wwID0EZN6X" class="Note_2"><span class="Bold">Note:<br /></span>This token value is displayed only once.</div><div id="wwID0EPO6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Click <span class="uicontrol">OK, got it</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EEP6X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta15.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 284px; max-width: 504px; top: 0pt" alt="Token created" /></div></div><div id="wwID0EVP6X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>7. </span></span>Add the postman callback url to Trusted Origins.</div><div id="wwID0EJQ6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Navigate to <span class="uicontrol">API</span> &gt; <span class="uicontrol">Trusted Origins</span></div><div class="ww_skin_page_overflow"><div id="wwID0EBR6X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta16.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 272px; max-width: 504px; top: 0pt" alt="Add token callback url" /></div></div><div id="wwID0ERR6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Click <span class="uicontrol">Add Origin</span>.</div><div id="wwID0EGS6X" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Provide the following information.</div><div id="wwID0E1S6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Name</span>: postman-callback</div><div id="wwID0EOT6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Origin URL</span>: <span class="userinput">https://oauth.pstmn.io</span></div><div id="wwID0EFU6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Type</span> : Select <span class="uicontrol">CORS</span> and <span class="uicontrol">Redirect</span></div><div id="wwID0EBV6X" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Click <span class="uicontrol">Save</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EWV6X" class="Figure_3"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta17.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 210px; max-width: 350px; top: 0pt" alt="Add origin" /></div></div><div class="ww_skin_page_overflow"><div id="wwID0EFW6X" class="Figure_3"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_okta18.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 204px; max-width: 504px; top: 0pt" alt="all origins" /></div></div><div id="wwID0E5W6X" class="Section_Title">Step 2: Configure API Gateway for third-party authorization</div><div id="wwID0EDX6X" class="Body">This example uses the existing OKTA provider configured in <span class="ph">API Gateway</span>. <span class="ph">API Gateway</span> has providers OKTA and PingFederate predefined and configured as the third-party OAuth2 configuration servers.</div><div id="wwID0ERX6X" class="Note"><span class="Bold">Note:<br /></span>You can also create your own identity providers by navigating to <span class="uicontrol">Administration</span> &gt; <span class="uicontrol">Security</span> &gt; <span class="uicontrol">JWT/OAuth/OpenID</span> &gt; <span class="uicontrol">Providers</span>. You can then click <span class="uicontrol">Add provider</span> and provide the required details. This provider configuration is used in the Dynamic client registration.</div><div id="wwID0E6Y6X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Click <span class="uicontrol">Menu</span> &gt; <span class="uicontrol">Administrator</span>.</div><div id="wwID0EYZ6X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Click <span class="uicontrol">Security</span>.</div><div id="wwID0EN16X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Click <span class="uicontrol">OKTA</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EC26X" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_apigw01.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 461px; max-width: 504px; top: 0pt" alt="OKTA details" /></div></div><div id="wwID0ES26X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Click <span class="uicontrol">JWT/OAuth/OpenID</span>.</div><div id="wwID0EH36X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Click <span class="uicontrol">Add authorization server</span>.</div><div id="wwID0E336X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Provide the following information:</div><div id="wwID0EQ46X" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Name</span>: <span class="userinput">okta-oauth-server</span></div><div id="wwID0EH56X" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Discovery URL</span>: <span class="userinput">https://dev-577328.okta.com/oauth2/ausm4htp1K1OKu0un4x6/.well-known/oauth-authorization-server</span></div><div class="ww_skin_page_overflow"><div id="wwID0E556X" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_apigw02.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 232px; max-width: 504px; top: 0pt" alt="Configure OKTA details" /></div></div><div id="wwID0EP66X" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>7. </span></span>Click <span class="uicontrol">Introspection</span>.</div><div id="wwID0EFAAY" class="Numbered_1_Continued">You use Introspection to authenticate the token. It happens as follows</div><div id="wwID0ENAAY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">Local introspection</span>. Validating the token within the gateway. This is done using the JWKS URI or the public certificate of the issuer. In this case the token should necessarily be JWT.</div><div id="wwID0ECBAY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">Remote introspection</span>. Validating the token with the authorization server. It has introspection endpoint, which is used to validate the token. In addition, the client id and client secret are used to protect the endpoint, so that anonymous users cannot access to the resource. To invoke an endpoint you require a user; Gateway user is the one you cam use to invoke the endpoint.</div><div id="wwID0EYBAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>8. </span></span>Remove the <span class="uicontrol">Introspection endpoint</span> from <span class="uicontrol">Remote Introspection</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0ERCAY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_apigw03.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 198px; max-width: 504px; top: 0pt" alt="Remove introspection endpoint" /></div></div><div id="wwID0EBDAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>9. </span></span>In <span class="uicontrol">Dynamic client registration</span>, click <span class="uicontrol">Enable</span> toggle button.</div><div id="wwID0E1DAY" class="Numbered_1_Continued">Use Dynamic client registration when you want to create the client automatically in the OAuth2 authorization server when an application is created in API Gateway.</div><div id="wwID0E6DAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>10. </span></span>Provide the following information:</div><div id="wwID0ETEAY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Authentication type</span>: <span class="userinput">Token</span></div><div id="wwID0EKFAY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Token type</span>: <span class="userinput">SSWS</span></div><div id="wwID0EBGAY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Token</span>: Copy the saved token value.</div><div class="ww_skin_page_overflow"><div id="wwID0EVGAY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_apigw04.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 132px; max-width: 504px; top: 0pt" alt="Token details" /></div></div><div id="wwID0EGHAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>11. </span></span>Click <span class="uicontrol">Metadata</span>. Verify that the Metadata is auto populated with the right values.</div><div class="ww_skin_page_overflow"><div id="wwID0E2HAY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_apigw05.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 50px; max-width: 504px; top: 0pt" alt="Verify metadata" /></div></div><div id="wwID0ELIAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>12. </span></span>Click <span class="uicontrol">Scopes</span>. Verify getscope is present in the list. Delete the other scopes as as they are not required.</div><div class="ww_skin_page_overflow"><div id="wwID0EAJAY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_apigw06.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 138px; max-width: 504px; top: 0pt" alt="Verify getscope" /></div></div><div id="wwID0EQJAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>13. </span></span>Click <span class="uicontrol">Add</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EFKAY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_apigw07.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 65px; max-width: 504px; top: 0pt" alt="Add external oauth server" /></div></div><div id="wwID0EVKAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>14. </span></span>Click the added external authorization server to test it.</div><div class="ww_skin_page_overflow"><div id="wwID0EGLAY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_config_apigw08.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 120px; max-width: 209px; top: 0pt" alt="Test external oauth server" /></div></div><div id="wwID0E5LAY" class="Section_Title">Step 3: Create an API with strategy</div><div id="wwID0EDMAY" class="Body">In this example we will create an API by importing from the URL <span class="codeph">https://petstore.swagger.io/v2/swagger.json</span>, enforce it with OAuth2 policy, and create an applicatin with strategy and associate it with the API.</div><div id="wwID0ERMAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>In the <span class="uicontrol">APIs</span> tab click <span class="uicontrol">Create API</span>.</div><div id="wwID0EKNAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Select <span class="uicontrol">Import API from URL</span>.</div><div id="wwID0E6NAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Provide the following information.</div><div id="wwID0ETOAY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">URL</span>: <span class="userinput">https://petstore.swagger.io/v2/swagger.json</span></div><div id="wwID0EKPAY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Name</span>: <span class="userinput">RestOps</span></div><div id="wwID0EBQAY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Type</span>: <span class="userinput">Swagger</span></div><div id="wwID0EYQAY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Version</span>: <span class="userinput">1.0</span></div><div id="wwID0EQRAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Click <span class="uicontrol">Create</span>. The API is created and the API details page for the API appears.</div><div class="ww_skin_page_overflow"><div id="wwID0EFSAY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_create_api01.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 294px; max-width: 504px; top: 0pt" alt="create API" /></div></div><div id="wwID0EVSAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Enforce OAUTH2 policy on the API.</div><div id="wwID0EGTAY" class="Numbered_1_Continued">You enforce OAuth2 policy on the <span class="apiname">RestOps</span> API. This policy ascertains that an OAuth token is required to access this API.</div><div id="wwID0EUTAY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Click <span class="uicontrol">APIs</span> in the title navigation panel.</div><div id="wwID0EJUAY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Click <span class="uicontrol">RestOps</span>.</div><div id="wwID0E5UAY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Click the <span class="uicontrol">Policies</span> tab.</div><div id="wwID0ETVAY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Click <span class="uicontrol">Edit</span>.</div><div id="wwID0EIWAY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Click <span class="uicontrol">Identify &amp; Access</span> from the policy catalog section.</div><div id="wwID0E4WAY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>f. </span></span>Select the <span class="uicontrol">Application Identification Type</span> as <span class="uicontrol">OAuth2 Token</span> and save the API.</div><div class="ww_skin_page_overflow"><div id="wwID0EWXAY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_create_api02.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 317px; max-width: 504px; top: 0pt" alt="Enforce oauth policy" /></div></div><div id="wwID0EGYAY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>g. </span></span>Click <span class="uicontrol">Activate</span> on the <span class="Bold">API details</span> page of the API to activate the API.</div><div id="wwID0ECZAY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Create an application in <span class="ph">API Gateway</span> with a strategy and register it to an API.</div><div id="wwID0E1ZAY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Click <span class="uicontrol">Applications</span> in the title navigation bar.</div><div id="wwID0EP1AY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Click <span class="uicontrol">Create application</span>.</div><div id="wwID0EE2AY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Provide the <span class="uicontrol">Name</span> as <span class="userinput">okta-application</span>.</div><div id="wwID0E42AY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Click <span class="uicontrol">Continue to Identifiers</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0ES3AY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_create_api03.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 203px; max-width: 504px; top: 0pt" alt="Create application" /></div></div><div id="wwID0EC4AY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Click <span class="uicontrol">Continue to APIs</span>.</div><div id="wwID0EX4AY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>f. </span></span>Type <span class="userinput">RestOps</span> in the <span class="uicontrol">Find APIs</span> text box. The <span class="apiname">RestOps</span> API appears in the <span class="uicontrol">Selected APIs</span> section.</div><div id="wwID0EZ5AY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>g. </span></span>Select the <span class="apiname">RestOps</span> API.</div><div id="wwID0EP6AY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>h. </span></span>Click <span class="uicontrol">Continue to Advanced</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EEABY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_create_api04.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 221px; max-width: 504px; top: 0pt" alt="Search API" /></div></div><div id="wwID0EUABY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>i. </span></span>Click <span class="Bold">Continue to Authentication</span>.</div><div id="wwID0EKBBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>j. </span></span>Click <span class="Bold">Create Strategy</span>.</div><div id="wwID0EACBY" class="Numbered_2_Continued">A strategy authenticates the incoming request and provides multiple authentication mechanisms or multiple authorization servers for a single authentication scheme. You can create multiple strategies authorized by an API for an application.</div><div id="wwID0EFCBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>k. </span></span>Provide the following information:</div><div id="wwID0EZCBY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Name</span>: <span class="userinput">okta-strategy</span></div><div id="wwID0EQDBY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Authentication Server</span> : Select <span class="userinput">okta-oauth-server</span></div><div id="wwID0EHEBY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Audience</span> : <span class="userinput">Administrator</span></div><div id="wwID0E5EBY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Enable <span class="uicontrol">Generate Credentials</span>.</div><div id="wwID0ETFBY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Redirect URIs</span>: <span class="userinput">https://oauth.pstmn.io/vl/callback</span></div><div id="wwID0EKGBY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Click <span class="uicontrol">Add</span> to add the Redirect URI.</div><div id="wwID0E6GBY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Grant type</span>: Select <span class="userinput">authorization_code</span> and <span class="userinput">implicit</span>.</div><div id="wwID0E2HBY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Scopes</span>: Search for <span class="userinput">getscope</span>, click the + sign to add the scope.</div><div id="wwID0EUIBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>l. </span></span>Click <span class="uicontrol">Add</span> to add the strategy.</div><div id="wwID0EJJBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>m. </span></span>Click <span class="uicontrol">Save</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0E5JBY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_create_api05.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 276px; max-width: 504px; top: 0pt" alt="create strategy" /></div></div><div id="wwID0ENKBY" class="Numbered_2_Continued">The strategy is created in OKTA as well.</div><div id="wwID0ESKBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>n. </span></span>Make a note of client_id and client_secret displayed in <span class="uicontrol">Applications</span> &gt; <span class="uicontrol">okta-application</span> &gt; <span class="uicontrol">Authentication</span> &gt; <span class="uicontrol">okta-strategy</span> section.</div><div class="ww_skin_page_overflow"><div id="wwID0ETLBY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_create_api06.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 382px; max-width: 504px; top: 0pt" alt="note client id and secret" /></div></div><div id="wwID0ELMBY" class="Section_Title">Step 4: Configure the Strategy in OKTA</div><div id="wwID0EUMBY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Login to OKTA.</div><div id="wwID0EFNBY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Navigate to <span class="uicontrol">Application</span>. The strategy okta-strategy should be present.</div><div id="wwID0E1NBY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Click the strategy okta-strategy.</div><div id="wwID0ELOBY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Click <span class="uicontrol">General</span> and verify that the details are same as in <span class="ph">API Gateway</span>.</div><div id="wwID0EEPBY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Click <span class="uicontrol">SignOn</span>.</div><div id="wwID0EZPBY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Perform the following steps in the <span class="uicontrol">SignOn</span> page:</div><div id="wwID0ERQBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Click <span class="uicontrol">Edit</span> in Token Credentials.</div><div id="wwID0EGRBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span><span class="uicontrol">Signing credential rotation</span>: Select <span class="userinput">Automatic</span>.</div><div id="wwID0E5RBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Click <span class="uicontrol">Save</span>.</div><div id="wwID0ETSBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Under <span class="uicontrol">Sign On Policy</span> click <span class="uicontrol">Add Rule</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EMTBY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_configstrategy_okta01.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 416px; max-width: 504px; top: 0pt" alt="Add rule in OKTA" /></div></div><div id="wwID0E3TBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Provide <span class="uicontrol">Rule Name</span> as <span class="userinput">okta-app-rule</span>.</div><div id="wwID0EVUBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>f. </span></span>In <span class="uicontrol">Access</span> select <span class="userinput">Prompt for reauthentication</span>.</div><div id="wwID0EOVBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>g. </span></span>Click <span class="uicontrol">Save</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EDWBY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_configstrategy_okta02.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 598px; max-width: 504px; top: 0pt" alt="App signon rule" /></div></div><div id="wwID0ETWBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>h. </span></span>Click <span class="uicontrol">Assignments</span> to assign Users and groups to the applicaton to avoid ACL permission issues.</div><div id="wwID0EIXBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>i. </span></span>Click <span class="uicontrol">Assign</span> and then <span class="uicontrol">Assign</span> to <span class="userinput">People</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EFYBY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_configstrategy_okta03.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 201px; max-width: 504px; top: 0pt" alt="Assign to groups" /></div></div><div id="wwID0EVYBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>j. </span></span>The login user should be listed else search the user in the search box.</div><div id="wwID0EGZBY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>k. </span></span>Click <span class="uicontrol">Assign</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0E2ZBY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_configstrategy_okta04.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 122px; max-width: 504px; top: 0pt" alt="Assign strategy to groups" /></div></div><div id="wwID0EL1BY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>l. </span></span>Click <span class="uicontrol">Save and Go Back</span>.</div><div id="wwID0EA2BY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>m. </span></span>Click <span class="uicontrol">Done</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EV2BY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_configstrategy_okta05.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 132px; max-width: 504px; top: 0pt" alt="Assign to groups done" /></div></div><div id="wwID0EF3BY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>n. </span></span>Click <span class="uicontrol">Assign</span> and then <span class="uicontrol">Assign</span> to <span class="userinput">Groups</span>.</div><div id="wwID0EC4BY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>o. </span></span>The group <span class="uicontrol">Everyone</span> should be listed, else search the group in the search box.</div><div id="wwID0EX4BY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>p. </span></span>Click <span class="uicontrol">Assign</span>.</div><div id="wwID0EM5BY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>q. </span></span>Click <span class="uicontrol">Save and Go Back</span>.</div><div id="wwID0EB6BY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>r. </span></span>Click <span class="uicontrol">Done</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EW6BY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_configstrategy_okta06.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 131px; max-width: 504px; top: 0pt" alt="Assign to everyone" /></div></div><div id="wwID0EOACY" class="Section_Title">Step 5: Map OAuth scopes</div><div id="wwID0ETACY" class="Body">You must map the scope defined in OKTA Authorization server with the APIs in <span class="ph">API Gateway</span> to authorize the access tokens to be used to access the protected resources. One can map either a complete API or parts (resources or methods) of an API to the scope or can add the scope details and modify the scope details as required from the OAuth/OpenID scopes page.</div><div id="wwID0EBBCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Expand the menu options in the title bar and select <span class="uicontrol">OAuth/OpenID scopes</span>.</div><div id="wwID0EWBCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Click <span class="uicontrol">Map scope</span>.</div><div id="wwID0ELCCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Type <span class="userinput">getscope</span> in <span class="uicontrol">Select authorization server scope</span> and select the listed Authorization server scope from the search list populated.</div><div id="wwID0EEDCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Provide <span class="uicontrol">Audience</span>as <span class="userinput">Administrator</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0E4DCY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_map_scope01.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 189px; max-width: 504px; top: 0pt" alt="Create scope mapping" /></div></div><div id="wwID0ENECY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Click <span class="uicontrol">API scopes</span></div><div id="wwID0EBFCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Type <span class="userinput">RestOps</span> or <span class="userinput">API Scope</span>, which is to be linked to the authorization server, in API scopes search text box.</div><div id="wwID0E1FCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>7. </span></span>Save the changes. This maps the authorization server scope to the selected API scopes and lists the authorization scope in the scopes list.</div><div class="ww_skin_page_overflow"><div id="wwID0ELGCY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_map_scope02.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 180px; max-width: 504px; top: 0pt" alt="Map scope" /></div></div><div id="wwID0ECHCY" class="Section_Title">Step 6: Get the access token</div><div id="wwID0ELHCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Open Postman, click Authorization and select OAuth2.</div><div id="wwID0E3HCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Click <span class="uicontrol">Get New Access Token</span>.</div><div id="wwID0ERICY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Provide the following information:</div><div id="wwID0EFJCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Token Name</span>: <span class="userinput">oktaToken</span></div><div id="wwID0E3JCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Grant Type</span>: <span class="userinput">Authorization Code</span></div><div id="wwID0ETKCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Callback URL</span>: <span class="codeph">https://oauth.pstmn.io/v1/callback</span></div><div id="wwID0EKLCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Select Authorize using browser</div><div id="wwID0E2LCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Auth URL</span>: <span class="codeph">http://dev-577328.okta.com/oauth2/ausm4htp1K1OKu0un4x6/v1/authorize</span></div><div id="wwID0ESMCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Access Token URL</span>: <span class="codeph">https://dev-577328.okta.com/oauth2/ausm4htp1K1OKu0un4x6/v1/token</span></div><div id="wwID0EKNCY" class="Note_2"><span class="Bold">Note:<br /></span>Get the Auth URL and Access token URL from <span class="uicontrol">Administration</span> &gt; <span class="uicontrol">Security</span> &gt; <span class="uicontrol">JWT/OAuth/OpenID</span> &gt; <span class="uicontrol">External authorization server</span> &gt; <span class="uicontrol">okta-oauth-server</span> &gt; <span class="uicontrol">Meta data</span> section.</div><div id="wwID0EYOCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Client ID</span>: <span class="Italic">0oam51fdfAJcDyDkT4x6</span></div><div id="wwID0EQPCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Client Secret</span>: <span class="Italic">_MOgtr2gUHB8lkhZzM4uPL3wL53may1FgqHjHN2o</span></div><div id="wwID0EIQCY" class="Note_2"><span class="Bold">Note:<br /></span>The Client_ID and Client_Secret can be obtained from the <span class="uicontrol">Application</span> &gt;<span class="uicontrol"> okta-application</span> &gt; <span class="uicontrol">okta-strategy</span>.</div><div id="wwID0EKRCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Scope</span>: <span class="Italic">getScope</span></div><div id="wwID0ECSCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">State</span>: 121</div><div id="wwID0EWSCY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Client Authentication </span>: Send Client credentials in body</div><div id="wwID0ELTCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Click <span class="uicontrol">Request Token</span>.</div><div id="wwID0EAUCY" class="Numbered_1_Continued">You are redirected to OKTA login page.</div><div id="wwID0EFUCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Login into OKTA Page. A <span class="userinput">Authentication completed</span> message displays and you are redirected to call back URL.</div><div id="wwID0E1UCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>In Postman you will get the Access token from Postman.</div><div id="wwID0ELVCY" class="Numbered_1_Continued">Click <span class="uicontrol">Use Token</span> or copy the token which you can use to invoke the API.</div><div class="ww_skin_page_overflow"><div id="wwID0EUVCY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_get_acctoken.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 291px; max-width: 504px; top: 0pt" alt="get access token" /></div></div><div id="wwID0ELWCY" class="Section_Title">Step 7: Invoke API</div><div id="wwID0EQWCY" class="Body">Ensure you have the following to invoke the API</div><div id="wwID0EZWCY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Gateway endpoints. You will find the gateway endpoints in <span class="ph">API Gateway</span> UI in the <span class="Underline">APIs</span> &gt; <span class="uicontrol">RestOps</span> &gt; <span class="uicontrol">Technical information</span> section. In this example the endpoint is <span class="codeph">http://vmsiqacross02.eur.ad.sag:4444/gateway/RestOps/1.0/store/inventory</span>.</div><div id="wwID0E6XCY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>The method or resource that must be invoked. The list operations are present in the <span class="uicontrol">APIs</span> &gt; <span class="uicontrol">RestOps</span> &gt; <span class="uicontrol">Technical information </span>section under Resources and methods. Select anyone. In this example select <span class="userinput">/store/inventory</span> which is a GET method.</div><div id="wwID0EAZCY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Access token.</div><div id="wwID0EWZCY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Open Postman.</div><div id="wwID0EH1CY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Select Get and <span class="codeph">http://vmsiqacross02.eur.ad.sag:4444/gateway/RestOps/1.0/store/inventory</span>.</div><div id="wwID0E31CY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>In <span class="uicontrol">Headers</span> add <span class="userinput">Authorization</span> as Key and provide value as <span class="userinput">Bearer access token</span></div><div id="wwID0EY2CY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>In <span class="uicontrol">Headers</span> add <span class="userinput">Accept</span> as Key and provide value as <span class="userinput">application/json</span>.</div><div id="wwID0EV3CY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Click <span class="uicontrol">Send</span>.</div><div id="wwID0EK4CY" class="Numbered_1_Continued">The API is invoked and you see the expected response with a 200 OK status.</div><div class="ww_skin_page_overflow"><div id="wwID0EO4CY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/oauth_third_party_invoke_api.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 188px; max-width: 504px; top: 0pt" alt="Invoke API" /></div></div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright  2016-2023&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>