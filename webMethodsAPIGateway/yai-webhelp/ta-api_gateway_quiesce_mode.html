<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>API Gateway Quiesce Mode</title><link rel="Prev" href="co-upgrading_apigtw_zero_downtime.html" title="Previous" /><link rel="Next" href="ta-migration_rest_api.html" title="Next" /><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/yai-webhelp/ta-api_gateway_quiesce_mode.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pcoEPDKsoOJ36rwF3oWxIfQ" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/yai-webhelp/ta-api_gateway_quiesce_mode.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>API Gateway</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.801.html#wwconnect_header">Upgrading and Migrating to API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/to-upgrading_apigw_zero_downtime_landing_page.html#wwconnect_header">Upgrading API Gateway in Zero Downtime</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/co-upgrading_apigtw_zero_downtime.html#wwconnect_header">Introduction</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">API Gateway Quiesce Mode</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0EMLO4" class="Heading_3"><span class="ph">API Gateway</span> Quiesce Mode</div><div id="wwID0EFNO4" class="Body">You must perform this operation in the old <span class="ph">API Gateway</span> instance.</div><div id="wwID0EPNO4" class="Body">Quiescing <span class="ph">API Gateway</span> temporarily disables access to the <span class="ph">API Gateway</span> server. When the <span class="ph">API Gateway</span> server access is disabled, you can perform the required upgrade tasks while the <span class="ph">API Gateway</span> server is not connected to any external resources. For more information on quiesce mode, see 
    <a href="../yai-webhelp/co-quiesce_mode.html#wwID0EH3U4"
   
     title="Quiesce Mode"
    ><span class="heading-page">Quiesce Mode</span></a>.</div><div id="wwID0EQOO4" class="Body">While flushing the performance, license, and quota metrics data, <span class="ph">API Gateway</span> performs the following operations:</div><div id="wwID0EAPO4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Resets performance and license metrics intervals for all the APIs and stores the data in the Elasticsearch or API Data Store.</div><div id="wwID0ETPO4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Stores the subscription quota in the Elasticsearch or API Data Store.</div><div id="wwID0EHQO4" class="Body">When all the performance metrics and other data are flushed completely, quiesce mode is enabled for all the <span class="ph">API Gateway</span> nodes, and a notification is sent through a webhook event.</div><div id="wwID0ERQO4" class="procedure"><span><img src="icon_task_xpe.png" alt="*" border="0" width="20" height="13" /></span>To operate <span class="ph">API Gateway</span> in quiesce mode, execute the following steps:</div><div id="wwID0ECRO4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span><span class="Command">Create a quiesce port. </span></div><div id="wwID0E6RO4" class="Body_1">Before you invoke the quiesce mode, you must create a quiesce port, and enable it in the old <span class="ph">API Gateway</span> instance.</div><div id="wwID0EJSO4" class="Body_1">You can use the following request to create and enable the quiesce port.</div><div id="wwID0EOSO4" class="Preformatted_1">POST /rest/apigateway/ports<br />{<br />    "factoryKey": "webMethods/HTTP",<br />    "pkg": "WmRoot",<br />    "port": "4444",<br />    "portAlias": "QuiescePort"<br />}</div><div id="wwID0EUSO4" class="Body_1">In the example above, the 4444 port is used.</div><div id="wwID0EZSO4" class="Body_1">Once you create the port, use the following request to enable the quiesce port.</div><div id="wwID0E5SO4" class="Preformatted_1">PUT rest/apigateway/ports/enable<br />{<br />    "listenerKey": "HTTPListener@4444",<br />    "pkg": "WmRoot",<br />    "requestServiceStatus": ""<br />}</div><div id="wwID0EETO4" class="Body_1">After the quiesce port is enabled, use the following request to set the quiesce port. You must use the same <span class="codeph">portAlias</span> value that you used while creating the quiesce port. In this example, the <span class="codeph">portAlias</span> used while creating the quiesce port is <span class="codeph">QuiescePort</span>.</div><div id="wwID0EWTO4" class="Preformatted_1">PUT invoke/wm.API Gateway server.quiesce/setQuiescePort<br />{<br />    "portAlias": "QuiescePort"<br />}</div><div id="wwID0E5TO4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span><span class="Command">Enable or disable the quiesce mode. </span></div><div id="wwID0E2UO4" class="Body_1">You can use the following request to enable or disable the quiesce mode.</div><div id="wwID0EAVO4" class="Preformatted_1">PUT /rest/apigateway/quiescemode<br />{<br />    "enable": "true/false",<br />    "block": "designtime/all",<br />    "flush": [<br />        "license_metrics",<br />        "performance_metrics",<br />        "subscription_quota"<br />    ]<br />}</div><div id="wwID0EGVO4" class="Body_1">The parameters used in the above request are described in the following table:</div><div class="ww_skin_page_overflow"><table class="rules2" cellspacing="0" summary=""><tr><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 23.6%"><div id="wwID0EFWO4" class="Table_Cell_Head">Parameter</div></td><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 76.3%"><div id="wwID0ELWO4" class="Table_Cell_Head">Description</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EYWO4" class="Table_Cell"><span class="parmname">enable</span></div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EDXO4" class="Table_Cell">Set the enable parameter as <span class="userinput">true</span> to enable quiesce mode and <span class="userinput">false</span> to disable the quiesce mode. You can disable the quiesce mode only when the block parameter is set as <span class="userinput">designtime</span>. When the block parameter is set as <span class="userinput">all</span>, <span class="ph">API Gateway</span> is quiesced and is unreachable. Hence, you cannot disable the <span class="ph">API Gateway</span> quiesce mode by invoking this request.</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EGYO4" class="Table_Cell"><span class="parmname">block</span></div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0ERYO4" class="Table_Cell">Set the block parameter as <span class="userinput">designtime</span> to block only design time requests and <span class="userinput">all</span> to block all the requests.</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EEZO4" class="Table_Cell"><span class="parmname">flush</span></div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EPZO4" class="Table_Cell">This parameter is not applicable when you set the block parameter as <span class="userinput">designtime</span>. The flush parameter is applicable only when you set the block parameter as <span class="userinput">all</span>. In the above example, when you set the block parameter as <span class="userinput">all</span>, <span class="ph">API Gateway</span> blocks all the requests and flushes the license metrics, performance metrics, and the subscription quota data. If you do not specify any value in this parameter, all the data is flushed.</div></td></tr></table></div><div id="wwID0EN1O4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span><span class="Command">Retrieving the quiesce mode status. </span></div><div id="wwID0EK2O4" class="Body_1">Apart from the webhook notification of the quiesce mode status, you can use the following request to retrieve the quiesce mode status.</div><div id="wwID0EP2O4" class="Preformatted_1">GET /rest/apigateway/quiescemode<br /></div><div id="wwID0EV2O4" class="Body_1"><span class="inlinetitle">Response</span></div><div id="wwID0E62O4" class="Preformatted_1"><br />{<br />    "enable": "true/false",<br />    "block": "designtime/all",<br />    "flush": [<br />        "license_metrics",<br />        "performance_metrics",<br />        "subscription_quota"<br />    ],<br />    "status": "success",<br />    "failureReason": null<br />}</div><div id="wwID0EF3O4" class="Note_1"><span class="Bold">Note:<br /></span>This request works only for quiesce mode for <span class="userinput">designtime</span>. This request will not work for <span class="userinput">all</span>, because the <span class="ph">API Gateway</span> package is disabled when you invoke quiesce mode for <span class="userinput">all</span>. In such cases, you must invoke the <span class="ph">API Gateway</span> health check API through the quiesce port. If it returns a status code other than 200 or no response, then the quiesce mode for <span class="userinput">all</span> is completed in that node successfully.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright © 2016-2023&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>