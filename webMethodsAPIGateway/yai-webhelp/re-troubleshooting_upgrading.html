<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Troubleshooting Tips</title><link rel="Prev" href="co-upgrade_recovery.html" title="Previous" /><link rel="Next" href="to-upgrading_apigw_zero_downtime_landing_page.html" title="Next" /><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/yai-webhelp/re-troubleshooting_upgrading.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pGgQkzwzkfuUR8e5fa0evqQ" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/yai-webhelp/re-troubleshooting_upgrading.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>API Gateway</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.801.html#wwconnect_header">Upgrading and Migrating to API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/to-upgrading_apigw_landing_page.html#wwconnect_header">Upgrading API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Troubleshooting Tips</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0EI2M4" class="Heading_2">Troubleshooting Tips</div><div id="wwID0E43M4" class="Section_Title">I see that a scheduled <span class="ph">API Gateway</span> upgrade fails due to the re-indexing issue.</div><div id="wwID0EH4M4" class="Body">Upgrading <span class="ph">API Gateway</span> fails due to the re-indexing issue in the migration process.</div><div id="wwID0ER4M4" class="Body">Sample error is as follows:</div><div id="wwID0EW4M4" class="Body">Data store migration failed.</div><div id="wwID0E24M4" class="Body">Reason - Error while reindexing APIs. Error type - illegal_argument_exception, reason Remote responded with a chunk that was too large. Use a smaller batch size.</div><div id="wwID0EA5M4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0EL5M4" class="Body">To resolve this issue, modify the value of the <span class="codeph">apigateway.migration.batchSize</span> property in the migration.properties file located at <span class="codeph">SAG_Installdir\IntegrationServer\instances\default\packages\WmAPIGateway\bin\migrate</span>.</div><div id="wwID0EZ5M4" class="Body">The default value of the <span class="codeph">apigateway.migration.batchSize</span> property is 100.</div><div id="wwID0ED6M4" class="Body">Modify the value of the <span class="codeph">apigateway.migration.batchSize</span> property based on the size of the payload. If you have a huge payload, reduce the <span class="codeph">apigateway.migration.batchSize</span> property value to a smaller number. For example, <span class="codeph">apigateway.migration.batchSize=25</span>.</div><div id="wwID0EV6M4" class="Body">The migration time increases, if you reduce the <span class="codeph">apigateway.migration.batchSize</span> property value.</div><div id="wwID0EHAN4" class="Section_Title">I see that the data store migration fails when I provide hostname instead of localhost in the elasticsearch.yml file.</div><div id="wwID0EMAN4" class="Body">My data store migration fails when I provide hostname instead of localhost in elasticsearch.yml.</div><div id="wwID0ERAN4" class="Body">Basically, I am adding the following line in the file <span class="filepath_002c_varname">&lt;installDir&gt;</span><span class="filepath">\InternalDataStore\config\elasticsearch.yml</span> before migration.</div><div id="wwID0EABN4" class="Preformatted">reindex.remote.whitelist:<span class="varname">hostName</span>:9240</div><div id="wwID0ENBN4" class="Body">It works fine with localhost, but with actual hostName it fails with the following error,</div><div id="wwID0ESBN4" class="Body">Backup process started for the configured elasticsearch host [localhost:8240] Creating repository [migration_default] 2019-06-13 17:00:41 ERROR AbstractElasticsearchClient:98 - APIGW Migration Exception:Error while creating repository - migration_default. Message - listener timeout after waiting for [100000] ms java.io.IOException: listener timeout after waiting for [100000] ms at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:660) ~ [elasticsearch-rest-client-5.6.4.jar:5.6.4]</div><div id="wwID0EXBN4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0EBCN4" class="Body">You can use regular expressions instead of using the exact hostname. To learn more about how to set regex values for the reindex.remote.whitelist in the elasticsearch.yml file, see
    <a href="https://www.elastic.co/"
   
     target="external_window"
    ><span class="heading-page"> Elasticsearch documentation</span></a>.</div><div id="wwID0EZCN4" class="Section_Title">I see an Elasticsearch exception while migrating an <span class="ph">API Gateway</span> instance using direct standalone mode.</div><div id="wwID0EDDN4" class="Body">Upgrading <span class="ph">API Gateway</span> using direct standalone mode fails with an Elasticsearch exception.</div><div id="wwID0ENDN4" class="Body">The Elasticsearch exception is as follows:</div><div id="wwID0ESDN4" class="Body">ElasticsearchException[Error while reindexing APIs. Error type - illegal_argument_exception,reason [localhost:1240] not whitelisted in reindex.remote.whitelist]</div><div id="wwID0EXDN4" class="Body"><span class="inlinetitle">Reason</span>: Remote re-indexing property is missing in the target elasticsearch.yml file.</div><div id="wwID0EBEN4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0ELEN4" class="Body">Add the <span class="codeph">reindex.remote.whitelist</span> property in the target elasticsearch.yml file located at <span class="codeph_002c_varname">&lt;TARGET&gt;</span><span class="codeph">\InternalDataStore\config</span>.</div><div id="wwID0E6EN4" class="Body">Syntax for <span class="codeph">reindex.remote.whitelist</span> property in the target elasticsearch.yml file is as follows:</div><div id="wwID0EJFN4" class="Preformatted">reindex.remote.whitelist: &lt;source_host&gt;:&lt;source_port&gt;</div><div id="wwID0EXFN4" class="Section_Title">I see a No such command exception while migrating an <span class="ph">API Gateway</span> instance using direct standalone mode.</div><div id="wwID0EBGN4" class="Body">Upgrading <span class="ph">API Gateway</span> using direct standalone mode fails with a No such command exception.</div><div id="wwID0ELGN4" class="Body">The exception is as follows:</div><div id="wwID0EQGN4" class="Body">Exception thrown during migration operation. Exiting the operation. No Such command - -srcDir</div><div id="wwID0EVGN4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0E6GN4" class="Body">The API Data Store and <span class="ph">API Gateway</span> argument must be passed in the following migration utility command:</div><div id="wwID0EJHN4" class="Preformatted">migrate.bat apigateway -srcDir &lt;SOURCE&gt; -instanceName &lt;source instance name&gt; -newInstanceName &lt;target instance name&gt;</div><div id="wwID0EPHN4" class="Body">Sample migration utility command is as follows:</div><div id="wwID0EUHN4" class="Preformatted">migration.bat apigateway -srcDir C:\SoftwareAG_10.1 -instanceName default -newInstanceName default</div><div id="wwID0ECIN4" class="Section_Title">I see java.io.FileNotFoundException exception while migrating an <span class="ph">API Gateway</span> instance using backup standalone mode.</div><div id="wwID0EMIN4" class="Body">Upgrading <span class="ph">API Gateway</span> using backup standalone mode fails with a java.io.FileNotFoundException exception.</div><div id="wwID0EWIN4" class="Body">The exception is as follows:</div><div id="wwID0E2IN4" class="Body">Deleting the backup folder before migration... Migration Process 0% [&gt;] 0/100 (0:00:00) java.io.FileNotFoundException: 15:41:13.580 [main] ERROR com.softwareag.apigateway.utility.command.backup.instance.BackupApiGatewayInstance - Error occurred while trying to parse the Manifest file to obtain the version information. java.io.FileNotFoundException:(The system cannot find the file specified)</div><div id="wwID0EAJN4" class="Body"><span class="inlinetitle">Reason</span>: Existence of <span class="codeph">isExtract</span> file due to migration failure.</div><div id="wwID0EOJN4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0EYJN4" class="Body">Delete the <span class="codeph">isExtract</span> folder in the directory <span class="filepath">C:\&lt;SAGInstallDir&gt;\</span>.</div><div id="wwID0EOKN4" class="Section_Title">I see an Elasticsearchclient bean creation exception while migrating an <span class="ph">API Gateway</span> instance.</div><div id="wwID0EYKN4" class="Body">Upgrading <span class="ph">API Gateway</span> fails with an Elasticsearchclient bean creation exception.</div><div id="wwID0ECLN4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0EMLN4" class="Body">Make sure that all the respective Elasticsearch nodes are up and running.</div><div id="wwID0EZLN4" class="Section_Title">I see a RepositoryVerificationException while migrating <span class="ph">API Gateway</span> cluster using backup mode.</div><div id="wwID0EDMN4" class="Body">Upgrading <span class="ph">API Gateway</span> fails with a RepositoryVerificationException exception.</div><div id="wwID0ENMN4" class="Body">The exception is as follows:</div><div id="wwID0ESMN4" class="Body">[2018-12-19T12:34:03,892][WARN ][o.e.r.VerifyNodeRepositoryAction][SAG-2KXGBH2.eur.ad.sag1544697848038] [default] failed to verify repositoryorg.elasticsearch.repositories.RepositoryVerificationException: [default] a file written by master to the store [C:\SoftwareAG_10.3\InternalDataStore\dasoSnap\default] cannot be accessed on the node [{SAG-2KXGBH2.eur.ad.sag1544697848038} {yL84xqhZQSuFfUmj0GrFbQ}{uGv-BmTBT6e8LCpOsxpGOg} {10.60.37.18}{10.60.37.18:9340}]. This might indicate that the store [C:\SoftwareAG_10.3\InternalDataStore\dasoSnap\default] is not shared between this node and the master node or that permissions on the store don't allow reading files written by the master node</div><div id="wwID0EXMN4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0EBNN4" class="Body">Make sure that the <span class="codeph">path.repo</span> property is a single common location reachable and accessible by all other nodes.</div><div id="wwID0ELNN4" class="Body">Configure a single common shared path for the <span class="codeph">path.repo</span> property in the elasticsearch.yml file located at <span class="codeph_002c_varname">&lt;SAGInstallDir&gt;</span><span class="codeph">\InternalDataStore\config</span>.</div><div id="wwID0EHON4" class="Section_Title">I see a system cannot find the path specified error while migrating <span class="ph">API Gateway</span>.</div><div id="wwID0ERON4" class="Body">Upgrading <span class="ph">API Gateway</span> fails with a system cannot find the path specified error.</div><div id="wwID0E2ON4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0EFPN4" class="Body">Make sure that you are running the .bat file from a proper location.</div><div id="wwID0ESPN4" class="Section_Title">I see a content too long exception while upgrading <span class="ph">API Gateway</span>.</div><div id="wwID0E3PN4" class="Body">Upgrading <span class="ph">API Gateway</span> fails with a content too long exception.</div><div id="wwID0EGQN4" class="Body">The exception is as follows:</div><div id="wwID0ELQN4" class="Body">2019-10-16 11:59:36 ERROR ESDataStoreHandler:327 - {"type":"illegal_argument_exception","reason":"Remote responded with a chunk that was too large. Use a smaller batch size.","caused_by":{"type":"content_too_long_exception","reason":"entity content is too long [185463385] for the configured buffer limit [104857600]"}}</div><div id="wwID0EQQN4" class="Body"><span class="inlinetitle">Reason</span>: The size of the documents selected for re-indexing as per the batch size configuration is large.</div><div id="wwID0E2QN4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0EFRN4" class="Body">Try with a smaller document batch size number.</div><div id="wwID0ESRN4" class="Section_Title">I see an error while getting task details when upgrading <span class="ph">API Gateway</span>.</div><div id="wwID0E3RN4" class="Body">Upgrading <span class="ph">API Gateway</span> fails with an error while getting task details.</div><div id="wwID0EGSN4" class="Body">Sample error is as follows:</div><div id="wwID0ELSN4" class="Body">Error while getting task details for task id - 6L6RMNEOQF64lQbNeI7J_g:683354. Message - task [6L6RMNEOQF64lQbNeI7J_g:683354] isn't running and hasn't stored its results</div><div id="wwID0EQSN4" class="Body"><span class="inlinetitle">Reason</span>: When the disk space in the machine is less than 10%, Elasticsearch marks the index as read-only and the re-index task fails abruptly.</div><div id="wwID0E2SN4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0EFTN4" class="Body">Increase the memory size to resolve this issue.</div><div id="wwID0ESTN4" class="Section_Title">I see an error while restoring the index when upgrading <span class="ph">API Gateway</span>.</div><div id="wwID0E3TN4" class="Body">Upgrading <span class="ph">API Gateway</span> fails with an error while restoring the index, when migrating a standalone <span class="ph">API Gateway</span> instance or an <span class="ph">API Gateway</span> cluster using backup mode.</div><div id="wwID0EOUN4" class="Body">Sample error is as follows:</div><div id="wwID0ETUN4" class="Body">ERROR ESDataStoreHandler:432 - Error while restoring index - gateway_default_analytics java.io.IOException: listener timeout after waiting for [100000] ms</div><div id="wwID0EYUN4" class="Body"><span class="inlinetitle">Reason</span>: While restoring the Elasticsearch data from backup snapshot, the elasticsearch client is timed out due to the time taken to restore the large data in Elasticsearch.</div><div id="wwID0EDVN4" class="Body"><span class="inlinetitle">Resolution</span>:</div><div id="wwID0ENVN4" class="Body">To resolve this issue, increase the value of the socket timeout and maximum retry timeout properties accordingly.</div><div id="wwID0E1VN4" class="Definition_Term">socketTimeout</div><div id="wwID0E6VN4" class="Definition_Description">Read timeout in milli seconds between <span class="ph">API Gateway</span> and API Data Store.</div><div id="wwID0EIWN4" class="Definition_Description">Property: <span class="codeph">pg.gateway.elasticsearch.http.socketTimeout</span></div><div id="wwID0EYWN4" class="Definition_Term">maxRetryTimeout</div><div id="wwID0E4WN4" class="Definition_Description">Time out in milli seconds to wait for retries.</div><div id="wwID0ECXN4" class="Definition_Description">Property: <span class="codeph">pg.gateway.elasticsearch.http.maxRetryTimeout</span></div><div id="wwID0EMXN4" class="Definition_Description">It is advisable to set the maximum retry time for a request to (number of nodes * socketTimeOut )+ connectionTimeout.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright Â© 2016-2023&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>