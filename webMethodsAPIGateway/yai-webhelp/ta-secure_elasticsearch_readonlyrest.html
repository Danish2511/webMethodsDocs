<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>How do I Secure API Data Store Communication using HTTPS with ReadonlyREST Plugin?</title><link rel="Prev" href="co-secure_datastore_plugins.html" title="Previous" /><link rel="Next" href="ta-create_truststore_self_signed_certificates.html" title="Next" /><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/yai-webhelp/ta-secure_elasticsearch_readonlyrest.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pKTju4UTvYtKZno7TPkFEPQ" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/yai-webhelp/ta-secure_elasticsearch_readonlyrest.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>API Gateway</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.032.html#wwconnect_header">Administering API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.303.html#wwconnect_header">Security Configuration</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/co-full_https_configuration.html#wwconnect_header">Securing API Gateway Communication using TLS</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/co-secure_datastore_plugins.html#wwconnect_header">How do I Secure API Data Store Communication using HTTPS?</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">How do I Secure API Data Store Communication using HTTPS with ReadonlyREST Plugin?</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0ETXCV" class="Heading_4">How do I Secure API Data Store Communication using HTTPS with ReadonlyREST Plugin?</div><div id="wwID0ECYCV" class="Body">You can use the ReadonlyREST plugin to secure API Data Store (a simple Elasticsearch instance), one of the components in an API Management setup, to communicate securely over HTTPS.</div><div id="wwID0EPYCV" class="Section_Title">Before you begin</div><div id="wwID0EUYCV" class="Body">Ensure that you have:</div><div id="wwID0E6YCV" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Downloaded the ReadonlyREST plugin. You can download the ReadonlyREST plugin compatible with Elasticsearch 8.2.3 from 
    <a href="https://readonlyrest.com/download"
   
     target="external_window"
    ><span class="heading-page">https://readonlyrest.com/download</span></a> and store it in your file system.</div><div id="wwID0E3ZCV" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Installed an updated version of Java in your system and the path of the environment variable is set.</div><div id="wwID0EY1CV" class="Section_Title">To secure API Data Store communication using HTTPS</div><div id="wwID0ED2CV" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Install and initialize the ReadonlyREST plugin.</div><div id="wwID0E22CV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Shutdown <span class="ph">API Gateway</span>.</div><div id="wwID0ES3CV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Open the command prompt from the location <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">/InternalDataStore/bin</span></div><div id="wwID0EP4CV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Run the following command:</div><div id="wwID0EC5CV" class="Preformatted_2">elasticsearch-plugin.bat install file:///<span class="varname">ReadonlyREST_plugin_zip_file_location_in_the_file_system</span></div><div id="wwID0EO5CV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Type <span class="userinput">y</span> when the installation procedure prompts for additional required permissions.</div><div id="wwID0EF6CV" class="Numbered_2_Continued"><span class="emphasis">Installed readonlyrest</span> message appears on successful installation.</div><div class="ww_skin_page_overflow"><div id="wwID0EO6CV" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/restplugin_console.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 404px; max-width: 700px; top: 0pt" alt="" /></div></div><div id="wwID0EDADV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Navigate to the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\config</span> folder and create an empty file with the name, <span class="userinput">readonlyrest.yml</span> (in the same folder where elasticsearch.yml is available).</div><div id="wwID0EEBDV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>f. </span></span>Copy the folder <span class="inlinetitle">sagconfig</span> from <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\IntegrationServer\instances\</span><span class="filepath_002c_varname">Instance_name</span><span class="filepath">\packages\WmAPIGateway\config\resources\elasticsearch</span> to <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore</span>.</div><div id="wwID0EWCDV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>g. </span></span>Copy the certificates <span class="inlinetitle">node-0-keystore.jks</span> and <span class="inlinetitle">truststore.jks</span> from <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\sagconfig</span> folder to <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\config</span> folder. Because, the keystore should be stored in the same directory where elasticsearch.yml and readonlyrest.yml is available.</div><div id="wwID0EJEDV" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Protect API DataStore with two-way SSL and basic authorization.</div><div id="wwID0E3EDV" class="Numbered_1_Continued">The ReadonlyREST plugin supports plain-text credentials and hashed credentials for basic authorization. You can choose to add plain-text credentials or hashed credentials in the readonlyrest.yml file.</div><div id="wwID0EBFDV" class="Numbered_1_Continued"><span class="inlinetitle">Plain-text credentials</span></div><div id="wwID0ELFDV" class="Numbered_1_Continued">Perform the following steps to include plain-text credentials for basic authorization in the readonlyrest.yml file.</div><div id="wwID0EWFDV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Open the <span class="inlinetitle">readonlyrest.yml</span> file from the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\config</span> folder and add the following text:</div><div id="wwID0EYGDV" class="Preformatted_2"><br />readonlyrest:    <br />    access_control_rules:<br /> <br />    - name: "Require HTTP Basic Auth"<br />      type: allow<br />      auth_key: &lt;<span class="emphasis">plain_text_credentials</span>&gt; <br />     (#For example: auth_key:<span class="emphasis">Administrator:manage</span>)<br />           <br />    ssl:<br />      enable: true<br />      keystore_file: "node-0-keystore.jks"<br />      keystore_pass: a362fbcce236eb098973<br />      key_pass: a362fbcce236eb098973<br />      client_authentication: true<br /></div><div id="wwID0EJHDV" class="Numbered_2_Continued">where access control rule name: <span class="varname">Require HTTP Basic Auth</span> is basic auth authentication, auth_key is the credentials (username and password) in the plain text.</div><div id="wwID0EZHDV" class="Note_2"><span class="Bold">Note:<br /></span>Ensure that the content is indented properly as shown above, so that the YAML parser can parse them correctly.</div><div id="wwID0EQIDV" class="Numbered_2_Continued"><span class="inlinetitle">Hashed credentials</span></div><div id="wwID0E1IDV" class="Numbered_2_Continued">The ReadonlyREST plugin supports obfuscating the credentials by hashing the credentials using <span class="emphasis">SHA256</span> algorithm. Use hashed credentials to keep the application secure.</div><div id="wwID0EFJDV" class="Numbered_2_Continued">Perform the following steps to include hashed credentials for basic authorization in the readonlyrest.yml file.</div><div id="wwID0EKJDV" class="Numbered_2_Continued">To generate the hash code for your password:</div><div id="wwID0EVJDV" class="Numbered_3"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Use the tool 
    <a href="https://xorbin.com/tools/sha256-hash-calculator"
   
     target="external_window"
    ><span class="heading-page">https://xorbin.com/tools/sha256-hash-calculator</span></a> to hash your credentials. This generates the hash code.</div><div id="wwID0ESKDV" class="Numbered_3"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Replace the <span class="parmname">auth_key</span> property in the <span class="inlinetitle">readonlyrest.yml</span> file with <span class="parmname">auth_key_sha256</span> property.</div><div id="wwID0EULDV" class="Numbered_3"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Add the hashed credentials to the property <span class="parmname">auth_key_sha256</span> in <span class="inlinetitle">readonlyrest.yml</span> file located at <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\config</span>.</div><div id="wwID0E2MDV" class="Preformatted_3"><br />readonlyrest:    <br />    access_control_rules:<br /> <br />    - name: "Require HTTP Basic Auth"<br />      type: allow<br />      auth_key_sha256: 927d5619ff87227be6ca8a2cc9ee68c11dd7a08d64d1e20bdc8d86254850b418<br />           <br />    ssl:<br />      enable: true<br />      keystore_file: "node-0-keystore.jks"<br />      keystore_pass: a362fbcce236eb098973<br />      key_pass: a362fbcce236eb098973<br />      client_authentication: true</div><div id="wwID0EBNDV" class="Numbered_3_Continued">where access control rule name: <span class="varname">Require HTTP Basic Auth</span> is basic auth authentication, auth_key_sha256 is the credentials (username and password) in the hashed format and client_authentication is the two way SSL authentication. By default, this property is disabled. You can remove this property or set the value to <span class="userinput">false</span> if you do not want the server or API Gateway Data Store to validate the client authentication.</div><div id="wwID0ERNDV" class="Numbered_3"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Save the configuration file <span class="inlinetitle">readonlyrest.yml</span>.</div><div id="wwID0EKODV" class="Note_2"><span class="Bold">Note:<br /></span>The keystore file and its passwords keystore_pass &amp; key_pass are shipped out with API Gateway product by default. This may not be safe for production environment. For production setup, you can generate your own certificates (keystore and trustore) and configure in the <span class="inlinetitle">readonlyrest.yml</span> file. To generate your own certificates, see 
    <a href="../yai-webhelp/ta-secure_elasticsearch_readonlyrest.html#wwID0EZJEV"
   
     title="How do I Secure API Data Store Communication using HTTPS with ReadonlyREST Plugin?"
    ><span class="heading-page">ReadonlyREST</span></a>.</div><div id="wwID0ESPDV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>After adding plain-text credentials or hashed credentials in readonlyrest.yml file, open the <span class="inlinetitle">elasticsearch.yml</span> file from the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\config</span> folder and add the following configuration to the existing content and save the file.</div><div id="wwID0EUQDV" class="Preformatted_2"><br />http.type: ssl_netty4<br />xpack.security.enabled: false</div><div id="wwID0E1QDV" class="Numbered_2_Continued">This enables HTTPS connection for API Data Store.</div><div id="wwID0ECRDV" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Secure the inter-node communication.</div><div id="wwID0EVRDV" class="Numbered_1_Continued">In a clustered setup, to establish a secure communication between the <span class="ph">API Gateway</span> Data Store instances, perform the following steps:</div><div id="wwID0EFSDV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Open the <span class="inlinetitle">readonlyrest.yml</span> file from the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\config</span> folder and add the following configurations towards the end of the existing content and save the file. This configuration must be added to all the nodes which requires encrypted communication within cluster.</div><div id="wwID0EHTDV" class="Preformatted_2"><br />  ssl_internode:<br />  keystore_file: "node-0-keystore.jks"<br />  keystore_pass: a362fbcce236eb098973<br />  key_pass: a362fbcce236eb098973</div><div id="wwID0ENTDV" class="Numbered_2_Continued">The consolidated content of the <span class="inlinetitle">readonlyrest.yml</span> is as follows:</div><div id="wwID0EXTDV" class="Preformatted_2"><br />    readonlyrest:    <br />    access_control_rules:<br /> <br />    - name: "Require HTTP Basic Auth"<br />      type: allow<br />      auth_key_sha256: 927d5619ff87227be6ca8a2cc9ee68c11dd7a08d64d1e20bdc8d86254850b418<br />           <br />    ssl:<br />      enable: true<br />      keystore_file: "node-0-keystore.jks"<br />      keystore_pass: a362fbcce236eb098973<br />      key_pass: a362fbcce236eb098973<br /> <br />    ssl_internode:<br />      keystore_file: "node-0-keystore.jks"<br />      keystore_pass: a362fbcce236eb098973<br />      key_pass: a362fbcce236eb098973<br />      client_authentication: true</div><div id="wwID0E6TDV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Open the <span class="inlinetitle">elasticsearch.yml</span> file from the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\config</span> folder and add the following configuration to the existing content and save the file.</div><div id="wwID0EBVDV" class="Preformatted_2">transport.type: ror_ssl_internode</div><div id="wwID0E6TDV-7" class="Numbered_2_Continued">This configuration must be added to all the nodes which requires encrypted communication within cluster.</div><div id="wwID0EIVDV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Shutdown and restart the API Data Store node and verify if it is protected by accessing the node in HTTPS URL with the given username and password.</div><div id="wwID0EAWDV" class="Preformatted_2">https://&lt;<span class="varname">host</span>&gt;:<span class="varname">&lt;port&gt;</span></div><div id="wwID0ERWDV" class="Numbered_2_Continued">API Data Store now runs on a secure channel on the HTTPS port and requests the basic authentication details.</div><div class="ww_skin_page_overflow"><div id="wwID0EWWDV" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/restplugin_https_url.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 298px; max-width: 700px; top: 0pt" alt="" /></div></div><div id="wwID0EMXDV" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Change the Kibana configuration to connect to API Data Store.</div><div id="wwID0EEYDV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Open the <span class="inlinetitle">kibana.yml</span> file from the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\profiles\IS_</span><span class="filepath_002c_varname">instance_name</span><span class="filepath">\apigateway\dashboard\config</span> folder.</div><div id="wwID0EMZDV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Remove the # symbol from the following properties and provide the corresponding values for the properties and save the file.</div><div id="wwID0EE1DV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>elasticsearch.customHeaders.Authorization: <span class="userinput">"Basic QWRtaW5pc3RyYXRvcjptYW5hZ2U="</span></div><div id="wwID0E21DV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>elasticsearch.ssl.verificationMode: <span class="userinput">certificate</span></div><div id="wwID0ES2DV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>elasticsearch.ssl.certificateAuthorities: <span class="varname">&lt;file path of your root-ca.pem certificate&gt;</span></div><div id="wwID0EK3DV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>elasticsearch.hosts: [https://&lt;<span class="varname">host</span>&gt;:<span class="varname">&lt;port&gt;</span>]</div><div id="wwID0EH4DV" class="List_3_Continued">Here, <span class="inlinetitle">QWRtaW5pc3RyYXRvcjptYW5hZ2U= </span> is <span class="inlinetitle">Base64 </span> encoded format of username: password - <span class="inlinetitle">Administrator:manage</span>. See 
    <a href="https://forum.readonlyrest.com/t/kibana-error-401/1878"
   
     target="external_window"
    ><span class="heading-page">https://forum.readonlyrest.com/t/kibana-error-401/1878</span></a> for more information.</div><div id="wwID0EG5DV" class="List_3_Continued">Sample kibana.yml file is as follows:</div><div id="wwID0EL5DV" class="Preformatted_3">server.port: 9405<br />server.host: "0.0.0.0"<br />server.basePath: "/apigatewayui/dashboardproxy"<br />elasticsearch.hosts: ["http://localhost:9240"]<br />elasticsearch.customHeaders.Authorization: "Basic QWRtaW5pcRyYXRvcjptYW5hZ2U="<br />elasticsearch.ssl.verificationMode: certificate<br />elasticsearch.ssl.verificationAuthorities: &lt;SAG_Root&gt;/InternalDataStore/sagconfig/root-ca.pem<br />pid.file: "kibana.pid"<br />console.ui.enabled: false</div><div id="wwID0EV5DV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Open the <span class="inlinetitle">uiconfiguration.properties</span> file from the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\profiles\IS_</span><span class="filepath_002c_varname">instance_name</span><span class="filepath">\apigateway\config</span> folder and set the property <span class="inlinetitle">apigw.kibana.autostart</span> to <span class="userinput">false</span>.</div><div id="wwID0EIAEV" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Change the API Gateway configurations to connect to API Data Store.</div><div id="wwID0EABEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Open the <span class="inlinetitle">config.properties</span> file from the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\IntegrationServer\instances\</span><span class="filepath_002c_varname">instance_name</span><span class="filepath">\packages\WmAPIGateway\config\resources\elasticsearch</span> folder.</div><div id="wwID0EICEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Remove the # symbol from the following properties and provide the corresponding values for the properties and save the file.</div><div id="wwID0EADEV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>pg.gateway.elasticsearch.http.username=<span class="userinput">Administrator</span></div><div id="wwID0EXDEV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>pg.gateway.elasticsearch.http.password=<span class="userinput">manage</span></div><div id="wwID0EOEEV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>pg.gateway.elasticsearch.https.truststore.filepath=<span class="userinput_002c_varname">SAG_Install_Dir</span><span class="userinput">​/InternalDataStore/sagconfig/truststore.jks</span></div><div id="wwID0ELFEV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>pg.gateway.elasticsearch.https.truststore.password=<span class="userinput">2c0820e69e7dd5356576</span></div><div id="wwID0ECGEV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>pg.gateway.elasticsearch.https.enabled=<span class="userinput">true</span></div><div id="wwID0E2GEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Start API Data Store.</div><div id="wwID0EOHEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>When API Data Store is up and running, start the Kibana server by running the <span class="inlinetitle">kibana.bat</span> file located at <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\profiles\IS_</span><span class="filepath_002c_varname">default</span><span class="filepath">\apigateway\dashboard\bin</span>.</div><div id="wwID0EWIEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Start API Gateway.</div><div id="wwID0EMJEV" class="Body">You can now log on, create APIs, and access the Analytics page without any challenge window for user credentials.</div><div id="wwID0EZJEV" class="Section_Title">Configuring ReadonlyREST plugin with Self-generated certificates</div><div id="wwID0E5JEV" class="Body">As an API Provider, if you want to generate your own certificates to use with the ReadonlyREST plugin instead of the default certificates that are shipped with API Gateway, you can configure ReadonlyREST with user generated certificates. You have to perform this procedure if your organization does not have policies and procedures in place regarding the generation and use of digital certificates and certificate chains, including the use of certificates signed by a CA and you want to generate a self-signed certificate and import them into the keystore and truststore. Use <span class="inlinetitle">Java Keytool</span> to generate the required certificates for running ReadonlyREST in a production environment.</div><div id="wwID0EPKEV" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Shut down API Gateway, API DataStore, and Kibana.</div><div id="wwID0ECLEV" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Generate <span class="inlinetitle">keystore.jks</span> file.</div><div id="wwID0ESMEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Run the following command from &lt;<span class="emphasis">Java_Install_Directory</span>&gt;/bin to generate keystore certificate in the corresponding file location using Java Keytool:</div><div id="wwID0EONEV" class="Preformatted_2">keytool -genkey -alias <span class="varname">alias_name</span> -keyalg RSA -keystore <span class="varname">file_location</span>\keystore.jks -storetype JKS</div><div id="wwID0EJNEV-2" class="Numbered_2_Continued">The keystore certificate is generated in the file location that you specify.</div><div id="wwID0EAOEV" class="Numbered_2_Continued"><span class="inlinetitle">Example:</span></div><div class="ww_skin_page_overflow"><div id="wwID0EPOEV" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/restplugin_keystore.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 404px; max-width: 1259px; top: 0pt" alt="" /></div></div><div id="wwID0EEPEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Replace the generated keystore.jks file in the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\config folder.</span></div><div id="wwID0EBQEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Update the properties <span class="inlinetitle">keystore_file</span>, <span class="inlinetitle">keystore_pass</span> and <span class="inlinetitle">key_pass</span> in the <span class="inlinetitle">readonlyrest.yml</span> file located at <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\InternalDataStore\config</span>.</div><div id="wwID0ESREV" class="Numbered_2_Continued">Sample <span class="inlinetitle">readonlyrest.yml</span> file is as follows:</div><div id="wwID0E3REV" class="Preformatted_2"><br />readonlyrest:    <br />    access_control_rules:<br /> <br />    - name: "Require HTTP Basic Auth"<br />      type: allow<br />      auth_key: Administrator:manage<br />           <br />    ssl:<br />      enable: true<br />      keystore_file: "keystore.jks"<br />      keystore_pass: &lt;<span class="varname">Keystore pass</span>&gt;<br />      key_pass: &lt;<span class="varname">Key pass</span>&gt;<br />      client_authentication: true</div><div id="wwID0ERSEV" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Export certificate from the keystore to configure in Kibana.yml file:</div><div id="wwID0EJTEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Run the following command to export the certificate from the keystore and place it in the required location. :</div><div id="wwID0E3TEV" class="Preformatted_2">keytool -export -alias <span class="varname">alias_name</span> -keystore <span class="varname">keystore_file_location</span> -rfc -file &lt;<span class="varname">filename</span>&gt;.cert</div><div class="ww_skin_page_overflow"><div id="wwID0EXUEV" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/restplugin_export.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 74px; max-width: 1407px; top: 0pt" alt="" /></div></div><div id="wwID0ESUEV-2" class="Numbered_2_Continued">The exported certificate is saved in the specified location.</div><div id="wwID0ELVEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>After exporting, update the exported certificate name and the file location of the exported certificate in <span class="inlinetitle">elasticsearch.ssl.certificateAuthorities</span> property in <span class="inlinetitle">kibana.yml</span> file located at <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\profiles\IS_</span><span class="filepath_002c_varname">default</span><span class="filepath">\apigateway\dashboard\config</span>.</div><div id="wwID0EYWEV" class="Numbered_2_Continued">Example:</div><div id="wwID0ECXEV" class="Preformatted_2">elasticsearch.ssl.certificateAuthorities: <span class="varname">C:\work\apigateway\test.cert</span></div><div id="wwID0ERXEV" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Generate truststore and import the generated certificate.</div><div id="wwID0EJYEV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Run the following command to generate the truststore file and import the generated certificate into the truststore file.</div><div id="wwID0E3YEV" class="Preformatted_2">keytool -import -alias <span class="varname">alias_name</span> -file <span class="varname">Certificate_file_location</span><br /> -storetype JKS -keystore <span class="varname">file_location_and_file name_for_trustore</span>.jks</div><div class="ww_skin_page_overflow"><div id="wwID0EXZEV" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/restplugin_truststore.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 511px; max-width: 1632px; top: 0pt" alt="" /></div></div><div id="wwID0EL1EV" class="Numbered_2_Continued">The trust store certificate is stored in the specified location. For example: <span class="emphasis">C:\work\apigateway\trustore.jks.</span></div><div id="wwID0EX1EV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Update the details of the generated truststore file in the following properties</div><div id="wwID0EQ2EV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">pg.gateway.elasticsearch.https.truststore.filepath</span></div><div id="wwID0EH3EV" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="parmname">pg.gateway.elasticsearch.https.truststore.password</span> in the <span class="inlinetitle">config.properties</span> file located at <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\IntegrationServer\instances\</span><span class="filepath_002c_varname">default</span><span class="filepath">\packages\WmAPIGateway\config\resources\elasticsearch</span>.</div><div id="wwID0EU4EV" class="Numbered_2_Continued">Example:</div><div id="wwID0E54EV" class="Preformatted_2"><br />pg.gateway.elasticsearch.https.truststore.filepath=<span class="varname">C:/work/apigateway/trustore.jks</span><br />pg.gateway.elasticsearch.https.truststore.password=<span class="varname">your_trustore_password</span></div><div id="wwID0EQ5EV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Start API Data Store.</div><div id="wwID0ED6EV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>When API Data Store is up and running, start the Kibana server by running the <span class="inlinetitle">kibana.bat</span> file located at <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\profiles\IS_</span><span class="filepath_002c_varname">default</span><span class="filepath">\apigateway\dashboard\bin</span>.</div><div id="wwID0ELAFV" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Start <span class="ph">API Gateway</span>.</div><div id="wwID0ESJEV-6" class="Section">You can now log on, create APIs, and access the Analytics page without any challenge window for user credentials.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright © 2016-2023&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>