<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Filebeat</title><link rel="Prev" href="gtw_configure_log_aggregation.html" title="Previous" /><link rel="Next" href="co-log_housekeeping.html" title="Next" /><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/yai-webhelp/co-log_config_flavors.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN_002b3Wz_002fy4aeBvXLE78NkKv1Q" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/yai-webhelp/co-log_config_flavors.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>API Gateway</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.032.html#wwconnect_header">Administering API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.078.html#wwconnect_header">Operating API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/gtw_gen_config.html#wwconnect_header">General Administration Configuration</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/co-logging.html#wwconnect_header">Application Log Configurations</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/gtw_configure_log_aggregation.html#wwconnect_header">Configuring Log Aggregation</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Filebeat</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0EIEIS" class="Heading_5">Filebeat</div><div id="wwID0EQEIS" class="Body">API Gateway uses Filebeat to monitor the log files and forwards them to either API Data Store or external ElasticSearch. Filebeat is shipped along with API Gateway and its configuration can be found in the following location:</div><div id="wwID0EVEIS" class="Body"><span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">/profiles/IS_</span><span class="filepath_002c_varname">Instance_Name</span><span class="filepath">/apigateway/filebeat/filebeat_apigateway.yml</span></div><div id="wwID0EKFIS" class="Body">When log aggregation is enabled, API Gateway initiates the Filebeat process in the background to monitor the log files and forwards the log files to either API Data Store or external Elasticsearch.</div><div id="wwID0EWFIS" class="Section_Title">API Gateway + API Data Store + Terracotta Server</div><div id="wwID0E2FIS" class="Body">In case, if you also want to aggregate Terracotta server logs that are stored in different location, perform the following steps:</div><div id="wwID0EAGIS" class="Body"><span class="inlinetitle">If Terracotta Server and API Gateway is installed in the same machine, perform the following steps:</span></div><div id="wwID0EOGIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>In the <span class="uicontrol">Administration</span> &gt; <span class="uicontrol">General</span> &gt;<span class="uicontrol"> Application logs</span> &gt; <span class="uicontrol">Log aggregation</span> section, disable the log aggregation.</div><div id="wwID0EPHIS" class="Note_1"><span class="Bold">Note:<br /></span>By default, the Terracotta logs are available in the <span class="filepath">(user.home)/terracotta/server-logs</span> location. You can change this folder by specifying the custom log data location in the <span class="uicontrol">tc-config.xml</span>.</div><div id="wwID0EOIIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Update the <span class="uicontrol">filebeat_template.yml</span> file in the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\profiles\IS_</span><span class="filepath_002c_varname">Instance_Name</span><span class="filepath">\apigateway\filebeat</span> location with the following content. Make sure you place the following content below the <span class="uicontrol">DashboardLogs</span> configuration:</div><div id="wwID0EXJIS" class="Preformatted_1">- type: log<br />  # Change to true to enable this prospector configuration.<br />  enabled: true<br />  # Paths that should be crawled and fetched. Glob based paths.<br />  paths:<br />  - C:/Users/alice/terracotta/server-logs/terracotta-server.log<br />  fields:<br />    node: ${NODE}<br />    fileType: TerracottaServerLogs<br />    timezone: ${TIMEZONE}<br />  fields_under_root: true<br />  multiline.pattern: (([\s]+)20[0-9]{2}-)|20[0-9]{2}-<br />  multiline.negate: true<br />  multiline.match: after</div><div id="wwID0E5JIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>In the <span class="uicontrol">Administration</span> &gt; <span class="uicontrol">General</span> &gt;<span class="uicontrol"> Application logs</span> &gt; <span class="uicontrol">Log aggregation</span> section, enable log aggregation.</div><div id="wwID0E6KIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>In the <span class="uicontrol">Analytics</span> &gt; <span class="uicontrol">Application Logs</span> section, check whether the Terracotta Server logs are aggregated.</div><div id="wwID0EZLIS" class="Body"><span class="inlinetitle">If Terracotta Server and API Gateway are installed in different machine, perform the following steps:</span></div><div id="wwID0EHMIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Edit the <span class="uicontrol">tc-config.xml</span> in Terracotta Server with the following content to store the logs in a network location and start the Terracotta Server:</div><div id="wwID0E3MIS" class="Preformatted_1">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;tc:tc-config xmlns:tc="http://www.terracotta.org/config"&gt;<br /> <br />  &lt;servers&gt;<br />    &lt;server host="localhost" name="%h"&gt;<br />      &lt;data&gt;C:/install/TerraCottaServer/Terracotta/server/bin/data&lt;/data&gt;<br />      &lt;logs&gt;//worstation01/share/tcserverlog&lt;/logs&gt;   <br />      &lt;offheap&gt;<br />        &lt;enabled&gt;true&lt;/enabled&gt;<br />        &lt;maxDataSize&gt;512m&lt;/maxDataSize&gt;<br />      &lt;/offheap&gt;<br />    &lt;/server&gt;<br />    &lt;restartable enabled="true"/&gt;<br />  &lt;/servers&gt;<br />&lt;/tc:tc-config&gt;</div><div id="wwID0EDNIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>In the <span class="uicontrol">Administration</span> &gt; <span class="uicontrol">General</span> &gt;<span class="uicontrol"> Application logs</span> &gt; <span class="uicontrol">Log aggregation</span> section, disable log aggregation.</div><div id="wwID0EEOIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Update the <span class="uicontrol">filebeat_template.yml</span> file in the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\profiles\IS_</span><span class="filepath_002c_varname">Instance_Name</span><span class="filepath">\apigateway\filebeat</span> location with the following content. Make sure you place the following content below the <span class="uicontrol">DashboardLogs</span> configuration:</div><div id="wwID0ENPIS" class="Preformatted_1">- type: log<br />  # Change to true to enable this prospector configuration.<br />  enabled: true<br />  # Paths that should be crawled and fetched. Glob based paths.<br />  paths:<br />  - //mckmut02/share/tc-server-logs/terracotta-server.log<br />  fields:<br />    node: ${NODE}<br />    fileType: TerracottaServerLogs<br />    timezone: ${TIMEZONE}<br />  fields_under_root: true<br />  multiline.pattern: (([\s]+)20[0-9]{2}-)|20[0-9]{2}-<br />  multiline.negate: true<br />  multiline.match: after</div><div id="wwID0EUPIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>In the <span class="uicontrol">Administration</span> &gt; <span class="uicontrol">General</span> &gt;<span class="uicontrol"> Application logs</span> &gt; <span class="uicontrol">Log aggregation</span> section, enable the log aggregation.</div><div id="wwID0EVQIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>In the <span class="uicontrol">Analytics</span> &gt; <span class="uicontrol">Application Logs</span> section, check whether the Terracotta Server logs are aggregated.</div><div id="wwID0EXRIS" class="Section_Title">Configuring Log for Elasticsearch Client in API Gateway</div><div id="wwID0E3RIS" class="Body">API Gateway uses Elasticsearch REST client to connect to API Data Store or External Elasticsearch. By Default, the logs that are created by these REST clients are ignored to avoid over logging. To troubleshoot or diagnose elasticsearch calls from API Gateway, you can manually configure the log configuration for Elasticsearch REST client using the following steps:</div><div id="wwID0EFSIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Open the <span class="uicontrol">log4j2.properties</span> located at <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\profiles\IS_</span><span class="filepath_002c_varname">Instance_Name</span><span class="filepath">\configuration\logging</span>.</div><div id="wwID0EKTIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Add the following configuration at the end of the file:</div><div id="wwID0E2TIS" class="Preformatted_1">logger.10.name=org.elasticsearch.client<br />logger.10.additivity=false<br />logger.10.level=info<br />logger.10.appenderRef.lar.ref=ESRestClient<br /> <br />logger.11.name=org.apache.http<br />logger.11.additivity=false<br />logger.11.level=info<br />logger.11.appenderRef.lar.ref=ESRestClient<br /> <br />logger.12.name=org.apache.http.wire<br />logger.12.additivity=false<br />logger.12.level=info<br />logger.12.appenderRef.lar.ref=ESRestClient<br /> <br />logger.13.name=org.apache.http.impl.conn<br />logger.13.additivity=false<br />logger.13.level=info<br />logger.13.appenderRef.lar.ref=ESRestClient<br /> <br />appender.esrestclient.name=ESRestClient<br />appender.esrestclient.type=RollingFile<br />appender.esrestclient.fileName=&lt;INSTALL_LOCATION&gt;/IntegrationServer/instances/default/logs/ESRestClient.log<br />appender.esrestclient.filePattern=&lt;INSTALL_LOCATION&gt;/IntegrationServer/instances/default/logsESRestClient.log.%i<br />appender.esrestclient.layout.type=PatternLayout<br />appender.esrestclient.layout.pattern=%d [%t] %-5p %c %x - %m%n<br />appender.esrestclient.policies.type=Policies<br />appender.esrestclient.policies.size.type=SizeBasedTriggeringPolicy<br />appender.esrestclient.policies.size.size=10MB<br />appender.esrestclient.strategy.type=DefaultRolloverStrategy<br />appender.esrestclient.strategy.max=10<br />#This is a custom Platform provided filter which matches all log messages that contain OSGi data in MDC (bundle.id, component.name, etc.)<br />appender.esrestclient.filter.osgi.type=LogServiceFilter<br />appender.esrestclient.filter.osgi.onMatch=DENY<br />appender.esrestclient.filter.osgi.onMismatch=NEUTRAL</div><div id="wwID0ECUIS" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Restart API Gateway.</div><div id="wwID0ETUIS" class="Numbered_1_Continued">You can see the ESRestClient.log at the <span class="filepath_002c_varname">SAG_Install_Dir</span><span class="filepath">\IntegrationServer\instances\</span><span class="filepath_002c_varname">instance_name</span><span class="filepath">\logs</span> location. You can see the request sent to particular elasticsearch node and what is the response status code in the ESRestClient.log</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright © 2016-2023&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>