<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Upgrading API Gateway cluster</title><link rel="Prev" href="ta-upgrading_standalone_apigw_direct_mode.html" title="Previous" /><link rel="Next" href="co-upgrade_configs.html" title="Next" /><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/yai-webhelp/ta-upgrading_apigw_cluster_direct_mode.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pgBWJ4i6v_002fn4ENgQX3zNMRg" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/yai-webhelp/ta-upgrading_apigw_cluster_direct_mode.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>API Gateway</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.801.html#wwconnect_header">Upgrading and Migrating to API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/to-upgrading_apigw_landing_page.html#wwconnect_header">Upgrading API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Upgrading API Gateway cluster</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0E2ZJ4" class="Heading_2">Upgrading <span class="ph">API Gateway</span> cluster</div><div id="wwID0EV2J4" class="Note"><span class="Bold">Note:<br /></span>This procedure is applicable only for on-premise installation.</div><div id="wwID0EO2J4-2" class="Context"><span class="inlinetitle">Prerequisites:</span></div><div id="wwID0EW3J4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Install latest fixes in both source and target versions.</div><div id="wwID0EJ4J4" class="Note_1"><span class="Bold">Note:<br /></span>The version of target <span class="ph">API Gateway</span> must be higher than the source <span class="ph">API Gateway</span> instance. Source <span class="ph">API Gateway</span> versions of 10.3 and later can be upgraded to <span class="ph">API Gateway</span> 10.15.</div><div id="wwID0ER5J4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>If custom keystore or truststore files are used in the source <span class="ph">API Gateway</span> installation, copy the files to the same location in the target installation.</div><div id="wwID0EJ6J4" class="Body">The following image illustrates the different stages in upgrading an <span class="ph">API Gateway</span> cluster:</div><div class="ww_skin_page_overflow"><div id="wwID0ET6J4" class="Figure"><img class="Default" src="../yai-webhelp/images/upgrade_apigw_cluster_flow.PNG" width="100%" style="display: block; float: none; left: 0pt; max-height: 484px; max-width: 534px; top: 0pt" alt="" /></div></div><div id="wwID0EEAK4" class="Body">The <span class="ph">API Gateway</span> migration utility provides the support to:</div><div id="wwID0EUAK4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Separately migrate Elasticsearch and <span class="ph">API Gateway</span> file configurations.</div><div id="wwID0ELBK4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Migrate data from externally configured Elasticsearch.</div><div id="wwID0E5BK4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Log all the migration data in a single file, that is migrationLog.txt.</div><div id="wwID0ERCK4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Revert in case of failure in Elasticsearch data migration.</div><div id="wwID0EFDK4" class="Note"><span class="Bold">Note:<br /></span>In the <span class="ph">API Gateway</span> versions 10.2 and above, the folder name EventDataStore is changed to InternalDataStore. Throughout this section, the source <span class="ph">API Gateway</span> installation directory is referred as <span class="varname">&lt;SOURCE&gt;</span> and the target <span class="ph">API Gateway</span> installation directory is referred as <span class="varname">&lt;TARGET&gt;</span>.</div><div id="wwID0EREK4" class="procedure"><span><img src="icon_task_xpe.png" alt="*" border="0" width="20" height="13" /></span>To upgrade an <span class="ph">API Gateway</span> cluster</div><div id="wwID0ECFK4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span><span class="Command">Configure the </span><span class="Command_002c_parmname">path.repo</span><span class="Command"> property in the source elasticsearch.yml file located at </span><span class="Command_002c_filepath_002c_varname">&lt;SOURCE&gt;</span><span class="Command_002c_filepath">\InternalDataStore\config</span><span class="Command">. Make sure that the path.repo is a shared network folder and is accessible for all the Elasticsearch nodes in the cluster. </span></div><div id="wwID0ENGK4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span><span class="Command">Configure the </span><span class="Command_002c_parmname">reindex.remote.whitelist</span><span class="Command"> property in the target elasticsearch.yml file for re-indexing the data in the target Elasticsearch. This YAML file is located at </span><span class="Command_002c_filepath_002c_varname">&lt;TARGET&gt;</span><span class="Command_002c_filepath">\InternalDataStore\config</span><span class="Command">. The </span><span class="Command_002c_parmname">reindex.remote.whitelist</span><span class="Command"> property copies the documents from the </span><span class="Command_002c_varname">&lt;SOURCE&gt;</span><span class="Command"> to </span><span class="Command_002c_varname">&lt;TARGET&gt;</span><span class="Command"> Elasticsearch instances. </span></div><div id="wwID0EPIK4" class="Body_1">Syntax for <span class="parmname">reindex.remote.whitelist</span> property in the target elasticsearch.yml file is as follows:</div><div id="wwID0E1IK4" class="Preformatted_1">reindex.remote.whitelist: &lt;source_host&gt;:&lt;source_port&gt;</div><div id="wwID0EAJK4" class="Note_1"><span class="Bold">Note:</span>&nbsp;</div><div id="wwID0E1JK4" class="List_2_-_Note"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>The <span class="codeph">reindex.remote.whitelist</span> value in the target elasticsearch.yml file must match the value of the <span class="codeph">pg.gateway.elasticsearch.hosts</span> property present in the config.properties file located at <span class="filepath">&lt;SOURCE&gt;\IntegrationServer\instances\default\packages\WmAPIGateway\config\resource\elasticsearch</span>.</div><div id="wwID0EZKK4" class="List_2_-_Note_-_not_first"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>For managed Elasticsearch instances, you do not have to configure the <span class="parmname">reindex.remote.whitelist</span> property.</div><div id="wwID0ETLK4" class="Body_1">An example for the <span class="codeph">reindex.remote.whitelist</span> property in the elasticsearch.yml file is as follows:</div><div id="wwID0E4LK4" class="Preformatted_1"><br />cluster.name: SAG_EventDataStore<br />node.name: SAG-1YVHZY21633236119876<br />path.logs: C:\SoftwareAG_1011\InternalDataStore/logs<br />network.host: 0.0.0.0<br />http.port: 9240<br />discovery.seed_hosts: ["hostname1:9340","hostname2:9340","hostname3:9340"]<br />transport.tcp.port: 9340<br />path.repo: ['C:\SoftwareAG_1011\InternalDataStore/archives']<br />cluster.initial_master_nodes: ["node1","node2","node3"]<br />reindex.remote.whitelist: localhost:9240<br /></div><div id="wwID0EFMK4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span><span class="Command_002c_emphasis">Optional.</span><span class="Command"> Configure the source Elasticsearch host and port details in the config.properties file located at </span><span class="Command_002c_filepath_002c_varname">&lt;SOURCE&gt;</span><span class="Command_002c_filepath">\IntegrationServer\instances\default\packages\WmAPIGateway\config\resources\elasticsearch</span><span class="Command">. </span></div><div id="wwID0EUNK4" class="Body_1">Syntax for Elasticsearch host and port details in the source config.properties file is as follows:</div><div id="wwID0EZNK4" class="Preformatted_1">pg.gateway.elasticsearch.hosts=<span class="varname">&lt;source_host&gt;</span>:<span class="varname">&lt;source_port&gt;</span></div><div id="wwID0EJOK4" class="Body_1">Configure the source Elasticsearch host and port details for all the <span class="ph">API Gateway</span> nodes in the cluster.</div><div id="wwID0ETOK4" class="Note_1"><span class="Bold">Note:<br /></span>This step is applicable only if the source <span class="ph">API Gateway</span> version is 10.1. From versions 10.2 and above, the Elasticsearch host and port values are populated automatically.</div><div id="wwID0EPPK4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span><span class="Command">Configure the basic authentication credentials to connect to the source Elasticsearch, if the source Elasticsearch is protected. </span></div><div id="wwID0EMQK4" class="Body_1">To configure the basic authentication credentials, add the following properties to the config.properties file located at <span class="filepath_002c_varname">&lt;SOURCE&gt;</span><span class="filepath">\IntegrationServer\instances\default\packages\WmAPIGateway\config\resources\elasticsearch</span>:</div><div id="wwID0E3QK4" class="Preformatted_1"><br />pg.gateway.elasticsearch.http.username=<span class="varname">&lt;username&gt;</span><br />pg.gateway.elasticsearch.http.password=<span class="varname">&lt;password&gt;</span></div><div id="wwID0EMRK4" class="Body_1">Configure the basic authentication credentials for all the <span class="ph">API Gateway</span> nodes in the cluster.</div><div id="wwID0EYRK4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span><span class="Command">Configure the certificates to connect to the source Elasticsearch. </span></div><div id="wwID0EVSK4" class="Body_1">If the source Elasticsearch is protected with HTTPS, add the source certificates (public key) into the target Elasticsearch JVM's truststore. For example, in case of API Data Store, add the public keys to the truststore cacerts file located at <span class="filepath_002c_varname">&lt;TARGET&gt;</span><span class="filepath">\jvm\jvm\jre\lib\security</span>. Do for all the target <span class="ph">API Gateway</span> nodes.</div><div id="wwID0EJTK4" class="Note_1"><span class="Bold">Note:<br /></span>If, external Elasticsearch is used for the target <span class="ph">API Gateway</span>, then the certificates must be imported to its corresponding JVM.</div><div id="wwID0EDUK4" class="Body_1">Sample command to import the truststore of the source Elasticsearch into the target Elasticsearch JVM is as follows:</div><div id="wwID0EIUK4" class="Preformatted_1"><span class="varname">&lt;TARGET&gt;</span>\jvm\jvm\bin\keytool -import -keystore <span class="varname">&lt;TARGET&gt;</span>\jvm\jvm\jre\lib\security\cacerts -file <span class="varname">&lt;truststore.jks&gt;</span> -alias <span class="varname">&lt;alias&gt;</span></div><div class="ww_skin_page_overflow"><table class="rules2" cellspacing="0" summary=""><tr><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 24.1%"><div id="wwID0E2VK4" class="Table_Cell_Head">Property</div></td><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 75.8%"><div id="wwID0EBWK4" class="Table_Cell_Head">Description</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EOWK4" class="Table_Cell"><span class="varname">truststore.jks</span></div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EZWK4" class="Table_Cell">Truststore used in <span class="varname">&lt;SOURCE&gt;</span> Elasticsearch. Provide the full path of the truststore.</div><div id="wwID0EEXK4" class="Table_Cell">For 10.1, it is be available at <span class="filepath_002c_varname">&lt;SOURCE&gt;</span><span class="filepath">\WmAPIGateway\config\resources\bean\gateway-es-store.xml</span> and the property is <span class="codeph">&lt;prop key="searchguard.ssl.http.truststore_filepath"\&gt;sagconfig/root-ca.jks\&lt;/prop&gt;</span></div><div id="wwID0EYXK4" class="Table_Cell">For 10.2 and above, it is available at <span class="filepath_002c_varname">&lt;SOURCE&gt;</span><span class="filepath">\WmAPIGateway\config\resources\elasticsearch\config.properties</span> and the property is <span class="parmname">pg.gateway.elasticsearch.https.truststore.filepath</span>.</div><div id="wwID0ENYK4" class="Table_Cell">Example: sagconfig/root-ca.jks</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EXYK4" class="Table_Cell"><span class="varname">alias</span></div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0ECZK4" class="Table_Cell">Alias used in <span class="varname">&lt;SOURCE&gt;</span> Elasticsearch.</div><div id="wwID0ENZK4" class="Table_Cell">Example: wm.sag.com</div></td></tr></table></div><div id="wwID0EZZK4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span><span class="Command"> Start both the source and target Elasticsearch instances and make sure that </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> (</span><span class="Command_002c_Command">Integration Server</span><span class="Command">) instances are not started. </span></div><div id="wwID0ED2K4" class="Note_1"><span class="Bold">Note:<br /></span>Avoid port conflict. If the source and target <span class="ph">API Gateway</span> instances are running in the same machine, then you might not be able to start both the source and target Elasticsearch instances in parallel with the default port configurations. In this case, the target Elasticsearch instance port can be changed temporarily for performing the migration. Both, HTTP and TCP ports must be changed. To change the target Elasticsearch instance ports:</div><div id="wwID0EC3K4" class="Numbered_2_-_Note_-_not_first"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Open the elasticsearch.yml file located at <span class="filepath_002c_varname">&lt;TARGET&gt;</span><span class="filepath">/InternalDataStore/config</span>. Change the value of the HTTP port in the <span class="codeph">http.port</span> property, and TCP port in the <span class="codeph">transport.tcp.port</span> property.</div><div id="wwID0EH4K4" class="Numbered_2_-_Note_-_not_first"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Open the config.properties file located at <span class="filepath_002c_varname">&lt;TARGET&gt;</span><span class="filepath">/IntegrationServer/instances/default/packages/WmAPIGateway/config/resources/elasticsearch</span> and find the <span class="codeph">pg.gateway.elasticsearch.hosts</span> property. If the property is set to <span class="codeph">changeOnInstall</span>, then do not make further changes to property. If a port is configured, then update it to a new value.</div><div id="wwID0EO5K4" class="Body_1">Revert the temporary target Elasticsearch instance ports to the default port configurations, after completing the migration and the target Elasticsearch instance is shutdown.</div><div id="wwID0ET5K4" class="Body_1">If you are reverting the elasticsearch ports in the elasticsearch.yml file after the migration, then you need to specify the same ports in the config.properties file located at <span class="filepath_002c_varname">&lt;TARGET&gt;</span><span class="filepath">/IntegrationServer/instances/default/packages/WmAPIGateway/config/resources/elasticsearch</span>.</div><div id="wwID0EF6K4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>7. </span></span><span class="Command">Migrate the </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> assets and the analytics data, based on volume of data you are migrating. Go to </span><span class="Command_002c_filepath_002c_varname">&lt;TARGET&gt;</span><span class="Command_002c_filepath">\IntegrationServer\instances\default\packages\WmAPIGateway\bin\migrate</span><span class="Command"> and run any one of the following migration utility command. </span></div><div id="wwID0EVAL4" class="Note_1"><span class="Bold">Note:<br /></span>Before running the migration utility command, set up the target Elasticsearch cluster and make sure that all the source and target Elasticsearch instances in the clusters are up and running. Also, do not start the <span class="ph">API Gateway</span> instances on any of the nodes.</div><div id="wwID0EWBL4" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span><span class="Command">If the </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> analytics data volume is less, migrate the whole Elasticsearch or API Data Store data. The </span><span class="Command_002c_codeph">migrate.bat datastore</span><span class="Command"> command to migrate the whole Elasticsearch or API Data Store data is as follows: </span></div><div id="wwID0EFDL4" class="Preformatted_2">migrate.bat datastore -dstoreSrc <span class="varname">&lt;full path to source Elasticsearch config.properties&gt;</span></div><div id="wwID0ERDL4" class="Note_2"><span class="Bold">Note:<br /></span>You should run the <span class="codeph">migrate.bat datastore</span> command in only one target <span class="ph">API Gateway</span> node of the cluster.</div><div class="ww_skin_page_overflow"><table class="rules3" cellspacing="0" summary=""><tr><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 15.7%"><div id="wwID0EJFL4" class="Table_Cell_Head">Property</div></td><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 84.2%"><div id="wwID0EPFL4" class="Table_Cell_Head">Description</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top" rowspan="2"><div id="wwID0E3FL4" class="Table_Cell">dstoreSrc</div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EJGL4" class="Table_Cell">If the source and target <span class="ph">API Gateway</span> instances are running on the same machine, provide the location where <span class="varname">&lt;SOURCE&gt;</span> config.properties file is located. Sample command is as follows:</div><div id="wwID0EYGL4" class="Preformatted">migrate.bat datastore -dstoreSrc<span class="varname">&lt;SOURCE&gt;</span>\IntegrationServer\instances\default\packages​\​<br />WmAPIGateway\config\resources\elasticsearch\config.properties</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EPHL4" class="Table_Cell">If the source and target instances are running on different machines, then the source installation directory or the Elasticsearch config.properties file must be shared in the network. Otherwise, copy and paste the source config.properties file to the shared location. Sample command is as follows:</div><div id="wwID0EUHL4" class="Preformatted">migrate.bat datastore -dstoreSrc\chebackup01\installations\source\IntegrationServer\instances\default\<br />packages\WmAPIGateway\​config\resources\elasticsearch\config.properties</div></td></tr></table></div><div id="wwID0EBIL4" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span><span class="Command">If the </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> analytics data volume is high, migrate only the core data using the </span><span class="Command_002c_codeph">migrate.bat reindex</span><span class="Command"> command, and migrate the analytics data using the backup and restore command. </span></div><div id="wwID0ELJL4" class="Note_2"><span class="Bold">Note:<br /></span>This step is applicable only, when the source <span class="ph">API Gateway</span> version is greater than or equal to 10.11, and is not applicable when the source <span class="ph">API Gateway</span> version is less than or equal to 10.7.</div><div id="wwID0EJKL4" class="Body_2"><span class="inlinetitle">Migrate only the core data</span></div><div id="wwID0ETKL4" class="Body_2">The migration utility command to migrate only the core data is as follows:</div><div id="wwID0EYKL4" class="Preformatted_2">migrate.bat reindex <br />-sourceESHostUrl <span class="varname">&lt;source Elastic search host url&gt;</span> </div><div class="ww_skin_page_overflow"><table class="rules3" cellspacing="0" summary=""><tr><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 22.8%"><div id="wwID0E5LL4" class="Table_Cell_Head">Property</div></td><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 77.1%"><div id="wwID0EEML4" class="Table_Cell_Head">Description</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0ERML4" class="Table_Cell">sourceESHostUrl</div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EXML4" class="Table_Cell">The source Elasticsearch or API Data Store URL. Sample command is as follows:</div><div id="wwID0E4ML4" class="Preformatted">migrate.bat reindex -sourceESHostUrl localhost:9240</div></td></tr></table></div><div id="wwID0EINL4" class="Body_2"><span class="inlinetitle">Migrate the analytics data using backup and restore </span></div><div id="wwID0EURL4" class="Body_2">The steps to migrate the analytics data using backup and restore command is as follows:</div><div id="wwID0E6RL4" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Take a backup of the analytics data from the source <span class="ph">API Gateway</span> instance using the following command:</div><div id="wwID0EWSL4" class="Preformatted_3"><span class="varname">&lt;SOURCE&gt;</span>\IntegrationServer\instances\​​default\packages\WmAPIGateway\​cli\bin\apigatewayUtil<br />create backup ​​-include ​analytics ​-name <span class="varname">&lt;backup_file_name&gt;</span></div><div id="wwID0E6RL4-5" class="List_3_Continued">For more information on taking backup, see 
    <a href="../yai-webhelp/ta-run_backup_script.html#wwID0EE4MO"
   
     title="Creating API Data Store Backup"
    ><span class="ph_002c_heading-page">Creating API Data Store Backup</span></a>.</div><div id="wwID0EWTL4" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Copy the backup file to the target <span class="ph">API Gateway</span> instance <span class="codeph">path.repo</span> folder configured under <span class="filepath_002c_varname">&lt;TARGET&gt;</span><span class="filepath">\IntegrationServer\InternalDataStore\config\elasticsearch.yml</span>.</div><div id="wwID0E2UL4" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Restore the backup data in the target <span class="ph">API Gateway</span> instance using the following command:</div><div id="wwID0ESVL4" class="Preformatted_3"><span class="varname">&lt;TARGET&gt;</span>\IntegrationServer\instances\​​default\packages\WmAPIGateway\​cli\bin\apigatewayUtil <br />restore backup ​​-include ​analytics ​-name <span class="varname">&lt;backup_file_name&gt;</span>.</div><div id="wwID0E2UL4-5" class="List_3_Continued">For more information on restoring backup, see 
    <a href="../yai-webhelp/ta-restore_using_script.html#wwID0E1HZO"
   
     title="Restoring Data Store Backup"
    ><span class="ph_002c_heading-page">Restoring Data Store Backup</span></a>.</div><div id="wwID0EYWL4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>8. </span></span><span class="Command">Migrate the platform configurations. </span></div><div id="wwID0EVXL4" class="Body_1">To migrate the platform configurations using externalized configurations, you can use the <span class="codeph">migrate.bat apigateway</span> command to migrate the platform configurations. To use the <span class="codeph">migrate.bat apigateway</span> command, go to <span class="filepath_002c_varname">&lt;TARGET&gt;</span><span class="filepath">\IntegrationServer\instances\default\packages\WmAPIGateway\bin\migrate</span> and run the following command.</div><div id="wwID0ENYL4" class="Preformatted_1">migrate.bat apigateway -srcDir &lt;SOURCE&gt; -instanceName &lt;source instance name&gt; -newInstanceName &lt;target instance name&gt;</div><div id="wwID0ETYL4" class="Note_1"><span class="Bold">Note:<br /></span>You should run the <span class="codeph">migrate.bat apigateway</span> command in all the target <span class="ph">API Gateway</span> nodes of the cluster.</div><div class="ww_skin_page_overflow"><table class="rules2" cellspacing="0" summary=""><tr><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 19.6%"><div id="wwID0EL1L4" class="Table_Cell_Head">Property</div></td><td class="Table_Cell_Head" style="background-color: #CFCFCE; border-bottom-color: #0899CC; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; width: 80.3%"><div id="wwID0ER1L4" class="Table_Cell_Head">Description</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top" rowspan="2"><div id="wwID0E51L4" class="Table_Cell">srcDir</div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EL2L4" class="Table_Cell">If the source <span class="ph">API Gateway</span> instance is installed on the same machine, provide the source <span class="ph">API Gateway</span> installation directory. Sample command is as follows:</div><div id="wwID0EZ2L4" class="Preformatted">-srcDir C:\installations\source</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EK3L4" class="Table_Cell">If the source <span class="ph">API Gateway</span> instance is installed on a different machine, then share the entire installation folder. Sample command is as follows:</div><div id="wwID0EU3L4" class="Preformatted">-srcDir \chebackup01\source</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0E63L4" class="Table_Cell">instanceName</div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EF4L4" class="Table_Cell"><span class="emphasis">Optional.</span></div><div id="wwID0EP4L4" class="Table_Cell">Provide the <span class="varname">&lt;SOURCE&gt; </span> instance name that you want to migrate. If you do not provide any name, then the default instance is used. Sample command is as follows:</div><div id="wwID0E14L4" class="Preformatted">-instanceName test</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EF5L4" class="Table_Cell">newInstanceName</div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: thin; padding-left: 2pt; padding-right: 2pt; vertical-align: top"><div id="wwID0EL5L4" class="Table_Cell"><span class="emphasis">Optional.</span></div><div id="wwID0EV5L4" class="Table_Cell">Provide the <span class="varname">&lt;TARGET&gt; </span> instance name that you want to migrate to. If you do not provide any name, then the default instance is used. If you have created a new instance other than the default in <span class="ph">Integration Server</span> and you want to migrate to the new instance then provide its name. Sample command is as follows:</div><div id="wwID0EE6L4" class="Preformatted">-newInstanceName prod</div></td></tr></table></div><div id="wwID0ER6L4" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>9. </span></span><span class="Command">Perform these steps after migrating the platform data and platform logs. </span></div><div id="wwID0EPAM4" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span><span class="Command"> Shutdown the target Elasticsearch instance. </span></div><div id="wwID0EHBM4" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span><span class="Command"> Start the target </span><span class="Command_002c_Command">API Gateway</span><span class="Command"> server. </span></div><div id="wwID0EMCM4" class="Body_1">The <span class="ph">API Gateway</span> upgrade is complete.</div><div id="wwID0E3CM4" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>You can find the logs at the target directory <span class="filepath_002c_varname">&lt;TARGET&gt;</span><span class="filepath">/install/logs/migrationLog.txt</span>.</div><div id="wwID0EZDM4" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>You can find the <span class="ph">API Gateway</span> migration reports at <span class="filepath_002c_varname">&lt;TARGET&gt;</span><span class="filepath">\install\logs\APIGW_Migration_Reports_&lt;date_time&gt;</span>.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright © 2016-2023&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>