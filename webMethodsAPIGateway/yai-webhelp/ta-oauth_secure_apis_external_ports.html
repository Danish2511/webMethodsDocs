<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Securing APIs Using OAUTH 2.0 In API Gateway Using External Ports</title><link rel="Prev" href="ta-oauth_thridparty_oauth_server.html" title="Previous" /><link rel="Next" href="ta-oauth_define_multiple_scopes.html" title="Next" /><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/yai-webhelp/ta-oauth_secure_apis_external_ports.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pc1dgJKpX0JQ53zygEL80dA" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/yai-webhelp/ta-oauth_secure_apis_external_ports.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>API Gateway</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.503.html#wwconnect_header">Using API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.535.html#wwconnect_header">Implement APIs</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/gtw_manage_policies.html#wwconnect_header">Policies</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/gtw_iam_policies.html#wwconnect_header">Identify and Access</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/re-iam_identify_authorize_app.html#wwconnect_header">Identify &amp; Authorize</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Securing APIs Using OAUTH 2.0 In API Gateway Using External Ports</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0E16CY" class="Heading_5">Securing APIs Using OAUTH 2.0 In API Gateway Using External Ports</div><div id="wwID0ECADY" class="Context">This use case defines OAuth2.0 authentication protocol that identifies and authorizes a client application using external ports. In <span class="ph">API Gateway</span> OAuth2.0, you can configure services using both primary and external ports. When you do not want to expose the primary port to the outside world, you can configure an external port. This external port is exposed to the outside world for allowing users to consume the APIs.</div><div id="wwID0ENADY" class="Body">This use case explains, with a simple example, how to secure an API with OAuth2 authentication using external ports. This example uses Client Credentials as the grant type and a single instance of <span class="ph">API Gateway</span> server. The diagram illustrates the work flow for this use case.</div><div class="ww_skin_page_overflow"><div id="wwID0EWADY" class="Figure"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_visual.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 344px; max-width: 747px; top: 0pt" alt="External ports workflow" /></div></div><div id="wwID0ENBDY" class="Section_Title">Actors</div><div id="wwID0EWBDY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Developers with basic knowledge on webMethods<span class="ph">API Gateway</span>, <span class="ph">Integration Server</span>, OAuth2 architecture.</div><div id="wwID0EPCDY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Customers with basic knowledge on webMethods <span class="ph">API Gateway</span>, <span class="ph">Integration Server</span>, OAuth2 architecture.</div><div id="wwID0ERDDY" class="Section_Title">Before you begin</div><div id="wwID0EWDDY" class="Body">Ensure that you have:</div><div id="wwID0E6DDY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Installed <span class="ph">Integration Server</span> with <span class="ph">API Gateway</span>.</div><div id="wwID0EYEDY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Knowledge about any Rest Client.</div><div id="wwID0EJFDY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="ph">API Gateway</span> up and running.</div><div id="wwID0EGGDY" class="Section_Title">Basic Flow</div><div id="wwID0ELGDY" class="Body">The following diagram depicts the high level steps of the basic flow for this use case.</div><div class="ww_skin_page_overflow"><div id="wwID0EQGDY" class="Figure"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_ports_flow.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 165px; max-width: 533px; top: 0pt" alt="oauth external ports" /></div></div><div id="wwID0EIHDY" class="Section_Title">Step 1: Configure external port</div><div id="wwID0ETHDY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Enable OAuth 2 authorization through HTTP in <span class="ph">API Gateway</span>.</div><div id="wwID0EKIDY" class="Numbered_1_Continued">To enable <span class="ph">API Gateway</span> to accept request through HTTP, you must set the value of <span class="uicontrol">pg_oauth2_isHTTPS</span> to <span class="userinput">false</span> as follows.</div><div id="wwID0E6IDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Expand the menu options in the title bar and select <span class="uicontrol">Administration</span>.</div><div id="wwID0EUJDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Select <span class="uicontrol">General</span> &gt; <span class="uicontrol">Extended settings</span>.</div><div id="wwID0ENKDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Click <span class="uicontrol">Show and hide</span> keys.</div><div id="wwID0ECLDY" class="Numbered_2_Continued">This displays all the configurable parameters.</div><div id="wwID0EILDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Set the value of <span class="uicontrol">pg_oauth2_isHTTPS</span> to <span class="userinput">false</span>.</div><div id="wwID0EBMDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Click <span class="uicontrol">Save</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EWMDY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_ports_extd_setting.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 480px; max-width: 752px; top: 0pt" alt="configure external port" /></div></div><div id="wwID0EJNDY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Enable OAuth 2 service using the external port.</div><div id="wwID0E1NDY" class="Numbered_1_Continued">For the OAuth service to be available through external ports, set the value of <span class="uicontrol">watt.server.revInvoke.proxyMapUserCerts</span> property to <span class="userinput">true</span> as follows. The default value of this property is <span class="userinput">false</span>.</div><div id="wwID0EPODY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Expand the menu options in the title bar and select <span class="uicontrol">Administration</span>.</div><div id="wwID0EEPDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Select <span class="uicontrol">General </span>&gt; <span class="uicontrol">Extended Settings</span>.</div><div id="wwID0E4PDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Click <span class="uicontrol">Show and hide</span> keys.</div><div id="wwID0ESQDY" class="Numbered_2_Continued">This displays all the configurable parameters.</div><div id="wwID0EYQDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Set the value of <span class="uicontrol">watt.server.revInvoke.proxyMapUserCerts</span> property to <span class="userinput">true</span>.</div><div id="wwID0ERRDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Click <span class="uicontrol">Save</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EHSDY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_ports_watt_setting.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 453px; max-width: 725px; top: 0pt" alt="extended setting for external port" /></div></div><div id="wwID0EYSDY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Create external and registration ports in <span class="ph">API Gateway</span>.</div><div id="wwID0EPTDY" class="Numbered_1_Continued">The external client requests come to an external port, which delegates the request to its paired port, that is the registration port.</div><div id="wwID0EXTDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Expand the menu options in the title bar and select <span class="uicontrol">Administration</span>.</div><div id="wwID0EMUDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Select <span class="uicontrol">Security </span>&gt; <span class="uicontrol">Ports</span> and click on <span class="uicontrol">Add Ports</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EJVDY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_ports_add.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 239px; max-width: 785px; top: 0pt" alt="registration port extended setting" /></div></div><div id="wwID0ELWDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Select the type of port as <span class="uicontrol">API Gateway external </span>and click <span class="uicontrol">Add</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EFXDY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_select_port.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 366px; max-width: 742px; top: 0pt" alt="add port" /></div></div><div id="wwID0EWXDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Provide the following information:</div><div id="wwID0EKYDY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">External port</span>: <span class="userinput">1234</span></div><div id="wwID0EBZDY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Alias</span>: <span class="userinput">ExtPort</span></div><div id="wwID0E1ZDY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Under <span class="ph">API Gateway</span> registration listener configuration, provide the following information:</div><div id="wwID0ES1DY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Registration port</span>: <span class="userinput">4567</span></div><div id="wwID0EJ2DY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Alias</span>: <span class="userinput">RegPort</span></div><div id="wwID0EC3DY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>f. </span></span>Click <span class="uicontrol">Add</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EX3DY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_external_listener.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 435px; max-width: 794px; top: 0pt" alt="External listener configuration" /></div></div><div id="wwID0EI4DY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>g. </span></span>Click <span class="uicontrol">Add</span> button at the end of the page to add the external port.</div><div class="ww_skin_page_overflow"><div id="wwID0E44DY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_external_port.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 278px; max-width: 786px; top: 0pt" alt="external port added" /></div></div><div id="wwID0EQ5DY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Create an internal port on <span class="ph">API Gateway</span>.</div><div id="wwID0EH6DY" class="Numbered_1_Continued">In this use case, a single <span class="ph">API Gateway</span> instance is used. In the case of creating an internal port in the internal server, the same <span class="ph">API Gateway</span> server acts as an internal server, which listens and pulls the requests queuing up in the registration port.</div><div id="wwID0EZ6DY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Expand the menu options in the title bar and select <span class="uicontrol">Administration</span>.</div><div id="wwID0EOAEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Select <span class="uicontrol">Security</span> &gt; <span class="uicontrol">Ports</span>.</div><div id="wwID0EHBEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Click on <span class="uicontrol">Add Ports</span> and select <span class="uicontrol">API Gateway internal</span> and click <span class="uicontrol">Add</span>.</div><div id="wwID0EECEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Provide the following value for Alias, <span class="userinput">IntPort</span>.</div><div id="wwID0EZCEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Under <span class="ph">API Gateway</span> external server, provide the following information:</div><div id="wwID0ERDEY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Host</span>: <span class="userinput">127.0.0.1</span></div><div id="wwID0EIEEY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Port</span>: <span class="userinput">4567</span></div><div id="wwID0EBFEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>f. </span></span>Under Registration credential(optional), type the username as <span class="userinput">Administrator</span> and password as <span class="userinput">manage</span>.</div><div id="wwID0E1FEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>g. </span></span>Click <span class="uicontrol">Add</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EQGEY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_internal_port.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 384px; max-width: 791px; top: 0pt" alt="internal port" /></div></div><div id="wwID0EBHEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Enable the ports.</div><div id="wwID0EUHEY" class="Numbered_1_Continued">Enable the ports after all the ports are created. Click on the<span class="uicontrol"> x </span>under <span class="uicontrol">Enabled</span> column for the ports.</div><div class="ww_skin_page_overflow"><div id="wwID0EBIEY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_enable_ports.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 247px; max-width: 792px; top: 0pt" alt="enable ports" /></div></div><div id="wwID0E3IEY" class="Section_Title">Step 2: Configure <span class="ph">API Gateway</span> as an internal authorization server</div><div id="wwID0EGJEY" class="Body">Here, you configure <span class="ph">API Gateway</span> with the required information to act as an internal authorization server for OAuth or JWT depending on what authentication protocol you want to use to identify and authorize a client application. You can also define the required scopes that provide a way to limit the amount of access that is granted to an access token. In this xample, use the default configuration as it is and define one OAuth Scope (OAuth2Scopes) to limit the resource usage.</div><div id="wwID0EUJEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Expand the menu options in the title bar and select <span class="uicontrol">Administration</span>.</div><div id="wwID0EJKEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Select <span class="uicontrol">Security</span> -&gt; <span class="uicontrol">JWT/OAuth/OpenID</span> and click <span class="uicontrol">local</span>.</div><div id="wwID0EGLEY" class="Numbered_1_Continued">This displays all the configurable settings for the Authorization Server.</div><div id="wwID0E4LEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Click <span class="uicontrol">OAuth scopes</span> to add Scope.</div><div id="wwID0EUMEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Provide the following information and click Add:</div><div id="wwID0EINEY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Scope</span>: <span class="userinput">OAuth2Scopes</span></div><div id="wwID0E6NEY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Scope description</span>: <span class="userinput">Validate OAuth 2.0 Scopes</span></div><div id="wwID0EYOEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Click <span class="uicontrol">Update</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EOPEY" class="Figure"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_apigw_internal_authserver.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 370px; max-width: 757px; top: 0pt" alt="internal authorization server" /></div></div><div id="wwID0EGQEY" class="Section_Title">Step 3: Create an API with strategy</div><div id="wwID0ELQEY" class="Body">In this example, you create an API by importing from the URL <span class="codeph">https://petstore.swagger.io/v2/swagger.json</span>.</div><div id="wwID0EZQEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>In the <span class="uicontrol">APIs</span> tab, click <span class="uicontrol">Create API</span>.</div><div id="wwID0ESREY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Select <span class="uicontrol">Import API from URL</span>.</div><div id="wwID0EHSEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Provide the following details.</div><div id="wwID0E2SEY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Name</span>: <span class="userinput">RestOps</span></div><div id="wwID0ETTEY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Type</span>: <span class="userinput">Swagger</span></div><div id="wwID0ELUEY" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="uicontrol">Version</span>: <span class="userinput">1.0</span></div><div id="wwID0EFVEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Click <span class="uicontrol">Create</span>.</div><div id="wwID0E1VEY" class="Numbered_1_Continued">The API is created and the API details page for the API appears.</div><div class="ww_skin_page_overflow"><div id="wwID0E6VEY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_create_api.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 459px; max-width: 794px; top: 0pt" alt="create api" /></div></div><div id="wwID0EQWEY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Enforce OAuth 2 policy on the API.</div><div id="wwID0EDXEY" class="Numbered_1_Continued">You enforce OAuth2 policy on the <span class="apiname">RestOps</span> API. This policy ascertains that an OAuth token is required to access this API.</div><div id="wwID0ESXEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Click <span class="uicontrol">API</span> in the title navigation panel.</div><div id="wwID0EHYEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Click <span class="uicontrol">RestOps</span>.</div><div id="wwID0E3YEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Click the <span class="uicontrol">Policies</span> tab.</div><div id="wwID0ERZEY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Click on <span class="uicontrol">Edit</span> to add the policy to API.</div><div id="wwID0EG1EY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Click <span class="uicontrol">Identify &amp; Access</span> in the Policy catalog.</div><div id="wwID0E21EY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>f. </span></span>Select the <span class="uicontrol">OAuth2 Token</span> check box in the <span class="uicontrol">Identification Type</span> field of the Application Identification section and save the changes.</div><div id="wwID0EU2EY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>g. </span></span>Click <span class="uicontrol">Activate</span> to activate the API on the API details page of the API.</div><div class="ww_skin_page_overflow"><div id="wwID0EJ3EY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_enforce_oauthpolicy.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 499px; max-width: 791px; top: 0pt" alt="activate api" /></div></div><div id="wwID0E33EY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Create an Application in <span class="ph">API Gateway</span> with strategy and register it to an API.</div><div id="wwID0EW4EY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span>Click <span class="uicontrol">Applications</span> in the title navigation bar.</div><div id="wwID0EL5EY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span>Click <span class="uicontrol">Create application</span>.</div><div id="wwID0EA6EY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span>Provide the name as <span class="userinput">APIApplication</span>.</div><div id="wwID0EV6EY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span>Click <span class="uicontrol">Continue to Identifiers</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EKAFY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_appln_strategy.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 334px; max-width: 789px; top: 0pt" alt="create application with strategy" /></div></div><div id="wwID0E2AFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span>Click on <span class="uicontrol">Continue to APIs</span>.</div><div id="wwID0EQBFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>f. </span></span>Search the API <span class="apiname">RestOps</span>, by typing <span class="userinput">RestOps</span> in the <span class="uicontrol">Find APIs</span> text box.</div><div id="wwID0EOCFY" class="Numbered_2_Continued">The <span class="apiname">RestOps</span> API appears in the <span class="uicontrol">Selected APIs</span> section.</div><div id="wwID0E5CFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>g. </span></span>Select the <span class="apiname">RestOps</span>API.</div><div id="wwID0EUDFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>h. </span></span>Click <span class="uicontrol">Continue to Advanced</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0EJEFY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_strategy_advanced.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 346px; max-width: 786px; top: 0pt" alt="continue to advanced" /></div></div><div id="wwID0E1EFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>i. </span></span>Click <span class="uicontrol">Continue to Authentication</span>.</div><div id="wwID0EPFFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>j. </span></span>Click <span class="uicontrol">Create strategy</span>.</div><div id="wwID0EEGFY" class="Numbered_2_Continued">A strategy is a way to authenticate the incoming request and provide multiple authentication mechanisms or multiple authorization servers for a single authentication scheme. You can create multiple strategies authorized by an API for an application.</div><div id="wwID0EKGFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>k. </span></span>Provide the name as <span class="userinput">AppStrategy</span>.</div><div id="wwID0E6GFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>l. </span></span>Enable the toggle button <span class="uicontrol">Generate credentials</span> to generate the credentials dynamically in the authorization server.</div><div id="wwID0EUHFY" class="Numbered_2_Continued">The client-id and client-secret get created automatically.</div><div id="wwID0E1HFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>m. </span></span>Select <span class="userinput">Confidential</span> from the <span class="uicontrol">Application type</span> drop-down list.</div><div id="wwID0ETIFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>n. </span></span>Specify the redirect URIs that the authorization server can use to redirect the resource owner's browser during the grant process. In this example, provide <span class="userinput">www.example.com</span>, which is not a valid URL.</div><div id="wwID0EIJFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>o. </span></span>Select the required Grant types. In this example, the selected grant types are <span class="userinput">authorization_code</span> and <span class="userinput">client_credentials</span>.</div><div id="wwID0EBKFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>p. </span></span>Provide <span class="userinput">OAuth2Scopes</span> in the <span class="uicontrol">Scope</span> text box and click the search icon.</div><div id="wwID0E1KFY" class="Numbered_2_Continued">The matching OAuth2Scopes appear.</div><div id="wwID0EALFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>q. </span></span>Click <span class="uicontrol">+</span> sign to add the scope to the Strategy.</div><div id="wwID0EVLFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>r. </span></span>Click <span class="uicontrol">Add</span> button at the bottom to add the Strategy.</div><div id="wwID0EKMFY" class="Numbered_2"><span class="WebWorks_Number" style="width: 18pt"><span>s. </span></span>Click <span class="uicontrol">Save</span>.</div><div class="ww_skin_page_overflow"><div id="wwID0E6MFY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_add_strategy.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 395px; max-width: 786px; top: 0pt" alt="app strategy" /></div></div><div id="wwID0E2NFY" class="Section_Title">Step 4: Map OAuth scopes</div><div id="wwID0EAOFY" class="Body">After registering an application, you must map the scope defined in the Authorization server with the APIs in <span class="ph">API Gateway</span> to authorize the access tokens to be used to access the protected resources. You can map either a complete API or parts (resources or methods) of an API to the scope or add the scope details and modify the scope details as required from the OAuth or OpenID scopes page. In this example you select the OAuth2Scopes scope.</div><div id="wwID0EOOFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Expand the menu options in the title bar and select <span class="uicontrol">OAuth/OpenID</span> scopes.</div><div id="wwID0EDPFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Click <span class="uicontrol">Map scope</span>.</div><div id="wwID0EYPFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Type <span class="userinput">OAuth2Scopes</span> in <span class="uicontrol">Select authorization server scope</span> and select the listed Authorization server scope from the search list populated.</div><div class="ww_skin_page_overflow"><div id="wwID0ERQFY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_create_scope.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 335px; max-width: 788px; top: 0pt" alt="create scope mapping" /></div></div><div id="wwID0ECRFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Click <span class="uicontrol">API scopes</span>.</div><div id="wwID0EXRFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>Type <span class="apiname">RestOps</span> or <span class="userinput">API Scope</span>, which is to be linked to the authorization server, in <span class="uicontrol">API scopes search</span> text box.</div><div id="wwID0EVSFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Click <span class="uicontrol">Save</span>.</div><div id="wwID0EKTFY" class="Numbered_1_Continued">The authorization server scope is mapped to the selected API scopes and the authorization scope is listed in the scopes list.</div><div class="ww_skin_page_overflow"><div id="wwID0EPTFY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_map_scope.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 290px; max-width: 790px; top: 0pt" alt="create scope mapped" /></div></div><div id="wwID0EJUFY" class="Section_Title">Step 5: Get authorization code</div><div id="wwID0EOUFY" class="Body">As the grant type chosen is Client credentials, the Client Id and Client secret is required to get the bearer token.</div><div id="wwID0EZUFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>In the title bar, click on <span class="uicontrol">Application</span>.</div><div id="wwID0EOVFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Click the Application <span class="userinput">APIApplication</span>.</div><div id="wwID0EDWFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Click <span class="uicontrol">AppStrategy</span>.</div><div id="wwID0EYWFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Note the Client id and Client secret.</div><div class="ww_skin_page_overflow"><div id="wwID0EJXFY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_bearer_token.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 319px; max-width: 796px; top: 0pt" alt="auth code" /></div></div><div id="wwID0EHYFY" class="Section_Title">Step 6: Get the bearer token</div><div id="wwID0EMYFY" class="Body">Get the OAuth bearer token using external ports.</div><div id="wwID0EXYFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>Use any Rest client to retrieve the token.</div><div id="wwID0EIZFY" class="Numbered_1_Continued">In the following example, Postman client is used.</div><div id="wwID0EOZFY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>Make a <span class="inlinetitle">POST</span> call to the following URL, with the hostname of the system where <span class="ph">API Gateway</span> is installed in place of localhost and use external port instead of default port.</div><div id="wwID0EI1FY" class="Numbered_1_Continued"><span class="codeph">http://</span><span class="codeph_002c_varname">machinename</span><span class="codeph">:1234 /invoke/pub.apigateway.oauth2/getAccessToken</span></div><div id="wwID0EY1FY" class="Numbered_1_Continued"><span class="codeph">http://localhost:1234 /invoke/pub.apigateway.oauth2/getAccessToken</span></div><div class="ww_skin_page_overflow"><div id="wwID0EG2FY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_bearer_extport.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 127px; max-width: 790px; top: 0pt" alt="get access token" /></div></div><div id="wwID0E32FY" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Provide the following <span class="userinput">payload</span>, with the required <span class="userinput">client id</span> and <span class="userinput">client secret</span> and <span class="userinput">grant type</span>, in the body of the request section. In headers, provide Content-Type as <span class="userinput">application/json </span>(if not specified).</div><div class="ww_skin_page_overflow"><div id="wwID0EB4FY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_token_payload.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 166px; max-width: 788px; top: 0pt" alt="payload for access token1" /></div></div><div id="wwID0EV4FY" class="Numbered_1_Continued">The access token that can be used to access the required application is displayed in the response section.</div><div class="ww_skin_page_overflow"><div id="wwID0E14FY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_token_response.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 261px; max-width: 794px; top: 0pt" alt="access token in response" /></div></div><div id="wwID0EY5FY" class="Section_Title">Step 7: Invoke API</div><div id="wwID0E45FY" class="Body">Invoke API using the bearer token. Add the OAuth2 access token as a Bearer token in the request header and send to the API. A successful response, <span class="emphasis">200 OK</span> is received from the API with the desired response.</div><div class="ww_skin_page_overflow"><div id="wwID0EI6FY" class="Figure"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_invoke_api.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 151px; max-width: 794px; top: 0pt" alt="invoke api" /></div></div><div id="wwID0EY6FY" class="Body">The response is as shown.</div><div class="ww_skin_page_overflow"><div id="wwID0E46FY" class="Figure"><img class="ScaleFit" src="../yai-webhelp/images/secure_oauth_api_response.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 136px; max-width: 789px; top: 0pt" alt="invoke api response" /></div></div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright Â© 2016-2023&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>