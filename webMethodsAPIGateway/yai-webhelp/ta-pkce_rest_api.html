<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>How do I secure the access token by directly calling API Gateway's REST APIs?</title><link rel="Prev" href="ta-pkce_postman.html" title="Previous" /><link rel="Next" href="ta-pkce_per_token.html" title="Next" /><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/_api_gtw_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/yai-webhelp/ta-pkce_rest_api.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pOaM4lF_002bvNFed2Cq6EKkF7A" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/yai-webhelp/ta-pkce_rest_api.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>API Gateway</span>&nbsp;10.15 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.503.html#wwconnect_header">Using API Gateway</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/_api_gtw_integrated_webhelp.1.535.html#wwconnect_header">Implement APIs</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/gtw_manage_policies.html#wwconnect_header">Policies</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/gtw_iam_policies.html#wwconnect_header">Identify and Access</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/re-iam_identify_authorize_app.html#wwconnect_header">Identify &amp; Authorize</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../yai-webhelp/co-pkce_overview.html#wwconnect_header">Securing Access Token Calls with PKCE</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">How do I secure the access token by directly calling API Gateway's REST APIs?</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0EHGQY" class="Heading_6">How do I secure the access token by directly calling API Gateway's REST APIs?</div><div id="wwID0EWGQY" class="Body">This use case starts when you enforce the PKCE and ends when you get access the token securely using REST APIs.</div><div id="wwID0E2GQY" class="Body"><span class="inlinetitle">Before you begin</span></div><div id="wwID0EFHQY" class="Body">Ensure that you have:</div><div id="wwID0EQHQY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>generated Code Challenge and Code Verifier using the JAR file. For details about how to generate code challenge and code verifier, see 
    <a href="../yai-webhelp/ta-pkce_generate_code_verifier.html#wwID0EOHRY"
   
     title="How do I generate code verifier and code challenge using JAR files?"
    ><span class="heading-page"> How do I generate code verifier and code challenge using JAR files?
				</span></a>.</div><div id="wwID0EOIQY" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>enforced PKCE at global level.</div><div id="wwID0ECJQY" class="procedure"><span><img src="icon_task_xpe.png" alt="*" border="0" width="20" height="13" /></span>To secure the access token</div><div id="wwID0EOJQY" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span><span class="Command"> Create OAuth scope in the local authorization server. </span></div><div class="ww_skin_page_overflow"><div id="wwID0ELKQY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/pkce_oauth_scop.png" width="100%" style="display: inline; float: none; left: 0pt; max-height: 592px; max-width: 1486px; top: 0pt" alt="create oauth scope" /></div></div><div id="wwID0EBLQY" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span><span class="Command">Create an application with OAuth2 authentication strategy. For details about creating an application, see </span>
    <a href="../yai-webhelp/gtw_create_application.html#wwID0E2YHX"
   
     title="Creating an Application"
    ><span class="Command_002c_heading-page">Creating an Application</span></a><span class="Command">. </span></div><div class="ww_skin_page_overflow"><div id="wwID0ELMQY" class="Figure_1"><img class="ScaleFit" src="../yai-webhelp/images/pkce_rest_app.png" width="100%" style="display: inline; float: none; left: 0pt; max-height: 935px; max-width: 1536px; top: 0pt" alt="create application" /></div></div><div id="wwID0EGNQY" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span><span class="Command"> Click the </span><span class="Command_002c_uicontrol">Authentication</span><span class="Command"> tab to create a strategy with OAuth2 authentication. </span></div><div id="wwID0EFOQY" class="Step_Info_2">Make sure you have selected the following mandatory fields for this use case:</div><div id="wwID0EQOQY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Select the <span class="uicontrol">Authentication schemes</span> as <span class="userinput">OAUTH2</span>.</div><div id="wwID0ELPQY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Specify the <span class="uicontrol">Authentication server</span> as <span class="userinput">local</span>.</div><div id="wwID0EGQQY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Select the <span class="uicontrol">Application Type</span> as <span class="userinput">Public</span>.</div><div id="wwID0EBRQY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Specify the grant type to be used to generate the credentials. For this specific use case, you must select authorization_code, which are dynamically populated from the authorization server.</div><div id="wwID0EURQY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Specify the URIs that the authorization server can use to redirect the resource owner's browser during the grant process. You can add multiple URIs by clicking +Add.</div><div id="wwID0EHSQY" class="List_3"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span>Specify the OAuth scope that you have created for the local authorization server in Step 1.</div><div id="wwID0E4SQY" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span><span class="Command"> Click </span><span class="Command_002c_uicontrol">Add</span><span class="Command"> to save the strategy. </span></div><div id="wwID0E3TQY" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span><span class="Command"> Click </span><span class="Command_002c_uicontrol">Save</span><span class="Command"> to save the application. </span></div><div id="wwID0E4UQY" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span><span class="Command"> Get authorization code. </span></div><div id="wwID0E1VQY" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span><span class="Command">Call the authorize endpoint using a REST client. </span><span class="Command_002c_filepath">http(s)://hostname:port/invoke/pub.apigateway.oauth2/authorize? response_type=code&amp;redirect_uri=&lt;redirectURI&gt;&amp;client_id=&lt;Client ID&gt;&amp;code_challenge=&lt;Code_Challenge&gt;&amp;code_challenge_method=S256</span><span class="Command"> </span></div><div id="wwID0E5WQY" class="Note_2"><span class="Bold">Note:<br /></span>Make sure you have replaced the <span class="varname">redirectURI , ClientID, and Code_Challenge</span> in the above mentioned URL. You can get the <span class="emphasis">redirect URI</span> and <span class="emphasis">client ID</span> from the <span class="inlinetitle">Authentication</span> tab of the <span class="inlinetitle">Application</span> screen.</div><div class="ww_skin_page_overflow"><div id="wwID0ENYQY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/pkce_approve.png" width="100%" style="display: inline; float: none; left: 0pt; max-height: 278px; max-width: 1200px; top: 0pt" alt="call authorize endpoint" /></div></div><div id="wwID0EDZQY" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>b. </span></span><span class="Command"> Click the </span><span class="Command_002c_uicontrol">Approve</span><span class="Command"> button. </span></div><div id="wwID0EC1QY" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>c. </span></span><span class="Command"> Provide the credentials of API Gateway user to approve the request. </span></div><div id="wwID0E61QY" class="Body_2">You are re-directed to the redirect URI as per the configuration in the application strategy. The screenshot below is just a sample, you are redirected to a different URL based on your configuration, so the screenshot varies accordingly. If the given redirect URI is not a valid web page, you might get a <span class="inlinetitle">Page not found</span> error, which is fine, because we get the authorization code value from the browser URL.</div><div class="ww_skin_page_overflow"><div id="wwID0EK2QY" class="Figure_2"><img class="ScaleFit" src="../yai-webhelp/images/authcode.png" width="100%" style="display: inline; float: none; left: 0pt; max-height: 384px; max-width: 1680px; top: 0pt" alt="approve request" /></div></div><div id="wwID0EA3QY" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>d. </span></span><span class="Command"> Make a note of the authorization code. </span></div><div id="wwID0E43QY" class="Note_2"><span class="Bold">Note:<br /></span>If the redirect URL screen is not able to display the authorization code, then you can take it from the address bar of the browser. As highlighted in the above image's URL, you can see the authorization code in the code=field of the URL.</div><div id="wwID0EV4QY" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>e. </span></span><span class="Command"> Click </span><span class="Command_002c_uicontrol">Save</span><span class="Command"> to save the application. </span></div><div id="wwID0EW5QY" class="Step_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span><span class="Command"> Get access token. </span></div><div id="wwID0ET6QY" class="Substep_2"><span class="WebWorks_Number" style="width: 18pt"><span>a. </span></span><span class="Command">Invoke the access token endpoint using a REST client. </span></div><div id="wwID0ELARY" class="Step_Info_2">Request: POST <span class="filepath"> http(s)://hostname:port/invoke/pub.apigateway.oauth2/getAccessToken</span>.</div><div id="wwID0EUARY" class="Body_2">In the <span class="uicontrol">Authorization</span> tab, select the authorization type as <span class="userinput">Basic Auth</span> . Provide the client ID as username and client secret as the password. You can get the client ID and client secret in the <span class="uicontrol">Authentication</span> tab of the <span class="uicontrol">Application</span> screen.</div><div id="wwID0EKBRY" class="Body_2">Sample request body</div><div id="wwID0EPBRY" class="Preformatted_2">{<br />               "redirect_uri":"http://test.com",<br />               "scope":"email",<br />               "grant_type":"authorization_code", <br />               "code":"0025abe9f96d4901b61340344c29a576",<br />               "code_verifier":"a4793f15479a4c5697f93b44d055ab6cbd16be50400a4591892f914b1a256da8",<br />               "client_id":"374b1fae-4405-411b-85a0-6e1ab90923ba"<br />} <br /></div><div id="wwID0EWBRY" class="Note_2"><span class="Bold">Note:<br /></span>You must replace the redirect_URI, scope, code, and code_verifier with appropriate values. For the code field, make sure you use the authorization code you noted down in the step 3.d.</div><div id="wwID0EMCRY" class="Body_2">Sample response body</div><div id="wwID0ERCRY" class="Preformatted_2">{<br />    "access_token": "b5b33bc9c57945f388010f8caf5fe9b6b14abef468d346e68e0cd374c0df60d7",<br />    "token_type": "Bearer",<br />    "expires_in": 3600<br />}<br /></div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright Â© 2016-2023&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>