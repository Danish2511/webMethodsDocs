<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="true" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Example Service that Throws an Exception for Retry</title><link rel="Prev" href="esb.retry.requirements.html" title="Previous" /><link rel="Next" href="esb.client.html" title="Next" /><link rel="StyleSheet" href="css/is_integrated_webhelp.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/is_integrated_webhelp_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/integration-server-integrated-webhelp/esb.retry.example.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pw4shO1FIhGy9rKOzksqIiA" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/integration-server-integrated-webhelp/esb.retry.example.html');"><header id="wwconnect_header"><!-- Produkt Name und Version in Breadcrumbs SQ --><div class="ww_skin_breadcrumbs"><span>Integration Server</span>&nbsp;10.11 |
		     <span class="ww_skin_breadcrumbs_parent"><a href="../integration-server-integrated-webhelp/to-webhelp_intro_sd_guide.html#wwconnect_header">Service Development Guide</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_parent"><a href="../integration-server-integrated-webhelp/esb.retry.html#wwconnect_header">Building Services that Retry</a></span><span class="ww_skin_breadcrumbs_divider"> | </span><span class="ww_skin_breadcrumbs_current">Example Service that Throws an Exception for Retry</span></div><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwID0EMGDWB" class="Heading_2">Example Service that Throws an Exception for Retry</div><div id="wwID0EEHDWB" class="Body">This example shows one possible way to build a service that catches errors, checks errors to determine whether they are transient, and re-throws an error as an ISRuntimeException if it is transient. It includes the following basic sections of logic:</div><div id="wwID0ENHDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">An outer sequence</span> that contains a try sequence and a catch sequence:</div><div id="wwID0EHIDWB" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">The try sequence</span> executes the work that you want the service to perform.</div><div id="wwID0E4IDWB" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">The catch sequence</span> examines any exception that occurs in the try sequence, determines whether the exception is a transient error, and indicates whether <span class="ph">Integration Server</span> should retry the service.</div><div id="wwID0EYJDWB" class="List_1_Continued">The outer sequence is used so that the catch sequence is skipped when the try sequence is successful.</div><div id="wwID0E5JDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">A throw exception step</span> that executes only when the catch sequence indicates that a transient error occurred. It throws the ISRuntimeException to signal <span class="ph">Integration Server</span> that the service should be re-executed.</div><div id="wwID0E5KDWB" class="Figure_Title">Example logic for a service that throws an exception for retry</div><div class="ww_skin_page_overflow"><div id="wwID0EZKDWB-2" class="Figure"><img class="Default" src="../integration-server-integrated-webhelp/images/ThrowExceptionForRetry.png" width="100%" style="display: block; float: none; left: 0pt; max-height: 178px; max-width: 452px; top: 0pt" alt="" /></div></div><div id="wwID0ESLDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">STEP 1 - Outer SEQUENCE exits on SUCCESS</span></div><div id="wwID0EIMDWB" class="List_1_Continued">The outer sequence wraps the try sequence and the catch sequence. This sequence is set to exit on success so that it exits when either of its child steps (the try sequence or the catch sequence) execute successfully. If the try sequence executes successfully, <span class="ph">Integration Server</span> skips the catch sequence.</div><div id="wwID0ETMDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">STEP 1.1 - Try SEQUENCE exits on FAILURE</span></div><div id="wwID0EJNDWB" class="List_1_Continued">The try sequence contains the logic you want the service to execute. This sequence is set to exit on failure. As a result, if a step in this try sequence fails, <span class="ph">Integration Server</span> executes the next step, which is the catch sequence that checks for transient errors.</div><div id="wwID0EUNDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">STEP 1.1.1 - Insert service logic</span></div><div id="wwID0EKODWB" class="List_1_Continued">This step contains the logic that you want the service to perform. The service logic might consist of multiple services or flow steps.</div><div id="wwID0EPODWB" class="List_1_Continued">When the service logic executes successfully, that means the try sequence is successful. Because the outer sequence exits on success, <span class="ph">Integration Server</span> exits the outer sequence, skipping the catch sequence. <span class="ph">Integration Server</span> executes the next step, which is the BRANCH on ‘/isTransientError’ step.</div><div id="wwID0E4ODWB" class="List_1_Continued">If an error occurs in the service logic, <span class="ph">Integration Server</span> exits the try sequence because it is set to exit on failure. As a result, <span class="ph">Integration Server</span> executes the catch sequence.</div><div id="wwID0EMPDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">STEP 1.2 - Catch SEQUENCE exits on DONE</span></div><div id="wwID0ECQDWB" class="List_1_Continued"><span class="ph">Integration Server</span> only executes the catch sequence if the try sequence failed. The catch sequence contains logic that evaluates the error to determine whether the error is transient.</div><div id="wwID0EMQDWB" class="List_1_Continued">Because the catch sequence exits on DONE, the sequence is successful after <span class="ph">Integration Server</span> executes all the steps in the sequence. After the catch sequence is successful, the outer sequence, which is set to exit on success, also exits. <span class="ph">Integration Server</span> executes the next step, which is the BRANCH on ‘/isTransientError’ step.</div><div id="wwID0E2QDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">STEP 1.2.1 - Catch the last error</span></div><div id="wwID0ERRDWB" class="List_1_Continued">To determine whether a transient error occurred, the catch sequence first invokes the <span class="apiname">pub.flow:getLastError</span> service to catch the error that caused the try sequence to fail.</div><div id="wwID0E3RDWB" class="Important_1"><span class="Bold">Important:<br /></span>The <span class="apiname">pub.flow:getLastError</span> service must be the first service invoked within the catch sequence. If it is not first and a preceding service in the catch sequence fails, the error thrown in the try sequence is overwritten with the new error.</div><div id="wwID0EZSDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">STEP 1.2.2 - Determine whether the error is a transient error</span></div><div id="wwID0EPTDWB" class="List_1_Continued">This step evaluates the contents of the <span class="varname">lastError</span> document that the <span class="apiname">pub.flow:getLastError</span> service returns to determine whether the try sequence failed because of a transient error. You might use multiple services or flow steps to determine whether a transient error occurred.</div><div id="wwID0E6TDWB" class="Note_1"><span class="Bold">Note:<br /></span>If the service logic in the try sequence includes an adapter service and a transient error occurs during adapter service execution, the adapter service throws an exception that extends the ISRuntimeException. Ensure that your catch sequence interprets the adapter service exception that signals retry. For more information, see 
    <a href="../integration-server-integrated-webhelp/esb.retry.requirements.html#wwID0E54CWB"
   
     title="Requirements for Retrying a Service"
    ><span class="heading-page">Requirements for Retrying a Service</span></a>.</div><div id="wwID0E6UDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">STEP 1.2.3 - Set flag to indicate whether the service should retry</span></div><div id="wwID0EVVDWB" class="List_1_Continued">This step sets the transient error flag based on whether the try sequence failed because of a transient error. In this example if a transient error occurred, the variable <span class="varname">isTransientError</span>) is set to “true”.</div><div id="wwID0EAWDWB" class="List_1_Continued">After this step executes, <span class="ph">Integration Server</span> exits the catch sequence, exits the outer sequence, and then executes the BRANCH on ‘/isTransientError’ step.</div><div id="wwID0ELWDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">STEP 2 - Check transient error flag</span></div><div id="wwID0EBXDWB" class="List_1_Continued">This step uses the value of <span class="varname">isTransientError</span> to determine whether the service should throw an ISRuntimeException.</div><div id="wwID0EMXDWB" class="List_1_Continued">If the try sequence executed successfully, <span class="varname">isTransientError</span> is null. As a result, <span class="ph">Integration Server</span> falls through to the end of the service because the value of the switch variable does not match any of the target steps. <span class="ph">Integration Server</span> will not attempt to retry the service.</div><div id="wwID0E6XDWB" class="List_1_Continued">If the try sequence failed, but the catch sequence determined that the error was not transient, the catch sequence does not set <span class="varname">isTransientError</span> to “true”. It might be null or the catch sequence might set <span class="varname">isTransientError</span> to another value, for example, “false”. Either way, <span class="ph">Integration Server</span> falls through to the end of the service because the value of the switch variable does not match any of the target steps. <span class="ph">Integration Server</span> will not attempt to retry the service.</div><div id="wwID0EXYDWB" class="List_1_Continued">If the try sequence failed and the catch sequence determined that the error was transient, <span class="varname">isTransientError</span> is “true”, and as a result, <span class="ph">Integration Server</span> executes the next step.</div><div id="wwID0EHZDWB" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="chapterTOC_bullet.png" alt="*" border="0" width="10" height="10" /></span></span><span class="inlinetitle">STEP 2.1 - Throws ISRuntimeException</span></div><div id="wwID0E4ZDWB" class="List_1_Continued"><span class="ph">Integration Server</span> executes this step to invoke <span class="apiname">pub.flow:throwExceptionForRetry</span> service when the value of <span class="varname">isTransientError</span> is “true”. This service wraps the exception generated by the transient error in the try sequence and re-throws it as an ISRuntimeException.</div><div id="wwID0ER1DWB" class="List_1_Continued">If the service is configured for retry, <span class="ph">Integration Server</span> retries the service if the maximum number of retries has not been reached. For more information, see 
    <a href="../integration-server-integrated-webhelp/esb.svc.retry.task.html#wwID0ERKOMB"
   
     title="Configuring Service Retry"
    ><span class="heading-page">Configuring Service Retry</span></a>.</div><div id="wwID0EP2DWB" class="title">Related Topics</div><div id="wwID0ET2DWB" class="heading-page">
    <a href="../integration-server-integrated-webhelp/esb.retry.html#wwID0EHYCWB"
   
     title="Building Services that Retry"
    ><span class="Link_Text">Building Services that Retry</span></a></div><div id="wwID0E62DWB" class="heading-page">
    <a href="../integration-server-integrated-webhelp/esb.retry.requirements.html#wwID0E54CWB"
   
     title="Requirements for Retrying a Service"
    ><span class="Link_Text">Requirements for Retrying a Service</span></a></div><div id="wwID0EL3DWB" class="heading-page">
    <a href="../integration-server-integrated-webhelp/esb.svc.retry.html#wwID0EI3NMB"
   
     title="About Automatic Service Retry"
    ><span class="Link_Text">About Automatic Service Retry</span></a></div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><!-- SQ insert Footer --><br /><hr style="border:1px solid; border-color: #1776BF; " /><!-- FRWE: Why is the font family information hard-coded?? --><div style="font-family: 'Roboto', Sans-Serif; font-size: 10px; margin-top: 6px; margin-bottom: 6px; text-align: center;"><a href="http://www.softwareag.com/licenses">Copyright © 2007-2022&nbsp;Software AG, Darmstadt, Germany and/or Software AG USA, Inc., Reston, VA, USA, and/or its subsidiaries and/or its affiliates and/or their licensors</a></div><!-- SQ insert Date 
	 <div style="text-align: center; font-weight: bold;" wwpage:content="pub-date">January 1, 2015</div> --><!-- old Footer 2016
	  <div class="footer">Copyright &#169; <span wwpage:content="sag:product-copyrfirst"></span>, <span wwpage:content="sag:organization-copyrholder"></span>, <a href="http://sag.com/" wwpage:attribute-href="sag:organization-url" wwpage:content="sag:organization-url">http://sag.com/</a>
   --><!-- SQ Variablen --><!-- Copyright Test --><!--	  <div style="text-decoration: underline">Copyright Import Test:</div>
	  <wwpage:Import wwpage:content-from-file="Copyright/copyright_en.asp" />
	  <br></br>--><!--
	  <!-\- SQ Variables - Information from xresources -\->
	  <div style="text-decoration: underline">From xresources:</div>
	  <div>sag:organization-id == <span wwpage:content="sag:organization-id"></span></div>
	  <div>sag:organization-name == <span wwpage:content="sag:organization-name"></span></div>
	  <div>sag:organization-copyrholder == <span wwpage:content="sag:organization-copyrholder"></span></div>
	  <div>sag:organization-url == <span wwpage:content="sag:organization-url"></span></div>
	  
	  <div>sag:family-id == <span wwpage:content="sag:family-id"></span></div>
	  <div>sag:family-name == <span wwpage:content="sag:family-name"></span></div>
	  <div>sag:family-organization == <span wwpage:content="sag:family-organization"></span></div>
	  
	  <div>sag:product-id == <span wwpage:content="sag:product-id"></span></div>
	  <div>sag:product-name == <span wwpage:content="sag:product-name"></span></div>
	  <div>sag:product-copyrfirst == <span wwpage:content="sag:product-copyrfirst"></span></div>
	  <div>sag:product-family == <span wwpage:content="sag:product-family"></span></div>
	  
	  <!-\- SQ Variables - Values from DITA-Map and Keymap-\->
	  <br></br>
	  <div style="text-decoration: underline">From DITA/Book-Map:</div>
	  <div>ProdInfo Prodname == <span wwpage:replace="wwvars:ProdInfoProdName"></span></div>
	  <div>ProdInfo Mod First == <span wwpage:replace="wwvars:ProdInfoModFirst"></span></div>
	  <div>ProdInfo Mod Last == <span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>ProdInfo Rel First == <span wwpage:replace="wwvars:ProdInfoRelFirst"></span></div>
	  <div>ProdInfo Rel Last == <span wwpage:replace="wwvars:ProdInfoRelLast"></span></div>
	  <div>ProdInfo Vers First == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span></div>
	  <div>ProdInfo Vers Last == <span wwpage:replace="wwvars:ProdInfoVersLast"></span></div>
	  <div>ProdInfo vrm vers.rel.mod == <span wwpage:replace="wwvars:ProdInfoVersFirst"></span>.<span wwpage:replace="wwvars:ProdInfoRelLast"></span>.<span wwpage:replace="wwvars:ProdInfoModLast"></span></div>
	  <div>BookID PartNo == <span wwpage:replace="wwvars:BookPartNo"></span></div>
	  <div>othermeta release-version == <span wwpage:replace="wwvars:ReleaseVersion"></span></div>
	  <div>othermeta release-date == <span wwpage:replace="wwvars:ReleaseDate"></span></div>
	  <div>othermeta release-edition == <span wwpage:replace="wwvars:ReleaseEdition"></span></div>
	  <div>othermeta product == <span wwpage:replace="wwvars:Product"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">From x_runtime/keymap.ditamap:</div>
	  <div>sag:product-shortname == <span wwpage:replace="wwvars:sag:product-shortname"></span></div>
	  <div>sag:product-longname == <span wwpage:replace="wwvars:sag:product-longname"></span></div>
	  <div>versionAdd == <span wwpage:replace="wwvars:versionAdd"></span></div>
	  <div>yearFYLY == <span wwpage:replace="wwvars:yearFYLY"></span></div>
	  <div>fingerprint == <span wwpage:replace="wwvars:fingerprint"></span></div>
	  <div>sag:CopyrightDeclaration == <span wwpage:replace="wwvars:sag:CopyrightDeclaration"></span></div>
	  <div>pdfReleaseDate == <span wwpage:replace="wwvars:pdfReleaseDate"></span></div>
	  <div>documentID == <span wwpage:replace="wwvars:documentID"></span></div>
	  <br></br>
	  <div style="text-decoration: underline">Reserve:</div>
	  <div>organization == <span wwpage:content="organization"></span></div>
	  <div>product-name == <span wwpage:content="product-name"></span></div>
	  <div>copyright-first == <span wwpage:content="copyright-first"></span></div>
	  <div>copyright-last == <span wwpage:content="copyright-last"></span></div>
	  <div>copyright-first-b == <span wwpage:content="wwvars:copyright-first-b"></span></div>
	  <div>copyright-last-b == <span wwpage:content="copyright-last-b"></span></div>
	  <div>doc-id-one == <span wwpage:content="doc-id-one"></span></div>
	  <div>doc-id-two == <span wwpage:content="doc-id-two"></span></div>  
	  <div>Published == <span wwpage:content="pub-date"></span></div>
	  --></footer></body></html>